<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>App.getProxyForURL</title>
  <script>
    nw.App.setProxyConfig('dummy:8080');
    const proxy = nw.App.getProxyForURL('http://www.example.com/');
    const expect = 'PROXY dummy:8080';
    if (proxy === expect) {
      document.write('<h1 id="result">success</h1>');
    } else {
      document.write('<h1 id="result">failure: expect "' + expect + '" but get ' + proxy + '</h1>');
    }

    // Reset Proxy
    nw.App.setProxyConfig("", "<direct>");

    function requestPac() {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', `http://localhost:${nw.App.manifest.port}/`, true);
      xhr.send();
      xhr.onload = () => {
        const b = new Buffer(xhr.responseText);
        const encodedUrl = "data:application/x-ns-proxy-autoconfig;base64," + b.toString('base64');
        nw.App.setProxyConfig('dummy:8080', encodedUrl);
        const proxy2 = nw.App.getProxyForURL('http://www.port3128.com/');
        const expect2 = 'PROXY localhost:3128';
        if (proxy2 === expect2) {
          document.getElementById('result2').innerHTML = 'success';
        } else {
          document.getElementById('result2').innerHTML = 'failure: expect "' + expect2 + '" but get ' + proxy2;
        }
        const proxy3 = nw.App.getProxyForURL('http://www.port4040.com/');
        const expect3 = 'PROXY localhost:4040';
        if (proxy3 === expect3) {
          document.getElementById("result3").innerHTML = 'success';
        } else {
          document.getElementById('result3').innerHTML = 'failure: expect "' + expect3 + '" but get ' + proxy3;
        }
      };
    }

    function openDevTools() {
      chrome.developerPrivate.openDevTools({ renderProcessId: -1, renderViewId: -1, extensionId: chrome.runtime.id });
    }
  </script>
</head>

<body>
  <button id="pac" onclick="requestPac()">Request pac</button>
  <button id="open-devtools" onclick="openDevTools()">Open DevTools</button>
  <h1 id="result"></h1>
  <h1 id="result2"></h1>
  <h1 id="result3"></h1>
</body>

</html>