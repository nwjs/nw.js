
var cr={plugins_:{},behaviors:{}};"function"!==typeof Object.getPrototypeOf&&(Object.getPrototypeOf="object"===typeof"test".__proto__?function(a){return a.__proto__}:function(a){return a.constructor.prototype});(function(){function a(a,p){this.x=a;this.y=p;cr.seal(this)}function b(a,p,g,u){this.set(a,p,g,u);cr.seal(this)}function d(){this.bly=this.blx=this.bry=this.brx=this.try_=this.trx=this.tly=this.tlx=0;cr.seal(this)}function e(){this.items={};this.item_count=0;this.values_cache=[];this.cache_valid=!0;cr.seal(this)}function f(){this.sum=this.t=this.y=this.c=0;cr.seal(this)}function h(a){this.pts_cache=[];this.set_pts(a);cr.seal(this)}cr.logexport=function(a){window.console&&window.console.log&&window.console.log(a)};cr.seal=function(a){return a};cr.freeze=function(a){return a};cr.is_undefined=function(a){return"undefined"===typeof a};cr.is_number=function(a){return"number"===typeof a};cr.is_string=function(a){return"string"===typeof a};cr.isPOT=function(a){return 0<a&&0===(a-1&a)};cr.abs=function(a){return 0>a?-a:a};cr.max=function(a,p){return a>p?a:p};cr.min=function(a,p){return a<p?a:p};cr.PI=Math.PI;cr.round=function(a){return a+0.5|0};cr.floor=function(a){return a|0};a.prototype.offset=function(a,p){this.x+=a;this.y+=p;return this};a.prototype.mul=function(a,p){this.x*=a;this.y*=p;return this};cr.vector2=a;cr.segments_intersect=function(a,p,g,u,c,k,s,m){if(cr.max(a,g)<cr.min(c,s)||cr.min(a,g)>cr.max(c,s)||cr.max(p,u)<cr.min(k,m)||cr.min(p,u)>cr.max(k,m))return!1;var f=c-a+s-g,b=k-p+m-u;a=g-a;p=u-p;c=s-c;k=m-k;m=cr.abs(p*c-k*a);a=a*b-p*f;return cr.abs(c*b-k*f)<=m&&cr.abs(a)<=m};b.prototype.set=function(a,p,g,u){this.left=a;this.top=p;this.right=g;this.bottom=u};b.prototype.width=function(){return this.right-this.left};b.prototype.height=function(){return this.bottom-this.top};b.prototype.offset=function(a,p){this.left+=a;this.top+=p;this.right+=a;this.bottom+=p;return this};b.prototype.intersects_rect=function(a){return!(a.right<this.left||a.bottom<this.top||a.left>this.right||a.top>this.bottom)};b.prototype.contains_pt=function(a,p){return a>=this.left&&a<=this.right&&p>=this.top&&p<=this.bottom};cr.rect=b;d.prototype.set_from_rect=function(a){this.tlx=a.left;this.tly=a.top;this.trx=a.right;this.try_=a.top;this.brx=a.right;this.bry=a.bottom;this.blx=a.left;this.bly=a.bottom};d.prototype.set_from_rotated_rect=function(a,p){if(0===p)this.set_from_rect(a);else{var g=Math.sin(p),u=Math.cos(p),c=a.left*g,k=a.top*g,s=a.right*g,g=a.bottom*g,m=a.left*u,f=a.top*u,b=a.right*u,u=a.bottom*u;this.tlx=m-k;this.tly=f+c;this.trx=b-k;this.try_=f+s;this.brx=b-g;this.bry=u+s;this.blx=m-g;this.bly=u+c}};d.prototype.offset=function(a,p){this.tlx+=a;this.tly+=p;this.trx+=a;this.try_+=p;this.brx+=a;this.bry+=p;this.blx+=a;this.bly+=p;return this};d.prototype.bounding_box=function(a){a.left=cr.min(cr.min(this.tlx,this.trx),cr.min(this.brx,this.blx));a.top=cr.min(cr.min(this.tly,this.try_),cr.min(this.bry,this.bly));a.right=cr.max(cr.max(this.tlx,this.trx),cr.max(this.brx,this.blx));a.bottom=cr.max(cr.max(this.tly,this.try_),cr.max(this.bry,this.bly))};d.prototype.contains_pt=function(a,p){var g=this.trx-this.tlx,u=this.try_-this.tly,c=this.brx-this.tlx,k=this.bry-this.tly,s=a-this.tlx,m=p-this.tly,f=g*g+u*u,b=g*c+u*k,u=g*s+u*m,l=c*c+k*k,d=c*s+k*m,e=1/(f*l-b*b),g=(l*u-b*d)*e,f=(f*d-b*u)*e;if(0<=g&&0<f&&1>g+f)return!0;g=this.blx-this.tlx;u=this.bly-this.tly;f=g*g+u*u;b=g*c+u*k;u=g*s+u*m;e=1/(f*l-b*b);g=(l*u-b*d)*e;f=(f*d-b*u)*e;return 0<=g&&0<f&&1>g+f};d.prototype.at=function(a,p){switch(a){case 0:return p?this.tlx:this.tly;case 1:return p?this.trx:this.try_;case 2:return p?this.brx:this.bry;case 3:return p?this.blx:this.bly;case 4:return p?this.tlx:this.tly;default:return p?this.tlx:this.tly}};d.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};d.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};d.prototype.intersects_segment=function(a,p,g,u){if(this.contains_pt(a,p)||this.contains_pt(g,u))return!0;var c,k,s,m,f;for(f=0;4>f;f++)if(c=this.at(f,!0),k=this.at(f,!1),s=this.at(f+1,!0),m=this.at(f+1,!1),cr.segments_intersect(a,p,g,u,c,k,s,m))return!0;return!1};d.prototype.intersects_quad=function(a){var p=a.midX(),g=a.midY();if(this.contains_pt(p,g))return!0;p=this.midX();g=this.midY();if(a.contains_pt(p,g))return!0;var u,c,k,s,m,f,b,l;for(b=0;4>b;b++)for(l=0;4>l;l++)if(p=this.at(b,!0),g=this.at(b,!1),u=this.at(b+1,!0),c=this.at(b+1,!1),k=a.at(l,!0),s=a.at(l,!1),m=a.at(l+1,!0),f=a.at(l+1,!1),cr.segments_intersect(p,g,u,c,k,s,m,f))return!0;return!1};cr.quad=d;cr.RGB=function(a,p,g){return Math.max(Math.min(a,255),0)|Math.max(Math.min(p,255),0)<<8|Math.max(Math.min(g,255),0)<<16};cr.GetRValue=function(a){return a&255};cr.GetGValue=function(a){return(a&65280)>>8};cr.GetBValue=function(a){return(a&16711680)>>16};cr.shallowCopy=function(a,p,g){for(var u in p)p.hasOwnProperty(u)&&(a[u]=p[u]);return a};cr.arrayRemove=function(a,p){var g,u;p=cr.floor(p);if(!(0>p||p>=a.length))if(0===p)a.shift();else if(p===a.length-1)a.pop();else{g=p;for(u=a.length-1;g<u;g++)a[g]=a[g+1];a.length=u}};cr.shallowAssignArray=function(a,p){a.length=p.length;var g,u;g=0;for(u=p.length;g<u;g++)a[g]=p[g]};cr.arrayFindRemove=function(a,p){var g=a.indexOf(p);-1!==g&&cr.arrayRemove(a,g)};cr.clamp=function(a,p,g){return a<p?p:a>g?g:a};cr.to_radians=function(a){return a/(180/cr.PI)};cr.to_degrees=function(a){return a*(180/cr.PI)};cr.clamp_angle_degrees=function(a){a%=360;0>a&&(a+=360);return a};cr.clamp_angle=function(a){a%=2*cr.PI;0>a&&(a+=2*cr.PI);return a};cr.to_clamped_degrees=function(a){return cr.clamp_angle_degrees(cr.to_degrees(a))};cr.to_clamped_radians=function(a){return cr.clamp_angle(cr.to_radians(a))};cr.angleTo=function(a,p,g,u){return Math.atan2(u-p,g-a)};cr.angleDiff=function(a,p){if(a===p)return 0;var g=Math.sin(a),u=Math.cos(a),c=Math.sin(p),k=Math.cos(p),g=g*c+u*k;return 1<=g?0:-1>=g?cr.PI:Math.acos(g)};cr.angleRotate=function(a,p,g){var u=Math.sin(a),c=Math.cos(a),k=Math.sin(p),s=Math.cos(p);return Math.acos(u*k+c*s)>g?0<c*k-u*s?cr.clamp_angle(a+g):cr.clamp_angle(a-g):cr.clamp_angle(p)};cr.angleClockwise=function(a,p){var g=Math.sin(a),u=Math.cos(a),c=Math.sin(p),k=Math.cos(p);return 0>=u*c-g*k};cr.rotatePtAround=function(a,p,g,u,c,k){if(0===g)return k?a:p;var s=Math.sin(g);g=Math.cos(g);a-=u;p-=c;var m=a*s;a=a*g-p*s;p=p*g+m;return k?a+u:p+c};cr.distanceTo=function(a,p,g,u){a=g-a;p=u-p;return Math.sqrt(a*a+p*p)};cr.xor=function(a,p){return!a!==!p};cr.lerp=function(a,p,g){return a+(p-a)*g};cr.hasAnyOwnProperty=function(a){for(var p in a)if(a.hasOwnProperty(p))return!0;return!1};cr.wipe=function(a){for(var p in a)a.hasOwnProperty(p)&&delete a[p]};var k=+new Date;cr.performance_now=function(){if("undefined"!==typeof window.performance){var a=window.performance;if("undefined"!==typeof a.now)return a.now();if("undefined"!==typeof a.webkitNow)return a.webkitNow();if("undefined"!==typeof a.msNow)return a.msNow()}return Date.now()-k};e.prototype.contains=function(a){return this.items.hasOwnProperty(a.toString())};e.prototype.add=function(a){var p=a.toString();this.items.hasOwnProperty(p)||(this.items[p]=a,this.item_count++,this.cache_valid=!1);return this};e.prototype.remove=function(a){a=a.toString();this.items.hasOwnProperty(a)&&(delete this.items[a],this.item_count--,this.cache_valid=!1);return this};e.prototype.clear=function(){cr.wipe(this.items);this.item_count=0;this.values_cache.length=0;this.cache_valid=!0;return this};e.prototype.isEmpty=function(){return 0===this.item_count};e.prototype.count=function(){return this.item_count};e.prototype.update_cache=function(){if(!this.cache_valid){this.values_cache.length=this.item_count;var a,p=0;for(a in this.items)this.items.hasOwnProperty(a)&&(this.values_cache[p++]=this.items[a]);this.cache_valid=!0}};e.prototype.values=function(){this.update_cache();return this.values_cache.slice(0)};e.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=e;f.prototype.add=function(a){this.y=a-this.c;this.t=this.sum+this.y;this.c=this.t-this.sum-this.y;this.sum=this.t};f.prototype.reset=function(){this.sum=this.t=this.y=this.c=0};cr.KahanAdder=f;cr.regexp_escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};h.prototype.set_pts=function(a){this.pts_array=a;this.pts_count=a.length/2;this.pts_cache.length=a.length;this.cache_height=this.cache_width=-1;this.cache_angle=0};h.prototype.is_empty=function(){return!this.pts_array.length};h.prototype.set_from_quad=function(a,p,g,u,c){this.pts_cache.length=8;this.pts_count=4;var k=this.pts_cache;k[0]=a.tlx-p;k[1]=a.tly-g;k[2]=a.trx-p;k[3]=a.try_-g;k[4]=a.brx-p;k[5]=a.bry-g;k[6]=a.blx-p;k[7]=a.bly-g;this.cache_width=u;this.cache_height=c};h.prototype.set_from_poly=function(a){this.pts_count=a.pts_count;cr.shallowAssignArray(this.pts_cache,a.pts_cache)};h.prototype.cache_poly=function(a,p,g){if(this.cache_width!==a||this.cache_height!==p||this.cache_angle!==g){this.cache_width=a;this.cache_height=p;this.cache_angle=g;var u,c,k,s=0,m=1,f=this.pts_array,b=this.pts_cache;0!==g&&(s=Math.sin(g),m=Math.cos(g));g=0;for(u=this.pts_count;g<u;g++)c=f[2*g]*a,k=f[2*g+1]*p,b[2*g]=c*m-k*s,b[2*g+1]=k*m+c*s}};h.prototype.contains_pt=function(a,p){var g=this.pts_cache;if(a===g[0]&&p===g[1])return!0;var u,c,k,s=this.pts_count,m=g[0],f=m,b=g[1],l=b;for(u=1;u<s;u++)c=g[2*u],k=g[2*u+1],c<m&&(m=c),c>f&&(f=c),k<b&&(b=k),k>l&&(l=k);c=m-110;var b=b-101,f=f+131,l=l+120,d,e,r=0,h=0;for(u=0;u<s;u++)k=g[2*u],m=g[2*u+1],d=g[2*((u+1)%s)],e=g[2*((u+1)%s)+1],cr.segments_intersect(c,b,a,p,k,m,d,e)&&r++,cr.segments_intersect(f,l,a,p,k,m,d,e)&&h++;return 1===r%2||1===h%2};h.prototype.intersects_poly=function(a,p,g){var u=a.pts_cache,c=this.pts_cache;if(this.contains_pt(u[0]+p,u[1]+g)||a.contains_pt(c[0]-p,c[1]-g))return!0;var k,s,m,f,b,l,d,e,r,h,n,q;k=0;for(s=this.pts_count;k<s;k++)for(b=c[2*k],l=c[2*k+1],d=c[2*((k+1)%s)],e=c[2*((k+1)%s)+1],m=0,f=a.pts_count;m<f;m++)if(r=u[2*m]+p,h=u[2*m+1]+g,n=u[2*((m+1)%f)]+p,q=u[2*((m+1)%f)+1]+g,cr.segments_intersect(b,l,d,e,r,h,n,q))return!0;return!1};h.prototype.intersects_segment=function(a,p,g,u,c,k){var s=this.pts_cache;if(this.contains_pt(g-a,u-p))return!0;var m,f,b,l,d,e;m=0;for(f=this.pts_count;m<f;m++)if(b=s[2*m]+a,l=s[2*m+1]+p,d=s[2*((m+1)%f)]+a,e=s[2*((m+1)%f)+1]+p,cr.segments_intersect(g,u,c,k,b,l,d,e))return!0;return!1};cr.CollisionPoly=h;var c="lighter xor copy destination-over source-in destination-in source-out destination-out source-atop destination-atop".split(" ");cr.effectToCompositeOp=function(a){return 0>=a||11<=a?"source-over":c[a-1]};cr.setGLBlend=function(a,p,g){if(g)switch(a.srcBlend=g.ONE,a.destBlend=g.ONE_MINUS_SRC_ALPHA,p){case 1:a.srcBlend=g.ONE;a.destBlend=g.ONE;break;case 3:a.srcBlend=g.ONE;a.destBlend=g.ZERO;break;case 4:a.srcBlend=g.ONE_MINUS_DST_ALPHA;a.destBlend=g.ONE;break;case 5:a.srcBlend=g.DST_ALPHA;a.destBlend=g.ZERO;break;case 6:a.srcBlend=g.ZERO;a.destBlend=g.SRC_ALPHA;break;case 7:a.srcBlend=g.ONE_MINUS_DST_ALPHA;a.destBlend=g.ZERO;break;case 8:a.srcBlend=g.ZERO;a.destBlend=g.ONE_MINUS_SRC_ALPHA;break;case 9:a.srcBlend=g.DST_ALPHA;a.destBlend=g.ONE_MINUS_SRC_ALPHA;break;case 10:a.srcBlend=g.ONE_MINUS_DST_ALPHA,a.destBlend=g.SRC_ALPHA}};cr.round6dp=function(a){return Math.round(1E6*a)/1E6};var r={usage:"search",sensitivity:"accent"},n=!!"a".localeCompare,l=n&&0==="a".localeCompare("A",void 0,r),q=n&&0!=="a".localeCompare("\u00e1",void 0,r),v=n&&l&&q;cr.equals_nocase=function(a,p){return"string"!==typeof a||"string"!==typeof p||a.length!==p.length?!1:a===p?!0:v?0===a.localeCompare(p,void 0,r):a.toLowerCase()===p.toLowerCase()}})();var MatrixArray="undefined"!==typeof Float32Array?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(a){var b=new MatrixArray(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b};vec3.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};vec3.add=function(a,b,d){if(!d||a===d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d};vec3.subtract=function(a,b,d){if(!d||a===d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d};vec3.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};vec3.scale=function(a,b,d){if(!d||a===d)return a[0]*=b,a[1]*=b,a[2]*=b,a;d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d};vec3.normalize=function(a,b){b||(b=a);var d=a[0],e=a[1],f=a[2],h=Math.sqrt(d*d+e*e+f*f);if(h){if(1===h)return b[0]=d,b[1]=e,b[2]=f,b}else return b[0]=0,b[1]=0,b[2]=0,b;h=1/h;b[0]=d*h;b[1]=e*h;b[2]=f*h;return b};vec3.cross=function(a,b,d){d||(d=a);var e=a[0],f=a[1];a=a[2];var h=b[0],k=b[1];b=b[2];d[0]=f*b-a*k;d[1]=a*h-e*b;d[2]=e*k-f*h;return d};vec3.length=function(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*b+d*d+a*a)};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.direction=function(a,b,d){d||(d=a);var e=a[0]-b[0],f=a[1]-b[1];a=a[2]-b[2];b=Math.sqrt(e*e+f*f+a*a);if(!b)return d[0]=0,d[1]=0,d[2]=0,d;b=1/b;d[0]=e*b;d[1]=f*b;d[2]=a*b;return d};vec3.lerp=function(a,b,d,e){e||(e=a);e[0]=a[0]+d*(b[0]-a[0]);e[1]=a[1]+d*(b[1]-a[1]);e[2]=a[2]+d*(b[2]-a[2]);return e};vec3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};mat3.create=function(a){var b=new MatrixArray(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]);return b};mat3.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};mat3.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.transpose=function(a,b){if(!b||a===b){var d=a[1],e=a[2],f=a[5];a[1]=a[3];a[2]=a[6];a[3]=d;a[5]=a[7];a[6]=e;a[7]=f;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};mat3.toMat4=function(a,b){b||(b=mat4.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};mat3.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"};mat4.create=function(a){var b=new MatrixArray(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b};mat4.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};mat4.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.transpose=function(a,b){if(!b||a===b){var d=a[1],e=a[2],f=a[3],h=a[6],k=a[7],c=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=d;a[6]=a[9];a[7]=a[13];a[8]=e;a[9]=h;a[11]=a[14];a[12]=f;a[13]=k;a[14]=c;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};mat4.determinant=function(a){var b=a[0],d=a[1],e=a[2],f=a[3],h=a[4],k=a[5],c=a[6],r=a[7],n=a[8],l=a[9],q=a[10],v=a[11],t=a[12],p=a[13],g=a[14];a=a[15];return t*l*c*f-n*p*c*f-t*k*q*f+h*p*q*f+n*k*g*f-h*l*g*f-t*l*e*r+n*p*e*r+t*d*q*r-b*p*q*r-n*d*g*r+b*l*g*r+t*k*e*v-h*p*e*v-t*d*c*v+b*p*c*v+h*d*g*v-b*k*g*v-n*k*e*a+h*l*e*a+n*d*c*a-b*l*c*a-h*d*q*a+b*k*q*a};mat4.inverse=function(a,b){b||(b=a);var d=a[0],e=a[1],f=a[2],h=a[3],k=a[4],c=a[5],r=a[6],n=a[7],l=a[8],q=a[9],v=a[10],t=a[11],p=a[12],g=a[13],u=a[14],D=a[15],B=d*c-e*k,s=d*r-f*k,m=d*n-h*k,P=e*r-f*c,x=e*n-h*c,z=f*n-h*r,G=l*g-q*p,C=l*u-v*p,F=l*D-t*p,y=q*u-v*g,H=q*D-t*g,Q=v*D-t*u,w=1/(B*Q-s*H+m*y+P*F-x*C+z*G);b[0]=(c*Q-r*H+n*y)*w;b[1]=(-e*Q+f*H-h*y)*w;b[2]=(g*z-u*x+D*P)*w;b[3]=(-q*z+v*x-t*P)*w;b[4]=(-k*Q+r*F-n*C)*w;b[5]=(d*Q-f*F+h*C)*w;b[6]=(-p*z+u*m-D*s)*w;b[7]=(l*z-v*m+t*s)*w;b[8]=(k*H-c*F+n*G)*w;b[9]=(-d*H+e*F-h*G)*w;b[10]=(p*x-g*m+D*B)*w;b[11]=(-l*x+q*m-t*B)*w;b[12]=(-k*y+c*C-r*G)*w;b[13]=(d*y-e*C+f*G)*w;b[14]=(-p*P+g*s-u*B)*w;b[15]=(l*P-q*s+v*B)*w;return b};mat4.toRotationMat=function(a,b){b||(b=mat4.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};mat4.toMat3=function(a,b){b||(b=mat3.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};mat4.toInverseMat3=function(a,b){var d=a[0],e=a[1],f=a[2],h=a[4],k=a[5],c=a[6],r=a[8],n=a[9],l=a[10],q=l*k-c*n,v=-l*h+c*r,t=n*h-k*r,p=d*q+e*v+f*t;if(!p)return null;p=1/p;b||(b=mat3.create());b[0]=q*p;b[1]=(-l*e+f*n)*p;b[2]=(c*e-f*k)*p;b[3]=v*p;b[4]=(l*d-f*r)*p;b[5]=(-c*d+f*h)*p;b[6]=t*p;b[7]=(-n*d+e*r)*p;b[8]=(k*d-e*h)*p;return b};mat4.multiply=function(a,b,d){d||(d=a);var e=a[0],f=a[1],h=a[2],k=a[3],c=a[4],r=a[5],n=a[6],l=a[7],q=a[8],v=a[9],t=a[10],p=a[11],g=a[12],u=a[13],D=a[14];a=a[15];var B=b[0],s=b[1],m=b[2],P=b[3],x=b[4],z=b[5],G=b[6],C=b[7],F=b[8],y=b[9],H=b[10],Q=b[11],w=b[12],N=b[13],R=b[14];b=b[15];d[0]=B*e+s*c+m*q+P*g;d[1]=B*f+s*r+m*v+P*u;d[2]=B*h+s*n+m*t+P*D;d[3]=B*k+s*l+m*p+P*a;d[4]=x*e+z*c+G*q+C*g;d[5]=x*f+z*r+G*v+C*u;d[6]=x*h+z*n+G*t+C*D;d[7]=x*k+z*l+G*p+C*a;d[8]=F*e+y*c+H*q+Q*g;d[9]=F*f+y*r+H*v+Q*u;d[10]=F*h+y*n+H*t+Q*D;d[11]=F*k+y*l+H*p+Q*a;d[12]=w*e+N*c+R*q+b*g;d[13]=w*f+N*r+R*v+b*u;d[14]=w*h+N*n+R*t+b*D;d[15]=w*k+N*l+R*p+b*a;return d};mat4.multiplyVec3=function(a,b,d){d||(d=b);var e=b[0],f=b[1];b=b[2];d[0]=a[0]*e+a[4]*f+a[8]*b+a[12];d[1]=a[1]*e+a[5]*f+a[9]*b+a[13];d[2]=a[2]*e+a[6]*f+a[10]*b+a[14];return d};mat4.multiplyVec4=function(a,b,d){d||(d=b);var e=b[0],f=b[1],h=b[2];b=b[3];d[0]=a[0]*e+a[4]*f+a[8]*h+a[12]*b;d[1]=a[1]*e+a[5]*f+a[9]*h+a[13]*b;d[2]=a[2]*e+a[6]*f+a[10]*h+a[14]*b;d[3]=a[3]*e+a[7]*f+a[11]*h+a[15]*b;return d};mat4.translate=function(a,b,d){var e=b[0],f=b[1];b=b[2];var h,k,c,r,n,l,q,v,t,p,g,u;if(!d||a===d)return a[12]=a[0]*e+a[4]*f+a[8]*b+a[12],a[13]=a[1]*e+a[5]*f+a[9]*b+a[13],a[14]=a[2]*e+a[6]*f+a[10]*b+a[14],a[15]=a[3]*e+a[7]*f+a[11]*b+a[15],a;h=a[0];k=a[1];c=a[2];r=a[3];n=a[4];l=a[5];q=a[6];v=a[7];t=a[8];p=a[9];g=a[10];u=a[11];d[0]=h;d[1]=k;d[2]=c;d[3]=r;d[4]=n;d[5]=l;d[6]=q;d[7]=v;d[8]=t;d[9]=p;d[10]=g;d[11]=u;d[12]=h*e+n*f+t*b+a[12];d[13]=k*e+l*f+p*b+a[13];d[14]=c*e+q*f+g*b+a[14];d[15]=r*e+v*f+u*b+a[15];return d};mat4.scale=function(a,b,d){var e=b[0],f=b[1];b=b[2];if(!d||a===d)return a[0]*=e,a[1]*=e,a[2]*=e,a[3]*=e,a[4]*=f,a[5]*=f,a[6]*=f,a[7]*=f,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;d[0]=a[0]*e;d[1]=a[1]*e;d[2]=a[2]*e;d[3]=a[3]*e;d[4]=a[4]*f;d[5]=a[5]*f;d[6]=a[6]*f;d[7]=a[7]*f;d[8]=a[8]*b;d[9]=a[9]*b;d[10]=a[10]*b;d[11]=a[11]*b;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};mat4.rotate=function(a,b,d,e){var f=d[0],h=d[1];d=d[2];var k=Math.sqrt(f*f+h*h+d*d),c,r,n,l,q,v,t,p,g,u,D,B,s,m,P,x,z,G,C,F;if(!k)return null;1!==k&&(k=1/k,f*=k,h*=k,d*=k);c=Math.sin(b);r=Math.cos(b);n=1-r;b=a[0];k=a[1];l=a[2];q=a[3];v=a[4];t=a[5];p=a[6];g=a[7];u=a[8];D=a[9];B=a[10];s=a[11];m=f*f*n+r;P=h*f*n+d*c;x=d*f*n-h*c;z=f*h*n-d*c;G=h*h*n+r;C=d*h*n+f*c;F=f*d*n+h*c;f=h*d*n-f*c;h=d*d*n+r;e?a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]):e=a;e[0]=b*m+v*P+u*x;e[1]=k*m+t*P+D*x;e[2]=l*m+p*P+B*x;e[3]=q*m+g*P+s*x;e[4]=b*z+v*G+u*C;e[5]=k*z+t*G+D*C;e[6]=l*z+p*G+B*C;e[7]=q*z+g*G+s*C;e[8]=b*F+v*f+u*h;e[9]=k*F+t*f+D*h;e[10]=l*F+p*f+B*h;e[11]=q*F+g*f+s*h;return e};mat4.rotateX=function(a,b,d){var e=Math.sin(b);b=Math.cos(b);var f=a[4],h=a[5],k=a[6],c=a[7],r=a[8],n=a[9],l=a[10],q=a[11];d?a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[4]=f*b+r*e;d[5]=h*b+n*e;d[6]=k*b+l*e;d[7]=c*b+q*e;d[8]=f*-e+r*b;d[9]=h*-e+n*b;d[10]=k*-e+l*b;d[11]=c*-e+q*b;return d};mat4.rotateY=function(a,b,d){var e=Math.sin(b);b=Math.cos(b);var f=a[0],h=a[1],k=a[2],c=a[3],r=a[8],n=a[9],l=a[10],q=a[11];d?a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=f*b+r*-e;d[1]=h*b+n*-e;d[2]=k*b+l*-e;d[3]=c*b+q*-e;d[8]=f*e+r*b;d[9]=h*e+n*b;d[10]=k*e+l*b;d[11]=c*e+q*b;return d};mat4.rotateZ=function(a,b,d){var e=Math.sin(b);b=Math.cos(b);var f=a[0],h=a[1],k=a[2],c=a[3],r=a[4],n=a[5],l=a[6],q=a[7];d?a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=f*b+r*e;d[1]=h*b+n*e;d[2]=k*b+l*e;d[3]=c*b+q*e;d[4]=f*-e+r*b;d[5]=h*-e+n*b;d[6]=k*-e+l*b;d[7]=c*-e+q*b;return d};mat4.frustum=function(a,b,d,e,f,h,k){k||(k=mat4.create());var c=b-a,r=e-d,n=h-f;k[0]=2*f/c;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2*f/r;k[6]=0;k[7]=0;k[8]=(b+a)/c;k[9]=(e+d)/r;k[10]=-(h+f)/n;k[11]=-1;k[12]=0;k[13]=0;k[14]=-(2*h*f)/n;k[15]=0;return k};mat4.perspective=function(a,b,d,e,f){a=d*Math.tan(a*Math.PI/360);b*=a;return mat4.frustum(-b,b,-a,a,d,e,f)};mat4.ortho=function(a,b,d,e,f,h,k){k||(k=mat4.create());var c=b-a,r=e-d,n=h-f;k[0]=2/c;k[1]=0;k[2]=0;k[3]=0;k[4]=0;k[5]=2/r;k[6]=0;k[7]=0;k[8]=0;k[9]=0;k[10]=-2/n;k[11]=0;k[12]=-(a+b)/c;k[13]=-(e+d)/r;k[14]=-(h+f)/n;k[15]=1;return k};mat4.lookAt=function(a,b,d,e){e||(e=mat4.create());var f,h,k,c,r,n,l,q,v=a[0],t=a[1];a=a[2];h=d[0];k=d[1];f=d[2];d=b[1];n=b[2];if(v===b[0]&&t===d&&a===n)return mat4.identity(e);d=v-b[0];n=t-b[1];l=a-b[2];q=1/Math.sqrt(d*d+n*n+l*l);d*=q;n*=q;l*=q;b=k*l-f*n;f=f*d-h*l;h=h*n-k*d;(q=Math.sqrt(b*b+f*f+h*h))?(q=1/q,b*=q,f*=q,h*=q):h=f=b=0;k=n*h-l*f;c=l*b-d*h;r=d*f-n*b;(q=Math.sqrt(k*k+c*c+r*r))?(q=1/q,k*=q,c*=q,r*=q):r=c=k=0;e[0]=b;e[1]=k;e[2]=d;e[3]=0;e[4]=f;e[5]=c;e[6]=n;e[7]=0;e[8]=h;e[9]=r;e[10]=l;e[11]=0;e[12]=-(b*v+f*t+h*a);e[13]=-(k*v+c*t+r*a);e[14]=-(d*v+n*t+l*a);e[15]=1;return e};mat4.fromRotationTranslation=function(a,b,d){d||(d=mat4.create());var e=a[0],f=a[1],h=a[2],k=a[3],c=e+e,r=f+f,n=h+h;a=e*c;var l=e*r,e=e*n,q=f*r,f=f*n,h=h*n,c=c*k,r=r*k,k=k*n;d[0]=1-(q+h);d[1]=l+k;d[2]=e-r;d[3]=0;d[4]=l-k;d[5]=1-(a+h);d[6]=f+c;d[7]=0;d[8]=e+r;d[9]=f-c;d[10]=1-(a+q);d[11]=0;d[12]=b[0];d[13]=b[1];d[14]=b[2];d[15]=1;return d};mat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"};quat4.create=function(a){var b=new MatrixArray(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b};quat4.set=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};quat4.calculateW=function(a,b){var d=a[0],e=a[1],f=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-d*d-e*e-f*f)),a;b[0]=d;b[1]=e;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-d*d-e*e-f*f));return b};quat4.inverse=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};quat4.length=function(a){var b=a[0],d=a[1],e=a[2];a=a[3];return Math.sqrt(b*b+d*d+e*e+a*a)};quat4.normalize=function(a,b){b||(b=a);var d=a[0],e=a[1],f=a[2],h=a[3],k=Math.sqrt(d*d+e*e+f*f+h*h);if(0===k)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;k=1/k;b[0]=d*k;b[1]=e*k;b[2]=f*k;b[3]=h*k;return b};quat4.multiply=function(a,b,d){d||(d=a);var e=a[0],f=a[1],h=a[2];a=a[3];var k=b[0],c=b[1],r=b[2];b=b[3];d[0]=e*b+a*k+f*r-h*c;d[1]=f*b+a*c+h*k-e*r;d[2]=h*b+a*r+e*c-f*k;d[3]=a*b-e*k-f*c-h*r;return d};quat4.multiplyVec3=function(a,b,d){d||(d=b);var e=b[0],f=b[1],h=b[2];b=a[0];var k=a[1],c=a[2];a=a[3];var r=a*e+k*h-c*f,n=a*f+c*e-b*h,l=a*h+b*f-k*e,e=-b*e-k*f-c*h;d[0]=r*a+e*-b+n*-c-l*-k;d[1]=n*a+e*-k+l*-b-r*-c;d[2]=l*a+e*-c+r*-k-n*-b;return d};quat4.toMat3=function(a,b){b||(b=mat3.create());var d=a[0],e=a[1],f=a[2],h=a[3],k=d+d,c=e+e,r=f+f,n=d*k,l=d*c,d=d*r,q=e*c,e=e*r,f=f*r,k=k*h,c=c*h,h=h*r;b[0]=1-(q+f);b[1]=l+h;b[2]=d-c;b[3]=l-h;b[4]=1-(n+f);b[5]=e+k;b[6]=d+c;b[7]=e-k;b[8]=1-(n+q);return b};quat4.toMat4=function(a,b){b||(b=mat4.create());var d=a[0],e=a[1],f=a[2],h=a[3],k=d+d,c=e+e,r=f+f,n=d*k,l=d*c,d=d*r,q=e*c,e=e*r,f=f*r,k=k*h,c=c*h,h=h*r;b[0]=1-(q+f);b[1]=l+h;b[2]=d-c;b[3]=0;b[4]=l-h;b[5]=1-(n+f);b[6]=e+k;b[7]=0;b[8]=d+c;b[9]=e-k;b[10]=1-(n+q);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};quat4.slerp=function(a,b,d,e){e||(e=a);var f=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],h,k;if(1<=Math.abs(f))return e!==a&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3]),e;h=Math.acos(f);k=Math.sqrt(1-f*f);if(0.001>Math.abs(k))return e[0]=0.5*a[0]+0.5*b[0],e[1]=0.5*a[1]+0.5*b[1],e[2]=0.5*a[2]+0.5*b[2],e[3]=0.5*a[3]+0.5*b[3],e;f=Math.sin((1-d)*h)/k;d=Math.sin(d*h)/k;e[0]=a[0]*f+b[0]*d;e[1]=a[1]*f+b[1]*d;e[2]=a[2]*f+b[2]*d;e[3]=a[3]*f+b[3]*d;return e};quat4.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};(function(){function a(a,c){this.height=this.width=0;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=a;this.initState()}function b(a,c,f){this.gl=a;this.shaderProgram=c;this.name=f;this.locAPos=a.getAttribLocation(c,"aPos");this.locATex=a.getAttribLocation(c,"aTex");this.locMatP=a.getUniformLocation(c,"matP");this.locMatMV=a.getUniformLocation(c,"matMV");this.locOpacity=a.getUniformLocation(c,"opacity");this.locSamplerFront=a.getUniformLocation(c,"samplerFront");this.locSamplerBack=a.getUniformLocation(c,"samplerBack");this.locDestStart=a.getUniformLocation(c,"destStart");this.locDestEnd=a.getUniformLocation(c,"destEnd");this.locSeconds=a.getUniformLocation(c,"seconds");this.locPixelWidth=a.getUniformLocation(c,"pixelWidth");this.locPixelHeight=a.getUniformLocation(c,"pixelHeight");this.locLayerScale=a.getUniformLocation(c,"layerScale");this.locOpacity&&a.uniform1f(this.locOpacity,1);this.locSamplerFront&&a.uniform1i(this.locSamplerFront,0);this.locSamplerBack&&a.uniform1i(this.locSamplerBack,1);this.locDestStart&&a.uniform2f(this.locDestStart,0,0);this.locDestEnd&&a.uniform2f(this.locDestEnd,1,1);this.hasCurrentMatMV=!1}function d(a,c){this.type=a;this.glwrap=c;this.gl=c.gl;this.indexCount=this.startIndex=this.opacityParam=0;this.mat4param=this.texParam=null;this.shaderParams=[];cr.seal(this)}function e(a){--a;for(var c=1;32>c;c<<=1)a|=a>>c;return a+1}a.prototype.initState=function(){var a=this.gl,c;this.lastOpacity=1;this.lastTexture=null;this.currentOpacity=1;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);this.lastSrcBlend=a.ONE;this.lastDestBlend=a.ONE_MINUS_SRC_ALPHA;this.pointBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer);this.vertexBuffers=Array(4);this.texcoordBuffers=Array(4);for(c=0;4>c;c++)this.vertexBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[c]),this.texcoordBuffers[c]=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[c]);this.curBuffer=0;this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);this.vertexData=new Float32Array(16E3);this.texcoordData=new Float32Array(16E3);this.pointData=new Float32Array(32E3);for(var f=new Uint16Array(12E3),b=c=0;12E3>c;)f[c++]=b,f[c++]=b+1,f[c++]=b+2,f[c++]=b,f[c++]=b+2,f[c++]=b+3,b+=4;a.bufferData(a.ELEMENT_ARRAY_BUFFER,f,a.STATIC_DRAW);this.pointPtr=this.vertexPtr=0;this.shaderPrograms=[];c=this.createShaderProgram({src:"varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}"},"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}","<default>");this.shaderPrograms.push(c);c=this.createShaderProgram({src:"uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}"},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}","<point>");this.shaderPrograms.push(c);for(var l in cr.shaders)cr.shaders.hasOwnProperty(l)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[l],"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}",l));a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.currentProgram=this.lastProgram=-1;this.currentShader=null;this.fbo=a.createFramebuffer();this.renderToTex=null;this.tmpVec3=vec3.create([0,0,0]);a=a.getParameter(a.ALIASED_POINT_SIZE_RANGE);this.minPointSize=a[0];this.maxPointSize=a[1];this.switchProgram(0);cr.seal(this)};a.prototype.createShaderProgram=function(a,c,f){var d=this.gl,l=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(l,a.src);d.compileShader(l);if(!d.getShaderParameter(l,d.COMPILE_STATUS))return d.deleteShader(l),null;var e=d.createShader(d.VERTEX_SHADER);d.shaderSource(e,c);d.compileShader(e);if(!d.getShaderParameter(e,d.COMPILE_STATUS))return d.deleteShader(l),d.deleteShader(e),null;c=d.createProgram();d.attachShader(c,l);d.attachShader(c,e);d.linkProgram(c);if(!d.getProgramParameter(c,d.LINK_STATUS))return d.deleteShader(l),d.deleteShader(e),d.deleteProgram(c),null;d.useProgram(c);d.validateProgram(c);d.deleteShader(l);d.deleteShader(e);f=new b(d,c,f);f.extendBoxHorizontal=a.extendBoxHorizontal||0;f.extendBoxVertical=a.extendBoxVertical||0;f.crossSampling=!!a.crossSampling;f.animated=!!a.animated;f.parameters=a.parameters||[];a=0;for(l=f.parameters.length;a<l;a++)f.parameters[a][1]=d.getUniformLocation(c,f.parameters[a][0]),d.uniform1f(f.parameters[a][1],0);cr.seal(f);return f};a.prototype.getShaderIndex=function(a){var c,f;c=0;for(f=this.shaderPrograms.length;c<f;c++)if(this.shaderPrograms[c].name===a)return c;return-1};a.prototype.project=function(a,c,f){var b=[0,0,this.width,this.height],l=this.matMV,d=this.matP,e=[0,0,0,0,0,0,0,0];e[0]=l[0]*a+l[4]*c+l[12];e[1]=l[1]*a+l[5]*c+l[13];e[2]=l[2]*a+l[6]*c+l[14];e[3]=l[3]*a+l[7]*c+l[15];e[4]=d[0]*e[0]+d[4]*e[1]+d[8]*e[2]+d[12]*e[3];e[5]=d[1]*e[0]+d[5]*e[1]+d[9]*e[2]+d[13]*e[3];e[6]=d[2]*e[0]+d[6]*e[1]+d[10]*e[2]+d[14]*e[3];e[7]=-e[2];0!==e[7]&&(e[7]=1/e[7],e[4]*=e[7],e[5]*=e[7],e[6]*=e[7],f[0]=(0.5*e[4]+0.5)*b[2]+b[0],f[1]=(0.5*e[5]+0.5)*b[3]+b[1])};a.prototype.setSize=function(a,c,f){if(this.width!==a||this.height!==c||f){this.endBatch();this.width=a;this.height=c;this.gl.viewport(0,0,a,c);mat4.perspective(45,a/c,1,1E3,this.matP);mat4.lookAt(this.cam,this.look,this.up,this.matMV);a=[0,0];c=[0,0];this.project(0,0,a);this.project(1,1,c);this.worldScale[0]=1/(c[0]-a[0]);this.worldScale[1]=-1/(c[1]-a[1]);a=0;for(c=this.shaderPrograms.length;a<c;a++)f=this.shaderPrograms[a],f.hasCurrentMatMV=!1,f.locMatP&&(this.gl.useProgram(f.shaderProgram),this.gl.uniformMatrix4fv(f.locMatP,!1,this.matP));this.gl.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.lastTexture=null}};a.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};a.prototype.translate=function(a,c){if(0!==a||0!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3)};a.prototype.scale=function(a,c){if(1!==a||1!==c)this.tmpVec3[0]=a,this.tmpVec3[1]=c,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3)};a.prototype.rotateZ=function(a){0!==a&&mat4.rotateZ(this.matMV,a)};a.prototype.updateModelView=function(){for(var a=!1,c=0;16>c;c++)if(this.lastMV[c]!==this.matMV[c]){a=!0;break}a&&(a=this.pushBatch(),a.type=5,a.mat4param?mat4.set(this.matMV,a.mat4param):a.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasPointBatchTop=this.hasQuadBatchTop=!1)};d.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};d.prototype.doSetOpacity=function(){var a=this.opacityParam,c=this.glwrap;c.currentOpacity=a;c=c.currentShader;c.locOpacity&&this.gl.uniform1f(c.locOpacity,a)};d.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,2*this.startIndex)};d.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};d.prototype.doUpdateModelView=function(){var a,c,f,b=this.glwrap.shaderPrograms,l=this.glwrap.currentProgram;a=0;for(c=b.length;a<c;a++)f=b[a],a===l&&f.locMatMV?(this.gl.uniformMatrix4fv(f.locMatMV,!1,this.mat4param),f.hasCurrentMatMV=!0):f.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)};d.prototype.doRenderToTexture=function(){var a=this.gl,c=this.glwrap;this.texParam?(a.bindFramebuffer(a.FRAMEBUFFER,c.fbo),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texParam,0)):(a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null,0),a.bindFramebuffer(a.FRAMEBUFFER,null))};d.prototype.doClear=function(){var a=this.gl;0===this.startIndex?(a.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clear(a.COLOR_BUFFER_BIT)):(a.enable(a.SCISSOR_TEST),a.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),a.clearColor(0,0,0,0),a.clear(this.gl.COLOR_BUFFER_BIT),a.disable(a.SCISSOR_TEST))};d.prototype.doPoints=function(){var a=this.gl,c=this.glwrap,f=c.shaderPrograms[1];a.useProgram(f.shaderProgram);!f.hasCurrentMatMV&&f.locMatMV&&(a.uniformMatrix4fv(f.locMatMV,!1,c.currentMV),f.hasCurrentMatMV=!0);a.enableVertexAttribArray(f.locAPos);a.bindBuffer(a.ARRAY_BUFFER,c.pointBuffer);a.vertexAttribPointer(f.locAPos,4,a.FLOAT,!1,0,0);a.drawArrays(a.POINTS,this.startIndex/4,this.indexCount);f=c.currentShader;a.useProgram(f.shaderProgram);0<=f.locAPos&&(a.enableVertexAttribArray(f.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(f.locAPos,2,a.FLOAT,!1,0,0));0<=f.locATex&&(a.enableVertexAttribArray(f.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(f.locATex,2,a.FLOAT,!1,0,0))};d.prototype.doSetProgram=function(){var a=this.gl,c=this.glwrap,f=c.shaderPrograms[this.startIndex];c.currentProgram=this.startIndex;c.currentShader=f;a.useProgram(f.shaderProgram);!f.hasCurrentMatMV&&f.locMatMV&&(a.uniformMatrix4fv(f.locMatMV,!1,c.currentMV),f.hasCurrentMatMV=!0);f.locOpacity&&a.uniform1f(f.locOpacity,c.currentOpacity);0<=f.locAPos&&(a.enableVertexAttribArray(f.locAPos),a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffers[c.curBuffer]),a.vertexAttribPointer(f.locAPos,2,a.FLOAT,!1,0,0));0<=f.locATex&&(a.enableVertexAttribArray(f.locATex),a.bindBuffer(a.ARRAY_BUFFER,c.texcoordBuffers[c.curBuffer]),a.vertexAttribPointer(f.locATex,2,a.FLOAT,!1,0,0))};d.prototype.doSetProgramParameters=function(){var a,c,f=this.glwrap.currentShader,b=this.gl;f.locSamplerBack&&(b.activeTexture(b.TEXTURE1),b.bindTexture(b.TEXTURE_2D,this.texParam),b.activeTexture(b.TEXTURE0));f.locPixelWidth&&b.uniform1f(f.locPixelWidth,this.mat4param[0]);f.locPixelHeight&&b.uniform1f(f.locPixelHeight,this.mat4param[1]);f.locDestStart&&b.uniform2f(f.locDestStart,this.mat4param[2],this.mat4param[3]);f.locDestEnd&&b.uniform2f(f.locDestEnd,this.mat4param[4],this.mat4param[5]);f.locLayerScale&&b.uniform1f(f.locLayerScale,this.mat4param[6]);f.locSeconds&&b.uniform1f(f.locSeconds,cr.performance_now()/1E3);if(f.parameters.length)for(a=0,c=f.parameters.length;a<c;a++)b.uniform1f(f.parameters[a][1],this.shaderParams[a])};a.prototype.pushBatch=function(){this.batchPtr===this.batch.length&&this.batch.push(new d(0,this));return this.batch[this.batchPtr++]};a.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var a=this.gl;0<this.pointPtr&&(a.bindBuffer(a.ARRAY_BUFFER,this.pointBuffer),a.bufferData(a.ARRAY_BUFFER,this.pointData.subarray(0,this.pointPtr),a.STREAM_DRAW),c&&(0<=c.locAPos&&"<point>"===c.name)&&a.vertexAttribPointer(c.locAPos,4,a.FLOAT,!1,0,0));if(0<this.vertexPtr){var c=this.currentShader;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);a.bufferData(a.ARRAY_BUFFER,this.vertexData.subarray(0,this.vertexPtr),a.STREAM_DRAW);c&&(0<=c.locAPos&&"<point>"!==c.name)&&a.vertexAttribPointer(c.locAPos,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);a.bufferData(a.ARRAY_BUFFER,this.texcoordData.subarray(0,this.vertexPtr),a.STREAM_DRAW);c&&(0<=c.locATex&&"<point>"!==c.name)&&a.vertexAttribPointer(c.locATex,2,a.FLOAT,!1,0,0)}for(var f,a=0,c=this.batchPtr;a<c;a++)switch(f=this.batch[a],f.type){case 1:f.doQuad();break;case 2:f.doSetTexture();break;case 3:f.doSetOpacity();break;case 4:f.doSetBlend();break;case 5:f.doUpdateModelView();break;case 6:f.doRenderToTexture();break;case 7:f.doClear();break;case 8:f.doPoints();break;case 9:f.doSetProgram();break;case 10:f.doSetProgramParameters()}this.pointPtr=this.vertexPtr=this.batchPtr=0;this.hasPointBatchTop=this.hasQuadBatchTop=!1;this.curBuffer++;4<=this.curBuffer&&(this.curBuffer=0)}};a.prototype.setOpacity=function(a){if(a!==this.lastOpacity){var c=this.pushBatch();c.type=3;this.lastOpacity=c.opacityParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};a.prototype.setTexture=function(a){if(a!==this.lastTexture){var c=this.pushBatch();c.type=2;this.lastTexture=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};a.prototype.setBlend=function(a,c){if(a!==this.lastSrcBlend||c!==this.lastDestBlend){var f=this.pushBatch();f.type=4;f.startIndex=a;f.indexCount=c;this.lastSrcBlend=a;this.lastDestBlend=c;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};a.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};a.prototype.quad=function(a,c,f,b,l,d,e,h){15992<=this.vertexPtr&&this.endBatch();var p=this.vertexPtr,g=this.vertexData,u=this.texcoordData;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var D=this.pushBatch();D.type=1;D.startIndex=3*(p/4);D.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}g[p]=a;u[p++]=0;g[p]=c;u[p++]=0;g[p]=f;u[p++]=1;g[p]=b;u[p++]=0;g[p]=l;u[p++]=1;g[p]=d;u[p++]=1;g[p]=e;u[p++]=0;g[p]=h;u[p++]=1;this.vertexPtr=p};a.prototype.quadTex=function(a,c,f,b,l,d,e,h,p){15992<=this.vertexPtr&&this.endBatch();var g=this.vertexPtr,u=this.vertexData,D=this.texcoordData;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var B=this.pushBatch();B.type=1;B.startIndex=3*(g/4);B.indexCount=6;this.hasQuadBatchTop=!0;this.hasPointBatchTop=!1}u[g]=a;D[g++]=p.left;u[g]=c;D[g++]=p.top;u[g]=f;D[g++]=p.right;u[g]=b;D[g++]=p.top;u[g]=l;D[g++]=p.right;u[g]=d;D[g++]=p.bottom;u[g]=e;D[g++]=p.left;u[g]=h;D[g++]=p.bottom;this.vertexPtr=g};a.prototype.point=function(a,c,f,b){7996<=this.pointPtr&&this.endBatch();var l=this.pointPtr,d=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var e=this.pushBatch();e.type=8;e.startIndex=l;e.indexCount=1;this.hasPointBatchTop=!0;this.hasQuadBatchTop=!1}d[l++]=a;d[l++]=c;d[l++]=f;d[l++]=b;this.pointPtr=l};a.prototype.switchProgram=function(a){if(this.lastProgram!==a){if(!this.shaderPrograms[a]){if(0===this.lastProgram)return;a=0}var c=this.pushBatch();c.type=9;this.lastProgram=c.startIndex=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};a.prototype.programUsesDest=function(a){a=this.shaderPrograms[a];return!(!a.locDestStart&&!a.locDestEnd)};a.prototype.programUsesCrossSampling=function(a){return this.shaderPrograms[a].crossSampling};a.prototype.programExtendsBox=function(a){a=this.shaderPrograms[a];return 0!==a.extendBoxHorizontal||0!==a.extendBoxVertical};a.prototype.getProgramBoxExtendHorizontal=function(a){return this.shaderPrograms[a].extendBoxHorizontal};a.prototype.getProgramBoxExtendVertical=function(a){return this.shaderPrograms[a].extendBoxVertical};a.prototype.getProgramParameterType=function(a,c){return this.shaderPrograms[a].parameters[c][2]};a.prototype.programIsAnimated=function(a){return this.shaderPrograms[a].animated};a.prototype.setProgramParameters=function(a,c,f,b,d,e,h,t,p){var g=this.shaderPrograms[this.lastProgram];if(g.locPixelWidth||g.locPixelHeight||g.locSeconds||g.locSamplerBack||g.locDestStart||g.locDestEnd||g.locLayerScale||p.length){g=this.pushBatch();g.type=10;g.mat4param?mat4.set(this.matMV,g.mat4param):g.mat4param=mat4.create();g.mat4param[0]=c;g.mat4param[1]=f;g.mat4param[2]=b;g.mat4param[3]=d;g.mat4param[4]=e;g.mat4param[5]=h;g.mat4param[6]=t;g.texParam=a;if(p.length)for(g.shaderParams.length=p.length,a=0,c=p.length;a<c;a++)g.shaderParams[a]=p[a];this.hasPointBatchTop=this.hasQuadBatchTop=!1}};a.prototype.clear=function(a,c,f,b){var d=this.pushBatch();d.type=7;d.startIndex=0;d.mat4param||(d.mat4param=mat4.create());d.mat4param[0]=a;d.mat4param[1]=c;d.mat4param[2]=f;d.mat4param[3]=b;this.hasPointBatchTop=this.hasQuadBatchTop=!1};a.prototype.clearRect=function(a,c,f,b){var d=this.pushBatch();d.type=7;d.startIndex=1;d.mat4param||(d.mat4param=mat4.create());d.mat4param[0]=a;d.mat4param[1]=c;d.mat4param[2]=f;d.mat4param[3]=b;this.hasPointBatchTop=this.hasQuadBatchTop=!1};a.prototype.present=function(){this.endBatch();this.gl.flush()};var f=[],h={};a.prototype.loadTexture=function(a,c,b,d,l){c=!!c;b=!!b;var q=a.src+","+c+","+b+(c?","+l:""),v=null;if("undefined"!==typeof a.src&&h.hasOwnProperty(q))return v=h[q],v.c2refcount++,v;this.endBatch();var t=this.gl,p=cr.isPOT(a.width)&&cr.isPOT(a.height),v=t.createTexture();t.bindTexture(t.TEXTURE_2D,v);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var g=t.RGBA,u=t.RGBA,D=t.UNSIGNED_BYTE;if(d)switch(d){case 1:u=g=t.RGB;break;case 2:D=t.UNSIGNED_SHORT_4_4_4_4;break;case 3:D=t.UNSIGNED_SHORT_5_5_5_1;break;case 4:u=g=t.RGB,D=t.UNSIGNED_SHORT_5_6_5}!p&&c?(d=document.createElement("canvas"),d.width=e(a.width),d.height=e(a.height),d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height),t.texImage2D(t.TEXTURE_2D,0,g,u,D,d)):t.texImage2D(t.TEXTURE_2D,0,g,u,D,a);c?"repeat-x"===l?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)):("repeat-y"===l?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE));b?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),p?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST));t.bindTexture(t.TEXTURE_2D,null);this.lastTexture=null;v.c2width=a.width;v.c2height=a.height;v.c2refcount=1;v.c2texkey=q;f.push(v);return h[q]=v};a.prototype.createEmptyTexture=function(a,c,b,d){this.endBatch();var e=this.gl,h=e.createTexture();e.bindTexture(e.TEXTURE_2D,h);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a,c,0,e.RGBA,d?e.UNSIGNED_SHORT_4_4_4_4:e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,b?e.LINEAR:e.NEAREST);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,b?e.LINEAR:e.NEAREST);e.bindTexture(e.TEXTURE_2D,null);this.lastTexture=null;h.c2width=a;h.c2height=c;f.push(h);return h};a.prototype.videoToTexture=function(a,c,f){this.endBatch();var b=this.gl;b.bindTexture(b.TEXTURE_2D,c);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,f?b.UNSIGNED_SHORT_4_4_4_4:b.UNSIGNED_BYTE,a);b.bindTexture(b.TEXTURE_2D,null);this.lastTexture=null};a.prototype.deleteTexture=function(a){a&&("undefined"!==typeof a.c2refcount&&1<a.c2refcount?a.c2refcount--:(this.endBatch(),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture=null,cr.arrayFindRemove(f,a),"undefined"!==typeof a.c2texkey&&delete h[a.c2texkey],this.gl.deleteTexture(a)))};a.prototype.estimateVRAM=function(){var a=8*this.width*this.height,c,b,d;c=0;for(b=f.length;c<b;c++)d=f[c],a+=4*d.c2width*d.c2height;return a};a.prototype.textureCount=function(){return f.length};a.prototype.setRenderingToTexture=function(a){if(a!==this.renderToTex){var c=this.pushBatch();c.type=6;this.renderToTex=c.texParam=a;this.hasPointBatchTop=this.hasQuadBatchTop=!1}};cr.GLWrap=a})();(function(){function a(a){if(a&&(a.getContext||a.dc)&&!a.c2runtime){a.c2runtime=this;var g=this;this.isPhoneGap="undefined"!==typeof window.device&&("undefined"!==typeof window.device.cordova||"undefined"!==typeof window.device.phonegap);this.isDirectCanvas=!!a.dc;this.isAppMobi="undefined"!==typeof window.AppMobi||this.isDirectCanvas;if(this.isCocoonJs=!!window.c2cocoonjs)CocoonJS.App.onSuspended.addEventListener(function(){g.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){g.setSuspended(!1)});this.isDomFree=this.isDirectCanvas||this.isCocoonJs;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen;this.isIE=/msie/i.test(navigator.userAgent);this.isiPhone=/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent);this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad;this.isChrome=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent);this.isSafari=!this.isChrome&&/safari/i.test(navigator.userAgent);this.isWindows=/windows/i.test(navigator.userAgent);this.isNodeWebkit="undefined"!==typeof window.c2nodewebkit;this.isArcade="undefined"!==typeof window.is_scirra_arcade;this.isWindows8App=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.isWindowsPhone8=!("undefined"===typeof window.c2isWindowsPhone8||!window.c2isWindowsPhone8);this.isBlackberry10=!("undefined"===typeof window.c2isBlackberry10||!window.c2isBlackberry10);this.devicePixelRatio=1;this.isMobile=this.isPhoneGap||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isBlackberry10||this.isTizen;this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet)/i.test(navigator.userAgent));"undefined"===typeof cr_is_preview||(this.isNodeWebkit||"?nw"!==window.location.search&&!/nodewebkit/i.test(navigator.userAgent))||(this.isNodeWebkit=!0);this.isDebug="undefined"!==typeof cr_is_preview&&-1<window.location.search.indexOf("debug");this.canvas=a;this.canvasdiv=document.getElementById("c2canvasdiv");this.ctx=this.glwrap=this.gl=null;this.canvas.oncontextmenu=function(a){a.preventDefault&&a.preventDefault();return!1};this.canvas.onselectstart=function(a){a.preventDefault&&a.preventDefault();return!1};this.isDirectCanvas&&(window.c2runtime=this);this.isNodeWebkit&&(window.ondragover=function(a){a.preventDefault();return!1},window.ondrop=function(a){a.preventDefault();return!1});this.width=a.width;this.height=a.height;this.lastwidth=this.width;this.lastheight=this.height;this.redraw=!0;this.isSuspended=!1;Date.now||(Date.now=function(){return+new Date});this.plugins=[];this.types={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.deathRow=new cr.ObjectSet;this.isInClearDeathRow=!1;this.isInOnDestroy=0;this.isRunningEvents=!1;this.createRow=[];this.isLoadingState=!1;this.lastSaveJson=this.loadFromJson=this.loadFromSlot=this.saveToSlot="";this.suspendDrawing=this.signalledContinuousPreview=!1;this.zeroDtCount=this.cpuutilisation=this.logictime=this.dt1=this.dt=0;this.timescale=1;this.kahanTime=new cr.KahanAdder;this.last_tick_time=0;this.measuring_dt=!0;this.objectcount=this.framecount=this.execcount=this.tickcount=this.last_fps_time=this.fps=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=[[]];this.trigger_depth=this.localvar_stack_index=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_puid=this.next_uid=0;this.layout_first_tick=!0;this.family_count=0;this.suspend_events=[];this.timeout_id=this.raf_id=0;this.isloading=!0;this.loadingprogress=0;this.isNodeFullscreen=!1;this.stackLocalCount=0;this.had_a_click=!1;this.objects_to_tick=new cr.ObjectSet;this.objects_to_tick2=new cr.ObjectSet;this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.activeGroups={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.layout_tex=this.layer_tex=this.layer_ctx=this.layer_canvas=this.running_layout=null;this.uses_background_blending=this.is_WebGL_context_lost=!1;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid={};this.snapshotCanvas=this.loaderlogo=null;this.snapshotData="";this.load();this.devicePixelRatio=(this.isRetina=!this.isDomFree&&this.useiOSRetina&&(this.isiOS||this.isTizen))?window.devicePixelRatio||1:1;this.ClearDeathRow();var u;"undefined"!==typeof jQuery&&0<this.fullscreen_mode&&this.setSize(jQuery(window).width(),jQuery(window).height());try{if(this.enableWebGL&&(this.isCocoonJs||!this.isDomFree)){u={depth:!1,antialias:!this.isMobile};var c=!0;if(this.isChrome&&this.isWindows){var f=document.createElement("canvas");"OES_texture_float,OES_standard_derivatives,WEBKIT_WEBGL_lose_context"===(f.getContext("webgl",u)||f.getContext("experimental-webgl",u)).getSupportedExtensions().toString()&&(c=!1)}c&&(this.gl=a.getContext("webgl",u)||a.getContext("experimental-webgl",u))}}catch(s){}if(this.gl){this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(a){return!1},this.overlay_canvas.onselectstart=function(a){return!1},this.overlay_canvas.width=a.width,this.overlay_canvas.height=a.height,this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d"));this.glwrap=new cr.GLWrap(this.gl,this.isMobile);this.glwrap.setSize(a.width,a.height);this.ctx=null;this.canvas.addEventListener("webglcontextlost",function(a){a.preventDefault();g.onContextLost();window.cr_setSuspended(!0)},!1);this.canvas.addEventListener("webglcontextrestored",function(a){g.glwrap.initState();g.glwrap.setSize(g.glwrap.width,g.glwrap.height,!0);g.layer_tex=null;g.layout_tex=null;g.fx_tex[0]=null;g.fx_tex[1]=null;g.onContextRestored();g.redraw=!0;window.cr_setSuspended(!1)},!1);var m,b,d,e,l;a=0;for(u=this.types_by_index.length;a<u;a++)for(m=this.types_by_index[a],c=0,f=m.effect_types.length;c<f;c++)d=m.effect_types[c],d.shaderindex=this.glwrap.getShaderIndex(d.id),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(d.shaderindex);a=0;for(u=this.layouts_by_index.length;a<u;a++){e=this.layouts_by_index[a];c=0;for(f=e.effect_types.length;c<f;c++)d=e.effect_types[c],d.shaderindex=this.glwrap.getShaderIndex(d.id);c=0;for(f=e.layers.length;c<f;c++)for(l=e.layers[c],m=0,b=l.effect_types.length;m<b;m++)d=l.effect_types[m],d.shaderindex=this.glwrap.getShaderIndex(d.id),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(d.shaderindex)}}else{if(0<this.fullscreen_mode&&this.isDirectCanvas){this.canvas=null;document.oncontextmenu=function(a){return!1};document.onselectstart=function(a){return!1};this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0}catch(h){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(u={antialias:!!this.linearSampling},this.ctx=a.getContext("2d",u)):this.ctx=a.getContext("2d"),this.ctx.webkitImageSmoothingEnabled=this.linearSampling,this.ctx.mozImageSmoothingEnabled=this.linearSampling,this.ctx.msImageSmoothingEnabled=this.linearSampling,this.ctx.imageSmoothingEnabled=this.linearSampling);this.overlay_ctx=this.overlay_canvas=null}this.tickFunc=function(){g.tick()};window==window.top||(this.isDomFree||this.isWindows8App)||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0));"undefined"!==typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){g.setSuspended(!1)}),jQuery(window).blur(function(){g.setSuspended(!0)})));this.go();this.extra={};cr.seal(this)}}function b(a){a.target.result.createObjectStore("saves",{keyPath:"slot"})}function d(a,g,c,f){var d=indexedDB.open("_C2SaveStates");d.onupgradeneeded=b;d.onerror=f;d.onsuccess=function(s){s=s.target.result;s.onerror=f;s.transaction(["saves"],"readwrite").objectStore("saves").put({slot:a,data:g}).onsuccess=c}}function e(a,g,c){var f=indexedDB.open("_C2SaveStates");f.onupgradeneeded=b;f.onerror=c;f.onsuccess=function(f){f=f.target.result;f.onerror=c;var s=f.transaction(["saves"]).objectStore("saves").get(a);s.onsuccess=function(a){s.result?g(s.result.data):g(null)}}}function f(){cr.logexport("Reloading for continuous preview");window.c2cocoonjs?CocoonJS.App.reload():-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+="?continuous"}function h(a){var g,c={};for(g in a)!a.hasOwnProperty(g)||a[g]instanceof cr.ObjectSet||"undefined"===typeof a[g].c2userdata&&"mouseOverInverted"!==g&&(c[g]=a[g]);return c}a.prototype.setSize=function(a,g){var c=this.hideAddressBar&&this.isiPhone&&!navigator.standalone&&!this.isDomFree&&!this.isPhoneGap,f=0;c&&(this.isiPhone?f=60:this.isAndroid&&(f=56),g+=f);var b=0,s=0,m=0,d=0,e=0,e=this.fullscreen_mode,l=document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.isNodeFullscreen;l&&0<this.fullscreen_scaling&&(e=this.fullscreen_scaling);4<=e?(m=this.original_width/this.original_height,a/g>m?(m*=g,5===e?(e=m/this.original_width,1<e?e=Math.floor(e):1>e&&(e=1/Math.ceil(1/e)),m=this.original_width*e,d=this.original_height*e,b=(a-m)/2,s=(g-d)/2,a=m,g=d):(b=(a-m)/2,a=m)):(d=a/m,5===e?(e=d/this.original_height,1<e?e=Math.floor(e):1>e&&(e=1/Math.ceil(1/e)),m=this.original_width*e,d=this.original_height*e,b=(a-m)/2,s=(g-d)/2,a=m):s=(g-d)/2,g=d),l&&!this.isNodeWebkit&&(s=b=0),b=Math.floor(b),s=Math.floor(s),a=Math.floor(a),g=Math.floor(g)):this.isNodeWebkit&&(this.isNodeFullscreen&&0===this.fullscreen_mode_set)&&(b=Math.floor((a-this.original_width)/2),s=Math.floor((g-this.original_height)/2),a=this.original_width,g=this.original_height);this.isRetina&&(this.isiPad&&1<this.devicePixelRatio)&&(1024<=a&&(a=1023),1024<=g&&(g=1023));l=this.devicePixelRatio;this.width=a*l;this.height=g*l;this.redraw=!0;this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:a+"px",height:g+"px","margin-left":b,"margin-top":s}),"undefined"!==typeof cr_is_preview&&jQuery("#borderwrap").css({width:a+"px",height:g+"px"}));this.canvas&&(this.canvas.width=a*l,this.canvas.height=g*l,this.isRetina&&jQuery(this.canvas).css({width:a+"px",height:g+"px"}));this.overlay_canvas&&(this.overlay_canvas.width=a,this.overlay_canvas.height=g);this.glwrap&&this.glwrap.setSize(a,g);this.isDirectCanvas&&this.ctx&&(this.ctx.width=a,this.ctx.height=g);this.ctx&&(this.ctx.webkitImageSmoothingEnabled=this.linearSampling,this.ctx.mozImageSmoothingEnabled=this.linearSampling,this.ctx.msImageSmoothingEnabled=this.linearSampling,this.ctx.imageSmoothingEnabled=this.linearSampling);c&&0<f&&window.setTimeout(function(){window.scrollTo(0,1)},100)};a.prototype.onContextLost=function(){this.is_WebGL_context_lost=!0;var a,g,c;a=0;for(g=this.types_by_index.length;a<g;a++)if(c=this.types_by_index[a],c.onLostWebGLContext)c.onLostWebGLContext()};a.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var a,g,c;a=0;for(g=this.types_by_index.length;a<g;a++)if(c=this.types_by_index[a],c.onRestoreWebGLContext)c.onRestoreWebGLContext()};a.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var a=document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.isNodeFullscreen?jQuery(this.canvas).offset():jQuery(this.canvas).position();a.position="absolute";jQuery(this.overlay_canvas).css(a)}};var k=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;a.prototype.setSuspended=function(a){var g;if(a&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,0!==this.raf_id&&k&&k(this.raf_id),0!==this.timeout_id&&clearTimeout(this.timeout_id),a=0,g=this.suspend_events.length;a<g;a++)this.suspend_events[a](!0);else if(!a&&this.isSuspended){cr.logexport("[Construct 2] Resuming");this.isSuspended=!1;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();a=this.logictime=this.framecount=0;for(g=this.suspend_events.length;a<g;a++)this.suspend_events[a](!1);this.tick()}};a.prototype.addSuspendCallback=function(a){this.suspend_events.push(a)};a.prototype.load=function(){var a=cr.getProjectModel();this.name=a[0];this.first_layout=a[1];this.fullscreen_mode=a[11];this.fullscreen_mode_set=a[11];this.isDomFree&&(4<=a[11]||0===a[11])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode_set=this.fullscreen_mode=3);this.uses_loader_layout=a[17];this.loaderstyle=a[18];0===this.loaderstyle&&(this.loaderlogo=new Image,this.loaderlogo.src="loading-logo.png");this.next_uid=a[20];this.system=new cr.system_object(this);var g,c,f,b,s,m,d,e,l;g=0;for(c=a[2].length;g<c;g++){d=a[2][g];cr.add_common_aces(d);l=new d[0](this);l.singleglobal=d[1];l.is_world=d[2];l.must_predraw=d[9];if(l.onCreate)l.onCreate();cr.seal(l);this.plugins.push(l)}a=cr.getProjectModel();g=0;for(c=a[3].length;g<c;g++){d=a[3][g];s=d[1];l=null;f=0;for(b=this.plugins.length;f<b;f++)if(this.plugins[f]instanceof s){l=this.plugins[f];break}var h=new l.Type(l);h.name=d[0];h.is_family=d[2];h.instvar_sids=d[3].slice(0);h.vars_count=d[3].length;h.behs_count=d[4];h.fx_count=d[5];h.sid=d[11];h.is_family?(h.members=[],h.family_index=this.family_count++,h.families=null):(h.members=null,h.family_index=-1,h.families=[]);h.family_var_map=null;h.family_beh_map=null;h.family_fx_map=null;h.is_contained=!1;h.container=null;d[6]?(h.texture_file=d[6][0],h.texture_filesize=d[6][1],h.texture_pixelformat=d[6][2]):(h.texture_file=null,h.texture_filesize=0,h.texture_pixelformat=0);h.animations=d[7]?d[7]:null;h.index=g;h.instances=[];h.deadCache=[];h.solstack=[new cr.selection(h)];h.cur_sol=0;h.default_instance=null;h.stale_iids=!0;h.updateIIDs=cr.type_updateIIDs;h.getFirstPicked=cr.type_getFirstPicked;h.getPairedInstance=cr.type_getPairedInstance;h.getCurrentSol=cr.type_getCurrentSol;h.pushCleanSol=cr.type_pushCleanSol;h.pushCopySol=cr.type_pushCopySol;h.popSol=cr.type_popSol;h.getBehaviorByName=cr.type_getBehaviorByName;h.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;h.getEffectIndexByName=cr.type_getEffectIndexByName;h.applySolToContainer=cr.type_applySolToContainer;h.extra={};h.toString=cr.type_toString;h.behaviors=[];f=0;for(b=d[8].length;f<b;f++){e=d[8][f];var k=e[1],t=null;s=0;for(m=this.behaviors.length;s<m;s++)if(this.behaviors[s]instanceof k){t=this.behaviors[s];break}if(!t){t=new k(this);t.my_instances=new cr.ObjectSet;if(t.onCreate)t.onCreate();cr.seal(t);this.behaviors.push(t)}s=new t.Type(t,h);s.name=e[0];s.sid=e[2];s.onCreate();cr.seal(s);h.behaviors.push(s)}h.global=d[9];h.isOnLoaderLayout=d[10];h.effect_types=[];f=0;for(b=d[12].length;f<b;f++)h.effect_types.push({id:d[12][f][0],name:d[12][f][1],shaderindex:-1,active:!0,index:f});if(!this.uses_loader_layout||h.is_family||h.isOnLoaderLayout||!l.is_world)h.onCreate(),cr.seal(h);h.name&&(this.types[h.name]=h);this.types_by_index.push(h);l.singleglobal&&(f=new l.Instance(h),f.uid=this.next_uid++,f.puid=this.next_puid++,f.iid=0,f.get_iid=cr.inst_get_iid,f.toString=cr.inst_toString,f.properties=d[13],f.onCreate(),cr.seal(f),h.instances.push(f))}g=0;for(c=a[4].length;g<c;g++)for(s=a[4][g],m=this.types_by_index[s[0]],f=1,b=s.length;f<b;f++)d=this.types_by_index[s[f]],d.families.push(m),m.members.push(d);g=0;for(c=a[22].length;g<c;g++){s=a[22][g];m=[];f=0;for(b=s.length;f<b;f++)m.push(this.types_by_index[s[f]]);f=0;for(b=m.length;f<b;f++)m[f].is_contained=!0,m[f].container=m}if(0<this.family_count)for(g=0,c=this.types_by_index.length;g<c;g++)if(d=this.types_by_index[g],!d.is_family&&d.families.length){d.family_var_map=Array(this.family_count);d.family_beh_map=Array(this.family_count);d.family_fx_map=Array(this.family_count);h=[];f=t=k=e=0;for(b=d.families.length;f<b;f++)for(l=d.families[f],d.family_var_map[l.family_index]=e,e+=l.vars_count,d.family_beh_map[l.family_index]=k,k+=l.behs_count,d.family_fx_map[l.family_index]=t,t+=l.fx_count,s=0,m=l.effect_types.length;s<m;s++)h.push(cr.shallowCopy({},l.effect_types[s]));d.effect_types=h.concat(d.effect_types);f=0;for(b=d.effect_types.length;f<b;f++)d.effect_types[f].index=f}g=0;for(c=a[5].length;g<c;g++)d=a[5][g],f=new cr.layout(this,d),cr.seal(f),this.layouts[f.name]=f,this.layouts_by_index.push(f);g=0;for(c=a[6].length;g<c;g++)d=a[6][g],f=new cr.eventsheet(this,d),cr.seal(f),this.eventsheets[f.name]=f,this.eventsheets_by_index.push(f);g=0;for(c=this.eventsheets_by_index.length;g<c;g++)this.eventsheets_by_index[g].postInit();g=0;for(c=this.triggers_to_postinit.length;g<c;g++)this.triggers_to_postinit[g].postInit();this.triggers_to_postinit.length=0;this.files_subfolder=a[7];this.pixel_rounding=a[8];this.original_width=a[9];this.original_height=a[10];this.aspect_scale=1;this.enableWebGL=a[12];this.linearSampling=a[13];this.clearBackground=a[14];this.versionstr=a[15];g=a[16];2===g&&(g=this.isiPhone?1:0);this.useiOSRetina=0!==g;this.hideAddressBar=a[19];this.pauseOnBlur=a[21];this.start_time=Date.now()};a.prototype.findWaitingTexture=function(a){var g,f;g=0;for(f=this.wait_for_textures.length;g<f;g++)if(this.wait_for_textures[g].cr_src===a)return this.wait_for_textures[g];return null};a.prototype.areAllTexturesLoaded=function(){var a=0,g=0,f=!0,c,b;c=0;for(b=this.wait_for_textures.length;c<b;c++){var s=this.wait_for_textures[c].cr_filesize;if(!s||0>=s)s=5E4;a+=s;this.wait_for_textures[c].complete||this.wait_for_textures[c].loaded?g+=s:f=!1}this.progress=0==a?0:g/a;return f};a.prototype.go=function(){if(this.ctx||this.glwrap){var a=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();this.progress=0;this.last_progress=-1;if(this.areAllTexturesLoaded())this.go_textures_done();else{var g=Date.now()-this.start_time,c=1;this.isTizen&&(c=this.devicePixelRatio);if(a){if(3!==this.loaderstyle&&500<=g&&this.last_progress!=this.progress){a.clearRect(0,0,this.width,this.height);var g=this.width/(2*c),c=this.height/(2*c),f=0===this.loaderstyle&&this.loaderlogo.complete,b=40,s=0,m=80;f&&(m=this.loaderlogo.width,b=m/2,s=this.loaderlogo.height/2,a.drawImage(this.loaderlogo,cr.floor(g-b),cr.floor(c-s)));1>=this.loaderstyle?(c+=s+(f?12:0),g=cr.floor(g-b)+0.5,c=cr.floor(c)+0.5,a.fillStyle="DodgerBlue",a.fillRect(g,c,Math.floor(m*this.progress),6),a.strokeStyle="black",a.strokeRect(g,c,m,6),a.strokeStyle="white",a.strokeRect(g-1,c-1,m+2,8)):2===this.loaderstyle&&(a.font="12pt Arial",a.fillStyle="#999",a.textBaseLine="middle",f=Math.round(100*this.progress)+"%",b=a.measureText?a.measureText(f):null,a.fillText(f,g-(b?b.width:0)/2,c))}this.last_progress=this.progress}setTimeout(function(a){return function(){a.go()}}(this),100)}}};a.prototype.go_textures_done=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_canvas=this.overlay_ctx=null);this.start_time=Date.now();this.last_fps_time=cr.performance_now();var a,g,c;if(this.uses_loader_layout)for(a=0,g=this.types_by_index.length;a<g;a++)c=this.types_by_index[a],c.is_family||(c.isOnLoaderLayout||!c.plugin.is_world)||(c.onCreate(),cr.seal(c));else this.isloading=!1;a=0;for(g=this.layouts_by_index.length;a<g;a++)this.layouts_by_index[a].createGlobalNonWorlds();2<=this.fullscreen_mode&&(a=this.original_width/this.original_height,g=this.width/this.height,this.aspect_scale=2!==this.fullscreen_mode&&g>a||2===this.fullscreen_mode&&g<a?this.height/this.original_height:this.width/this.original_width);this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning();this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null));this.tick();this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")};var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;a.prototype.tick=function(){if(this.running_layout){if(this.isArcade){var a=jQuery(window).width(),g=jQuery(window).height();if(this.lastwidth!==a||this.lastheight!==g)this.lastwidth=a,this.lastheight=g,this.setSize(a,g)}a=cr.performance_now();this.isloading&&(g=this.areAllTexturesLoaded(),this.loadingprogress=this.progress,g&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null)));this.logic();!this.redraw&&!this.isCocoonJs||(this.is_WebGL_context_lost||this.suspendDrawing)||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null));this.tickcount++;this.execcount++;this.framecount++;this.logictime+=cr.performance_now()-a;this.isSuspended||(c?this.raf_id=c(this.tickFunc,this.canvas):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16))}};a.prototype.logic=function(){var a,g,c,f,b,s,m,d,e;a=cr.performance_now();1E3<=a-this.last_fps_time&&(this.last_fps_time+=1E3,this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);this.measuring_dt&&(0!==this.last_tick_time&&(g=a-this.last_tick_time,0===g?(this.zeroDtCount++,10<=this.zeroDtCout&&(this.measuring_dt=!1),this.dt1=1/60):(this.dt1=g/1E3,0.5<this.dt1?this.dt1=0:0.1<this.dt1&&(this.dt1=0.1))),this.last_tick_time=a);this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);a=document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.isNodeFullscreen;2<=this.fullscreen_mode||a&&0<this.fullscreen_scaling?(g=this.original_width/this.original_height,c=this.width/this.height,f=this.fullscreen_mode,a&&0<this.fullscreen_scaling&&(f=this.fullscreen_scaling),this.aspect_scale=2!==f&&c>g||2===f&&c<g?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))):this.aspect_scale=1;this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;a=0;for(g=this.types_by_index.length;a<g;a++)if(m=this.types_by_index[a],!m.is_family&&(m.behaviors.length||m.families.length))for(c=0,f=m.instances.length;c<f;c++)for(d=m.instances[c],b=0,s=d.behavior_insts.length;b<s;b++)d.behavior_insts[b].tick();a=0;for(g=this.types_by_index.length;a<g;a++)if(m=this.types_by_index[a],!m.is_family&&(m.behaviors.length||m.families.length))for(c=0,f=m.instances.length;c<f;c++)for(d=m.instances[c],b=0,s=d.behavior_insts.length;b<s;b++)e=d.behavior_insts[b],e.posttick&&e.posttick();c=this.objects_to_tick.valuesRef();a=0;for(g=c.length;a<g;a++)c[a].tick();this.isInOnDestroy--;this.handleSaveLoad();for(a=0;this.changelayout&&10>a++;)this.doChangeLayout(this.changelayout);a=0;for(g=this.eventsheets_by_index.length;a<g;a++)this.eventsheets_by_index[a].hasRun=!1;this.running_layout.event_sheet&&this.running_layout.event_sheet.run();this.registered_collisions.length=0;this.layout_first_tick=!1;this.isInOnDestroy++;a=0;for(g=this.types_by_index.length;a<g;a++)if(m=this.types_by_index[a],!m.is_family&&(m.behaviors.length||m.families.length))for(c=0,f=m.instances.length;c<f;c++)for(d=m.instances[c],b=0,s=d.behavior_insts.length;b<s;b++)e=d.behavior_insts[b],e.tick2&&e.tick2();c=this.objects_to_tick2.valuesRef();a=0;for(g=c.length;a<g;a++)c[a].tick2();this.isInOnDestroy--};a.prototype.doChangeLayout=function(a){var g=this.running_layout;this.running_layout.stopRunning();var c,f,b,s,m,d,e;if(this.glwrap)for(c=0,f=this.types_by_index.length;c<f;c++)m=this.types_by_index[c],m.is_family||!m.unloadTextures||(m.global&&0!==m.instances.length||-1!==a.initial_types.indexOf(m))||m.unloadTextures();g==a&&(this.system.waits.length=0);a.startRunning();c=0;for(f=this.types_by_index.length;c<f;c++)if(m=this.types_by_index[c],m.global||m.plugin.singleglobal)for(a=0,g=m.instances.length;a<g;a++){d=m.instances[a];if(d.onLayoutChange)d.onLayoutChange();if(d.behavior_insts)for(b=0,s=d.behavior_insts.length;b<s;b++)if(e=d.behavior_insts[b],e.onLayoutChange)e.onLayoutChange()}this.layout_first_tick=this.redraw=!0;this.ClearDeathRow()};a.prototype.tickMe=function(a){this.objects_to_tick.add(a)};a.prototype.untickMe=function(a){this.objects_to_tick.remove(a)};a.prototype.tick2Me=function(a){this.objects_to_tick2.add(a)};a.prototype.untick2Me=function(a){this.objects_to_tick2.remove(a)};a.prototype.getDt=function(a){return a&&-1!==a.my_timescale?this.dt1*a.my_timescale:this.dt};a.prototype.draw=function(){this.running_layout.draw(this.ctx);this.isDirectCanvas&&this.ctx.present()};a.prototype.drawGL=function(){this.running_layout.drawGL(this.glwrap)};a.prototype.addDestroyCallback=function(a){a&&this.destroycallbacks.push(a)};a.prototype.removeDestroyCallback=function(a){cr.arrayFindRemove(this.destroycallbacks,a)};a.prototype.getObjectByUID=function(a){return this.objectsByUid[a.toString()]};a.prototype.DestroyInstance=function(a){var g,c;if(!this.deathRow.contains(a)){this.deathRow.add(a);if(a.is_contained)for(g=0,c=a.siblings.length;g<c;g++)this.DestroyInstance(a.siblings[g]);this.isInClearDeathRow&&this.deathRow.values_cache.push(a);this.isInOnDestroy++;this.trigger(Object.getPrototypeOf(a.type.plugin).cnds.OnDestroyed,a);this.isInOnDestroy--}};a.prototype.ClearDeathRow=function(){var a,g,c,f,b,s,m,d,e,l;this.isInClearDeathRow=!0;f=0;for(s=this.createRow.length;f<s;f++)for(a=this.createRow[f],g=a.type,g.instances.push(a),g.stale_iids=!0,b=0,m=g.families.length;b<m;b++)g.families[b].instances.push(a),g.families[b].stale_iids=!0;this.createRow.length=0;s=this.deathRow.valuesRef();for(f=0;f<s.length;f++){a=s[f];g=a.type;c=g.instances;b=0;for(m=this.destroycallbacks.length;b<m;b++)this.destroycallbacks[b](a);cr.arrayFindRemove(c,a);a.layer&&(cr.arrayRemove(a.layer.instances,a.get_zindex()),a.layer.zindices_stale=!0);b=0;for(m=g.families.length;b<m;b++)cr.arrayFindRemove(g.families[b].instances,a),g.families[b].stale_iids=!0;if(a.behavior_insts)for(b=0,m=a.behavior_insts.length;b<m;b++){c=a.behavior_insts[b];if(c.onDestroy)c.onDestroy();c.behavior.my_instances.remove(a)}this.objects_to_tick.remove(a);this.objects_to_tick2.remove(a);b=0;for(m=this.system.waits.length;b<m;b++)if(e=this.system.waits[b],e.sols.hasOwnProperty(g.index)&&cr.arrayFindRemove(e.sols[g.index].insts,a),!g.is_family)for(c=0,d=g.families.length;c<d;c++)l=g.families[c],e.sols.hasOwnProperty(l.index)&&cr.arrayFindRemove(e.sols[l.index].insts,a);if(a.onDestroy)a.onDestroy();this.objectsByUid.hasOwnProperty(a.uid.toString())&&delete this.objectsByUid[a.uid.toString()];this.objectcount--;64>g.deadCache.length&&g.deadCache.push(a);g.stale_iids=!0}this.deathRow.isEmpty()||(this.redraw=!0);this.deathRow.clear();this.isInClearDeathRow=!1};a.prototype.createInstance=function(a,g,c,f){if(a.is_family){var b=cr.floor(Math.random()*a.members.length);return this.createInstance(a.members[b],g,c,f)}return a.default_instance?this.createInstanceFromInit(a.default_instance,g,!1,c,f,!1):null};var r=[];a.prototype.createInstanceFromInit=function(a,g,c,f,b,s){var m,d,e,l;if(!a)return null;var h=this.types_by_index[a[1]],k=h.plugin.is_world;if(this.isloading&&k&&!h.isOnLoaderLayout||k&&!this.glwrap&&11===a[0][11])return null;var t=g;k||(g=null);var q;h.deadCache.length?(q=h.deadCache.pop(),q.recycled=!0,h.plugin.Instance.call(q,h)):(q=new h.plugin.Instance(h),q.recycled=!1);q.uid=c&&!s?a[2]:this.next_uid++;this.objectsByUid[q.uid.toString()]=q;q.puid=this.next_puid++;q.iid=0;q.get_iid=cr.inst_get_iid;h.stale_iids=!0;e=a[3];if(q.recycled)cr.wipe(q.extra);else{q.extra={};if("undefined"!==typeof cr_is_preview)for(q.instance_var_names=[],q.instance_var_names.length=e.length,m=0,d=e.length;m<d;m++)q.instance_var_names[m]=e[m][1];q.instance_vars=[];q.instance_vars.length=e.length}m=0;for(d=e.length;m<d;m++)q.instance_vars[m]=e[m][0];if(k){var n=a[0];q.x=cr.is_undefined(f)?n[0]:f;q.y=cr.is_undefined(b)?n[1]:b;q.z=n[2];q.width=n[3];q.height=n[4];q.depth=n[5];q.angle=n[6];q.opacity=n[7];q.hotspotX=n[8];q.hotspotY=n[9];q.blend_mode=n[10];m=n[11];!this.glwrap&&h.effect_types.length&&(q.blend_mode=m);q.compositeOp=cr.effectToCompositeOp(q.blend_mode);this.gl&&cr.setGLBlend(q,q.blend_mode,this.gl);if(q.recycled){m=0;for(d=n[12].length;m<d;m++)for(e=0,l=n[12][m].length;e<l;e++)q.effect_params[m][e]=n[12][m][e];q.bbox.set(0,0,0,0);q.bquad.set_from_rect(q.bbox);q.bbox_changed_callbacks.length=0}else{q.effect_params=n[12].slice(0);m=0;for(d=q.effect_params.length;m<d;m++)q.effect_params[m]=n[12][m].slice(0);q.active_effect_types=[];q.active_effect_flags=[];q.active_effect_flags.length=h.effect_types.length;q.bbox=new cr.rect(0,0,0,0);q.bquad=new cr.quad;q.bbox_changed_callbacks=[];q.set_bbox_changed=cr.set_bbox_changed;q.add_bbox_changed_callback=cr.add_bbox_changed_callback;q.contains_pt=cr.inst_contains_pt;q.update_bbox=cr.update_bbox;q.get_zindex=cr.inst_get_zindex}m=0;for(d=h.effect_types.length;m<d;m++)q.active_effect_flags[m]=!0;q.updateActiveEffects=cr.inst_updateActiveEffects;q.updateActiveEffects();q.uses_shaders=!!q.active_effect_types.length;q.bbox_changed=!0;q.visible=!0;q.my_timescale=-1;q.layer=g;q.zindex=g.instances.length;"undefined"===typeof q.collision_poly&&(q.collision_poly=null);this.redraw=q.collisionsEnabled=!0}q.toString=cr.inst_toString;var v;m=r.length=0;for(d=h.families.length;m<d;m++)r.push.apply(r,h.families[m].behaviors);r.push.apply(r,h.behaviors);if(q.recycled)for(m=0,d=r.length;m<d;m++){var w=r[m];v=q.behavior_insts[m];v.recycled=!0;w.behavior.Instance.call(v,w,q);n=a[4][m];e=0;for(l=n.length;e<l;e++)v.properties[e]=n[e];v.onCreate();w.behavior.my_instances.add(q)}else for(q.behavior_insts=[],m=0,d=r.length;m<d;m++)w=r[m],v=new w.behavior.Instance(w,q),v.recycled=!1,v.properties=a[4][m].slice(0),v.onCreate(),cr.seal(v),q.behavior_insts.push(v),w.behavior.my_instances.add(q);n=a[5];if(q.recycled)for(m=0,d=n.length;m<d;m++)q.properties[m]=n[m];else q.properties=n.slice(0);this.createRow.push(q);g&&g.instances.push(q);this.objectcount++;if(h.is_contained){if(q.is_contained=!0,q.recycled?q.siblings.length=0:q.siblings=[],!c&&!s){m=0;for(d=h.container.length;m<d;m++)if(h.container[m]!==h){if(!h.container[m].default_instance)return null;q.siblings.push(this.createInstanceFromInit(h.container[m].default_instance,t,!1,k?q.x:f,k?q.y:b,!0))}m=0;for(d=q.siblings.length;m<d;m++)for(q.siblings[m].siblings.push(q),e=0;e<d;e++)m!==e&&q.siblings[m].siblings.push(q.siblings[e])}}else q.is_contained=!1,q.siblings=null;q.onCreate();q.recycled||cr.seal(q);m=0;for(d=q.behavior_insts.length;m<d;m++)q.behavior_insts[m].postCreate&&q.behavior_insts[m].postCreate();return q};a.prototype.getLayerByName=function(a){var g,c;g=0;for(c=this.running_layout.layers.length;g<c;g++){var f=this.running_layout.layers[g];if(cr.equals_nocase(f.name,a))return f}return null};a.prototype.getLayerByNumber=function(a){a=cr.floor(a);0>a&&(a=0);a>=this.running_layout.layers.length&&(a=this.running_layout.layers.length-1);return this.running_layout.layers[a]};a.prototype.getLayer=function(a){return cr.is_number(a)?this.getLayerByNumber(a):this.getLayerByName(a.toString())};a.prototype.clearSol=function(a){var g,c;g=0;for(c=a.length;g<c;g++)a[g].getCurrentSol().select_all=!0};a.prototype.pushCleanSol=function(a){var g,c;g=0;for(c=a.length;g<c;g++)a[g].pushCleanSol()};a.prototype.pushCopySol=function(a){var g,c;g=0;for(c=a.length;g<c;g++)a[g].pushCopySol()};a.prototype.popSol=function(a){var g,c;g=0;for(c=a.length;g<c;g++)a[g].popSol()};a.prototype.testAndSelectCanvasPointOverlap=function(a,c,f,b){var d=a.getCurrentSol(),s,m,e,l,h,k;if(d.select_all)for(b||(d.select_all=!1,d.instances.length=0),s=0,l=a.instances.length;s<l;s++){if(e=a.instances[s],e.update_bbox(),h=e.layer.canvasToLayer(c,f,!0),k=e.layer.canvasToLayer(c,f,!1),e.contains_pt(h,k)){if(b)return!1;d.instances.push(e)}}else{s=m=0;for(l=d.instances.length;s<l;s++)if(e=d.instances[s],e.update_bbox(),h=e.layer.canvasToLayer(c,f,!0),k=e.layer.canvasToLayer(c,f,!1),e.contains_pt(h,k)){if(b)return!1;d.instances[m]=d.instances[s];m++}b||(d.instances.length=m)}a.applySolToContainer();return b?!0:d.hasObjects()};a.prototype.testOverlap=function(a,c){if(!(a&&c&&a!==c&&a.collisionsEnabled&&c.collisionsEnabled))return!1;a.update_bbox();c.update_bbox();var f=a.layer,b=c.layer,d,s,m,e,l,h;if(f===b||f.parallaxX===b.parallaxX&&b.parallaxY===b.parallaxY&&f.scale===b.scale&&f.angle===b.angle&&f.zoomRate===b.zoomRate){if(!a.bbox.intersects_rect(c.bbox)||!a.bquad.intersects_quad(c.bquad))return!1;l=a.collision_poly&&!a.collision_poly.is_empty();d=c.collision_poly&&!c.collision_poly.is_empty();if(!l&&!d)return!0;l?(a.collision_poly.cache_poly(a.width,a.height,a.angle),l=a.collision_poly):(this.temp_poly.set_from_quad(a.bquad,a.x,a.y,a.width,a.height),l=this.temp_poly);d?(c.collision_poly.cache_poly(c.width,c.height,c.angle),h=c.collision_poly):(this.temp_poly.set_from_quad(c.bquad,c.x,c.y,c.width,c.height),h=this.temp_poly);return l.intersects_poly(h,c.x-a.x,c.y-a.y)}l=a.collision_poly&&!a.collision_poly.is_empty();d=c.collision_poly&&!c.collision_poly.is_empty();l?(a.collision_poly.cache_poly(a.width,a.height,a.angle),this.temp_poly.set_from_poly(a.collision_poly)):this.temp_poly.set_from_quad(a.bquad,a.x,a.y,a.width,a.height);l=this.temp_poly;d?(c.collision_poly.cache_poly(c.width,c.height,c.angle),this.temp_poly2.set_from_poly(c.collision_poly)):this.temp_poly2.set_from_quad(c.bquad,c.x,c.y,c.width,c.height);h=this.temp_poly2;d=0;for(s=l.pts_count;d<s;d++)m=l.pts_cache[2*d],e=l.pts_cache[2*d+1],l.pts_cache[2*d]=f.layerToCanvas(m+a.x,e+a.y,!0),l.pts_cache[2*d+1]=f.layerToCanvas(m+a.x,e+a.y,!1);d=0;for(s=h.pts_count;d<s;d++)m=h.pts_cache[2*d],e=h.pts_cache[2*d+1],h.pts_cache[2*d]=b.layerToCanvas(m+c.x,e+c.y,!0),h.pts_cache[2*d+1]=b.layerToCanvas(m+c.x,e+c.y,!1);return l.intersects_poly(h,0,0)};var n=new cr.quad,l=new cr.rect(0,0,0,0);a.prototype.testRectOverlap=function(a,c){if(!c||!c.collisionsEnabled)return!1;c.update_bbox();if(!c.bbox.intersects_rect(a))return!1;n.set_from_rect(a);if(!c.bquad.intersects_quad(n))return!1;if(!c.collision_poly||c.collision_poly.is_empty())return!0;c.collision_poly.cache_poly(c.width,c.height,c.angle);n.offset(-a.left,-a.top);this.temp_poly.set_from_quad(n,0,0,1,1);return c.collision_poly.intersects_poly(this.temp_poly,a.left-c.x,a.top-c.y)};a.prototype.testSegmentOverlap=function(a,c,f,b,d){if(!d||!d.collisionsEnabled)return!1;d.update_bbox();l.set(cr.min(a,f),cr.min(c,b),cr.max(a,f),cr.max(c,b));if(!d.bbox.intersects_rect(l)||!d.bquad.intersects_segment(a,c,f,b))return!1;if(!d.collision_poly||d.collision_poly.is_empty())return!0;d.collision_poly.cache_poly(d.width,d.height,d.angle);return d.collision_poly.intersects_segment(d.x,d.y,a,c,f,b)};a.prototype.typeHasBehavior=function(a,c){if(!c)return!1;var f,b,d,s,m;f=0;for(b=a.behaviors.length;f<b;f++)if(a.behaviors[f].behavior instanceof c)return!0;if(!a.is_family)for(f=0,b=a.families.length;f<b;f++)for(m=a.families[f],d=0,s=m.behaviors.length;d<s;d++)if(m.behaviors[d].behavior instanceof c)return!0;return!1};a.prototype.typeHasNoSaveBehavior=function(a){return this.typeHasBehavior(a,cr.behaviors.NoSave)};a.prototype.typeHasPersistBehavior=function(a){return this.typeHasBehavior(a,cr.behaviors.Persist)};a.prototype.getSolidBehavior=function(){if(!cr.behaviors.solid)return null;var a,c;a=0;for(c=this.behaviors.length;a<c;a++)if(this.behaviors[a]instanceof cr.behaviors.solid)return this.behaviors[a];return null};a.prototype.testOverlapSolid=function(a){var c=this.getSolidBehavior();if(!c)return null;var f,b,d=c.my_instances.valuesRef(),c=0;for(f=d.length;c<f;++c)if(b=d[c],b.extra.solidEnabled&&this.testOverlap(a,b))return b;return null};a.prototype.testRectOverlapSolid=function(a){var c=this.getSolidBehavior();if(!c)return null;var f,b,d=c.my_instances.valuesRef(),c=0;for(f=d.length;c<f;++c)if(b=d[c],b.extra.solidEnabled&&this.testRectOverlap(a,b))return b;return null};var q=[];a.prototype.testOverlapJumpThru=function(a,c){var f=null,b,d;if(!cr.behaviors.jumpthru)return null;b=0;for(d=this.behaviors.length;b<d;b++)if(this.behaviors[b]instanceof cr.behaviors.jumpthru){f=this.behaviors[b];break}if(!f)return null;var s=null;c&&(s=q,s.length=0);var m=f.my_instances.valuesRef();b=0;for(d=m.length;b<d;++b)if(f=m[b],f.extra.jumpthruEnabled&&this.testOverlap(a,f))if(c)s.push(f);else return f;return s};a.prototype.pushOutSolid=function(a,c,f,b,d,s){b=b||50;var m=a.x,e=a.y,l,h=null,k=null;for(l=0;l<b;l++)if(a.x=m+c*l,a.y=e+f*l,a.set_bbox_changed(),!this.testOverlap(a,h)&&((h=this.testOverlapSolid(a))&&(k=h),!h&&(d&&(h=s?this.testOverlap(a,s)?s:null:this.testOverlapJumpThru(a))&&(k=h),!h)))return k&&this.pushInFractional(a,c,f,k,16),!0;a.x=m;a.y=e;a.set_bbox_changed();return!1};a.prototype.pushOut=function(a,c,f,b,d){b=b||50;var s=a.x,m=a.y,e;for(e=0;e<b;e++)if(a.x=s+c*e,a.y=m+f*e,a.set_bbox_changed(),!this.testOverlap(a,d))return!0;a.x=s;a.y=m;a.set_bbox_changed();return!1};a.prototype.pushInFractional=function(a,c,f,b,d){var s=2,m,e=!1;m=!1;for(var l=a.x,h=a.y;s<=d;)m=1/s,s*=2,a.x+=c*m*(e?1:-1),a.y+=f*m*(e?1:-1),a.set_bbox_changed(),this.testOverlap(a,b)?m=e=!0:(m=e=!1,l=a.x,h=a.y);m&&(a.x=l,a.y=h,a.set_bbox_changed())};a.prototype.pushOutSolidNearest=function(a,c){var f=cr.is_undefined(c)?100:c,b=0,d=a.x,s=a.y,m=0,e=0,l=0,h=this.testOverlapSolid(a);if(!h)return!0;for(;b<=f;){switch(m){case 0:e=0;l=-1;b++;break;case 1:e=1;l=-1;break;case 2:e=1;l=0;break;case 3:l=e=1;break;case 4:e=0;l=1;break;case 5:e=-1;l=1;break;case 6:e=-1;l=0;break;case 7:l=e=-1}m=(m+1)%8;a.x=cr.floor(d+e*b);a.y=cr.floor(s+l*b);a.set_bbox_changed();if(!this.testOverlap(a,h)&&(h=this.testOverlapSolid(a),!h))return!0}a.x=d;a.y=s;a.set_bbox_changed();return!1};a.prototype.registerCollision=function(a,c){a.collisionsEnabled&&c.collisionsEnabled&&this.registered_collisions.push([a,c])};a.prototype.checkRegisteredCollision=function(a,c){var f,b,d;f=0;for(b=this.registered_collisions.length;f<b;f++)if(d=this.registered_collisions[f],d[0]==a&&d[1]==c||d[0]==c&&d[1]==a)return!0;return!1};a.prototype.calculateSolidBounceAngle=function(a,c,f,b){var d=a.x,s=a.y,m=cr.max(10,cr.distanceTo(c,f,d,s)),e=cr.angleTo(c,f,d,s),l=b||this.testOverlapSolid(a);if(!l)return cr.clamp_angle(e+cr.PI);var h=l,k,t,q,r,n=cr.to_radians(5);for(k=1;36>k;k++)if(t=e-k*n,a.x=c+Math.cos(t)*m,a.y=f+Math.sin(t)*m,a.set_bbox_changed(),!this.testOverlap(a,h)&&(h=b?null:this.testOverlapSolid(a),!h)){q=t;break}36===k&&(q=cr.clamp_angle(e+cr.PI));h=l;for(k=1;36>k;k++)if(t=e+k*n,a.x=c+Math.cos(t)*m,a.y=f+Math.sin(t)*m,a.set_bbox_changed(),!this.testOverlap(a,h)&&(h=b?null:this.testOverlapSolid(a),!h)){r=t;break}36===k&&(r=cr.clamp_angle(e+cr.PI));a.x=d;a.y=s;a.set_bbox_changed();if(r===q)return r;a=cr.angleDiff(r,q)/2;a=cr.angleClockwise(r,q)?cr.clamp_angle(q+a+cr.PI):cr.clamp_angle(r+a);q=Math.cos(e);e=Math.sin(e);r=Math.cos(a);a=Math.sin(a);c=q*r+e*a;return cr.angleTo(0,0,q-2*c*r,e-2*c*a)};var v=[],t=-1;a.prototype.trigger=function(a,c,f){if(!this.running_layout)return!1;var b=this.running_layout.event_sheet;if(!b)return!1;t++;t===v.length?v.push(new cr.ObjectSet):v[t].clear();a=this.triggerOnSheet(a,c,b,f);t--;return a};a.prototype.triggerOnSheet=function(a,c,f,b){var d=v[t];if(d.contains(f))return!1;d.add(f);var d=f.includes.valuesRef(),s=!1,m,e,l;m=0;for(e=d.length;m<e;m++)d[m].isActive()&&(l=this.triggerOnSheet(a,c,d[m].include_sheet,b),s=s||l);if(c)for(l=this.triggerOnSheetForTypeName(a,c,c.type.name,f,b),s=s||l,m=0,e=c.type.families.length;m<e;m++)l=this.triggerOnSheetForTypeName(a,c,c.type.families[m].name,f,b),s=s||l;else l=this.triggerOnSheetForTypeName(a,c,"system",f,b),s=s||l;return s};a.prototype.triggerOnSheetForTypeName=function(a,c,f,b,d){var s,m=!1,e=!1,e="undefined"!==typeof d,l=(e?b.fasttriggers:b.triggers)[f];if(!l)return m;var h=null;b=0;for(s=l.length;b<s;b++)if(l[b].method==a){h=l[b].evs;break}if(!h)return m;a=e?h[d]:h;if(!a)return null;b=0;for(s=a.length;b<s;b++)d=a[b][0],e=a[b][1],e=this.executeSingleTrigger(c,f,d,e),m=m||e;return m};a.prototype.executeSingleTrigger=function(a,c,f,b){var d,s,m=!1;this.trigger_depth++;var e=this.getCurrentEventStack().current_event;e&&this.pushCleanSol(e.solModifiersIncludingParents);var l=1<this.trigger_depth;this.pushCleanSol(f.solModifiersIncludingParents);l&&this.pushLocalVarStack();var h=this.pushEventStack(f);h.current_event=f;a&&(d=this.types[c].getCurrentSol(),d.select_all=!1,d.instances.length=1,d.instances[0]=a,this.types[c].applySolToContainer());a=!0;if(f.parent){c=h.temp_parents_arr;for(d=f.parent;d;)c.push(d),d=d.parent;c.reverse();d=0;for(s=c.length;d<s;d++)if(!c[d].run_pretrigger()){a=!1;break}}a&&(this.execcount++,f.orblock?f.run_orblocktrigger(b):f.run(),m=m||h.last_event_true);this.popEventStack();l&&this.popLocalVarStack();this.popSol(f.solModifiersIncludingParents);e&&this.popSol(e.solModifiersIncludingParents);0!==this.isInOnDestroy||(0!==t||this.isRunningEvents||this.deathRow.isEmpty()&&!this.createRow.length)||this.ClearDeathRow();this.trigger_depth--;return m};a.prototype.getCurrentCondition=function(){var a=this.getCurrentEventStack();return a.current_event.conditions[a.cndindex]};a.prototype.getCurrentAction=function(){var a=this.getCurrentEventStack();return a.current_event.actions[a.actindex]};a.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])};a.prototype.popLocalVarStack=function(){this.localvar_stack_index--};a.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};a.prototype.pushEventStack=function(a){this.event_stack_index++;this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var c=this.getCurrentEventStack();c.reset(a);return c};a.prototype.popEventStack=function(){this.event_stack_index--};a.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};a.prototype.pushLoopStack=function(a){this.loop_stack_index++;this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:a,index:0,stopped:!1}));var c=this.getCurrentLoop();c.name=a;c.index=0;c.stopped=!1;return c};a.prototype.popLoopStack=function(){this.loop_stack_index--};a.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};a.prototype.getEventVariableByName=function(a,c){for(var f,b,d,s,m,e;c;){f=0;for(b=c.subevents.length;f<b;f++)if(e=c.subevents[f],e instanceof cr.eventvariable&&cr.equals_nocase(a,e.name))return e;c=c.parent}f=0;for(b=this.eventsheets_by_index.length;f<b;f++)for(m=this.eventsheets_by_index[f],d=0,s=m.events.length;d<s;d++)if(e=m.events[d],e instanceof cr.eventvariable&&cr.equals_nocase(a,e.name))return e;return null};a.prototype.getLayoutBySid=function(a){var c,f;c=0;for(f=this.layouts_by_index.length;c<f;c++)if(this.layouts_by_index[c].sid===a)return this.layouts_by_index[c];return null};a.prototype.getObjectTypeBySid=function(a){var c,f;c=0;for(f=this.types_by_index.length;c<f;c++)if(this.types_by_index[c].sid===a)return this.types_by_index[c];return null};a.prototype.getGroupBySid=function(a){var c,f;c=0;for(f=this.allGroups.length;c<f;c++)if(this.allGroups[c].sid===a)return this.allGroups[c];return null};a.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};a.prototype.handleSaveLoad=function(){var a=this,c=this.saveToSlot,b=this.lastSaveJson,l=this.loadFromSlot,h=!1;this.signalledContinuousPreview&&(h=!0,c="__c2_continuouspreview",this.signalledContinuousPreview=!1);if(c.length){this.ClearDeathRow();b=this.saveToJSONString();if(window.indexedDB&&!this.isCocoonJs)d(c,b,function(){cr.logexport("Saved state to IndexedDB storage ("+b.length+" bytes)");a.lastSaveJson=b;a.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);a.lastSaveJson="";h&&f()},function(d){try{localStorage.setItem("__c2save_"+c,b),cr.logexport("Saved state to WebStorage ("+b.length+" bytes)"),a.lastSaveJson=b,a.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),a.lastSaveJson="",h&&f()}catch(s){cr.logexport("Failed to save game state: "+d+"; "+s)}});else try{localStorage.setItem("__c2save_"+c,b),cr.logexport("Saved state to WebStorage ("+b.length+" bytes)"),a.lastSaveJson=b,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),a.lastSaveJson="",h&&f()}catch(s){cr.logexport("Error saving to WebStorage: "+s)}this.loadFromJson=this.loadFromSlot=this.saveToSlot=""}l.length&&(window.indexedDB&&!this.isCocoonJs?e(l,function(c){c?(a.loadFromJson=c,cr.logexport("Loaded state from IndexedDB storage ("+a.loadFromJson.length+" bytes)")):(a.loadFromJson=localStorage.getItem("__c2save_"+l)||"",cr.logexport("Loaded state from WebStorage ("+a.loadFromJson.length+" bytes)"));a.suspendDrawing=!1;a.loadFromJson.length||a.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)},function(c){a.loadFromJson=localStorage.getItem("__c2save_"+l)||"";cr.logexport("Loaded state from WebStorage ("+a.loadFromJson.length+" bytes)");a.suspendDrawing=!1;a.loadFromJson.length||a.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)}):(this.loadFromJson=localStorage.getItem("__c2save_"+l)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)"),this.suspendDrawing=!1,a.loadFromJson.length||a.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)),this.saveToSlot=this.loadFromSlot="");this.loadFromJson.length&&(this.ClearDeathRow(),this.loadFromJSONString(this.loadFromJson),this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.loadFromJson=this.lastSaveJson="")};a.prototype.saveToJSONString=function(){var a,c,f,b,d,s,m,e={c2save:!0,version:1,rt:{time:this.kahanTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}};a=0;for(c=this.types_by_index.length;a<c;a++)if(d=this.types_by_index[a],!d.is_family&&!this.typeHasNoSaveBehavior(d)){s={instances:[]};cr.hasAnyOwnProperty(d.extra)&&(s.ex=h(d.extra));f=0;for(b=d.instances.length;f<b;f++)s.instances.push(this.saveInstanceToJSON(d.instances[f]));e.types[d.sid.toString()]=s}a=0;for(c=this.layouts_by_index.length;a<c;a++)f=this.layouts_by_index[a],e.layouts[f.sid.toString()]=f.saveToJSON();b=e.events.groups;a=0;for(c=this.allGroups.length;a<c;a++)f=this.allGroups[a],b[f.sid.toString()]=!!this.activeGroups[f.group_name];c=e.events.cnds;for(m in this.cndsBySid)this.cndsBySid.hasOwnProperty(m)&&(a=this.cndsBySid[m],cr.hasAnyOwnProperty(a.extra)&&(c[m]={ex:h(a.extra)}));c=e.events.acts;for(m in this.actsBySid)this.actsBySid.hasOwnProperty(m)&&(a=this.actsBySid[m],cr.hasAnyOwnProperty(a.extra)&&(c[m]={ex:a.extra}));c=e.events.vars;for(m in this.varsBySid)this.varsBySid.hasOwnProperty(m)&&(a=this.varsBySid[m],a.is_constant||a.parent&&!a.is_static||(c[m]=a.data));e.system=this.system.saveToJSON();return JSON.stringify(e)};a.prototype.refreshUidMap=function(){var a,c,f,b,d,s;this.objectsByUid={};a=0;for(c=this.types_by_index.length;a<c;a++)if(f=this.types_by_index[a],!f.is_family)for(b=0,d=f.instances.length;b<d;b++)s=f.instances[b],this.objectsByUid[s.uid.toString()]=s};a.prototype.loadFromJSONString=function(a){a=JSON.parse(a);if(a.c2save&&!(1<a.version)){var c=a.rt;this.kahanTime.reset();this.kahanTime.sum=c.time;this.timescale=c.timescale;this.tickcount=c.tickcount;this.execcount=c.execcount;this.start_time=Date.now()-c.start_time_offset;var f=c.running_layout;if(f!==this.running_layout.sid)if(f=this.getLayoutBySid(f))this.doChangeLayout(f);else return;this.isLoadingState=!0;var b,d,s,m,e,l,h;l=a.types;for(d in l)if(l.hasOwnProperty(d)&&(m=this.getObjectTypeBySid(parseInt(d,10)))&&!m.is_family&&!this.typeHasNoSaveBehavior(m)){l[d].ex?m.extra=l[d].ex:cr.wipe(m.extra);e=m.instances;s=l[d].instances;f=0;for(b=cr.min(e.length,s.length);f<b;f++)this.loadInstanceFromJSON(e[f],s[f]);f=s.length;for(b=e.length;f<b;f++)this.DestroyInstance(e[f]);f=e.length;for(b=s.length;f<b;f++){e=null;if(m.plugin.is_world&&(e=this.running_layout.getLayerBySid(s[f].w.l),!e))continue;e=this.createInstanceFromInit(m.default_instance,e,!1,0,0,!0);this.loadInstanceFromJSON(e,s[f])}m.stale_iids=!0}this.ClearDeathRow();this.refreshUidMap();b=a.layouts;for(d in b)b.hasOwnProperty(d)&&(f=this.getLayoutBySid(parseInt(d,10)))&&f.loadFromJSON(b[d]);b=a.events.groups;for(d in b)b.hasOwnProperty(d)&&(f=this.getGroupBySid(parseInt(d,10)))&&(this.activeGroups[f.group_name]=b[d]);f=a.events.cnds;for(d in f)f.hasOwnProperty(d)&&this.cndsBySid.hasOwnProperty(d)&&(this.cndsBySid[d].extra=f[d].ex);f=a.events.acts;for(d in f)f.hasOwnProperty(d)&&this.actsBySid.hasOwnProperty(d)&&(this.actsBySid[d].extra=f[d].ex);f=a.events.vars;for(d in f)f.hasOwnProperty(d)&&this.varsBySid.hasOwnProperty(d)&&(this.varsBySid[d].data=f[d]);this.next_uid=c.next_uid;this.isLoadingState=!1;this.system.loadFromJSON(a.system);f=0;for(b=this.types_by_index.length;f<b;f++)if(m=this.types_by_index[f],!m.is_family)for(d=0,a=m.instances.length;d<a;d++){e=m.instances[d];if(m.is_contained)for(l=e.get_iid(),c=e.siblings.length=0,s=m.container.length;c<s;c++)h=m.container[c],m!==h&&e.siblings.push(h.instances[l]);e.afterLoad&&e.afterLoad();if(e.behavior_insts)for(c=0,s=e.behavior_insts.length;c<s;c++)l=e.behavior_insts[c],l.afterLoad&&l.afterLoad()}this.redraw=!0}};a.prototype.saveInstanceToJSON=function(a){var c,f,b,d,e;d=a.type;b=d.plugin;var m={uid:a.uid};cr.hasAnyOwnProperty(a.extra)&&(m.ex=h(a.extra));if(a.instance_vars&&a.instance_vars.length)for(m.ivs={},c=0,f=a.instance_vars.length;c<f;c++)m.ivs[a.type.instvar_sids[c].toString()]=a.instance_vars[c];if(b.is_world){b={x:a.x,y:a.y,w:a.width,h:a.height,l:a.layer.sid,zi:a.get_zindex()};0!==a.angle&&(b.a=a.angle);1!==a.opacity&&(b.o=a.opacity);0.5!==a.hotspotX&&(b.hX=a.hotspotX);0.5!==a.hotspotY&&(b.hY=a.hotspotY);0!==a.blend_mode&&(b.bm=a.blend_mode);a.visible||(b.v=a.visible);a.collisionsEnabled||(b.ce=a.collisionsEnabled);-1!==a.my_timescale&&(b.mts=a.my_timescale);if(d.effect_types.length)for(b.fx=[],c=0,f=d.effect_types.length;c<f;c++)e=d.effect_types[c],b.fx.push({name:e.name,active:a.active_effect_flags[e.index],params:a.effect_params[e.index]});m.w=b}if(a.behavior_insts&&a.behavior_insts.length)for(m.behs={},c=0,f=a.behavior_insts.length;c<f;c++)d=a.behavior_insts[c],d.saveToJSON&&(m.behs[d.type.sid.toString()]=d.saveToJSON());a.saveToJSON&&(m.data=a.saveToJSON());return m};a.prototype.getInstanceVarIndexBySid=function(a,c){var f,b;f=0;for(b=a.instvar_sids.length;f<b;f++)if(a.instvar_sids[f]===c)return f;return-1};a.prototype.getBehaviorIndexBySid=function(a,c){var f,b;f=0;for(b=a.behavior_insts.length;f<b;f++)if(a.behavior_insts[f].type.sid===c)return f;return-1};a.prototype.loadInstanceFromJSON=function(a,c){var f,b,d,e,m,l;l=a.type;d=l.plugin;a.uid=c.uid;c.ex?a.extra=c.ex:cr.wipe(a.extra);if(b=c.ivs)for(f in b)b.hasOwnProperty(f)&&(e=this.getInstanceVarIndexBySid(l,parseInt(f,10)),0>e||e>=a.instance_vars.length||(a.instance_vars[e]=b[f]));if(d.is_world){e=c.w;a.layer.sid!==e.l&&(b=a.layer,a.layer=this.running_layout.getLayerBySid(e.l),a.layer?(a.layer.instances.push(a),a.layer.zindices_stale=!0,cr.arrayFindRemove(b.instances,a),b.zindices_stale=!0):(a.layer=b,this.DestroyInstance(a)));a.x=e.x;a.y=e.y;a.width=e.w;a.height=e.h;a.zindex=e.zi;a.angle=e.hasOwnProperty("a")?e.a:0;a.opacity=e.hasOwnProperty("o")?e.o:1;a.hotspotX=e.hasOwnProperty("hX")?e.hX:0.5;a.hotspotY=e.hasOwnProperty("hY")?e.hY:0.5;a.visible=e.hasOwnProperty("v")?e.v:!0;a.collisionsEnabled=e.hasOwnProperty("ce")?e.ce:!0;a.my_timescale=e.hasOwnProperty("mts")?e.mts:-1;a.blend_mode=e.hasOwnProperty("bm")?e.bm:0;a.compositeOp=cr.effectToCompositeOp(a.blend_mode);this.gl&&cr.setGLBlend(a,a.blend_mode,this.gl);a.set_bbox_changed();if(e.hasOwnProperty("fx"))for(b=0,d=e.fx.length;b<d;b++)m=l.getEffectIndexByName(e.fx[b].name),0>m||(a.active_effect_flags[m]=e.fx[b].active,a.effect_params[m]=e.fx[b].params);a.updateActiveEffects()}if(l=c.behs)for(f in l)l.hasOwnProperty(f)&&(e=this.getBehaviorIndexBySid(a,parseInt(f,10)),0>e||a.behavior_insts[e].loadFromJSON(l[f]));c.data&&a.loadFromJSON(c.data)};cr.runtime=a;cr.createRuntime=function(c){return new a(document.getElementById(c))};cr.createDCRuntime=function(c,f){return new a({dc:!0,width:c,height:f})};window.cr_createRuntime=cr.createRuntime;window.cr_createDCRuntime=cr.createDCRuntime;window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var c=document.createElement("screencanvas")||document.createElement("canvas");document.body.appendChild(c);c=new a(c);window.c2runtime=c;window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)});window.c2runtime.setSize(window.innerWidth,window.innerHeight);return c}})();window.cr_getC2Runtime=function(){var a=document.getElementById("c2canvas");return a?a.c2runtime:window.c2runtime?window.c2runtime:null};window.cr_sizeCanvas=function(a,b){if(0!==a&&0!==b){var d=window.cr_getC2Runtime();d&&d.setSize(a,b)}};window.cr_setSuspended=function(a){var b=window.cr_getC2Runtime();b&&b.setSuspended(a)};(function(){function a(a,b){this.runtime=a;this.event_sheet=null;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;this.scale=1;this.angle=0;this.first_visit=!0;this.name=b[0];this.width=b[1];this.height=b[2];this.unbounded_scrolling=b[3];this.sheetname=b[4];this.sid=b[5];var d=b[6],c,e;this.layers=[];this.initial_types=[];c=0;for(e=d.length;c<e;c++){var n=new cr.layer(this,d[c]);n.number=c;cr.seal(n);this.layers.push(n)}d=b[7];this.initial_nonworld=[];c=0;for(e=d.length;c<e;c++){var n=d[c],l=this.runtime.types_by_index[n[1]];l.default_instance||(l.default_instance=n);this.initial_nonworld.push(n);-1===this.initial_types.indexOf(l)&&this.initial_types.push(l)}this.effect_types=[];this.active_effect_types=[];this.effect_params=[];c=0;for(e=b[8].length;c<e;c++)this.effect_types.push({id:b[8][c][0],name:b[8][c][1],shaderindex:-1,active:!0,index:c}),this.effect_params.push(b[8][c][2].slice(0));this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1);this.persist_data={}}function b(a,b){this.layout=a;this.runtime=a.runtime;this.instances=[];this.scale=1;this.angle=0;this.disableAngle=!1;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad;this.viewBottom=this.viewTop=this.viewRight=this.viewLeft=0;this.zindices_stale=!1;this.name=b[0];this.index=b[1];this.sid=b[2];this.visible=b[3];this.background_color=b[4];this.transparent=b[5];this.parallaxX=b[6];this.parallaxY=b[7];this.opacity=b[8];this.forceOwnTexture=b[9];this.zoomRate=b[10];this.blend_mode=b[11];this.effect_fallback=b[12];this.compositeOp="source-over";this.destBlend=this.srcBlend=0;this.render_offscreen=!1;var d=b[13],c,e;this.initial_instances=[];c=0;for(e=d.length;c<e;c++){var n=d[c],l=this.runtime.types_by_index[n[1]];l.default_instance||(l.default_instance=n);this.initial_instances.push(n);-1===this.layout.initial_types.indexOf(l)&&this.layout.initial_types.push(l)}this.effect_types=[];this.active_effect_types=[];this.effect_params=[];c=0;for(e=b[14].length;c<e;c++)this.effect_types.push({id:b[14][c][0],name:b[14][c][1],shaderindex:-1,active:!0,index:c}),this.effect_params.push(b[14][c][2].slice(0));this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1)}function d(a,b){return a.zindex-b.zindex}a.prototype.saveObjectToPersist=function(a){var b=a.type.sid.toString();this.persist_data.hasOwnProperty(b)||(this.persist_data[b]=[]);this.persist_data[b].push(this.runtime.saveInstanceToJSON(a))};a.prototype.hasOpaqueBottomLayer=function(){var a=this.layers[0];return!a.transparent&&1===a.opacity&&!a.forceOwnTexture&&a.visible};a.prototype.updateActiveEffects=function(){this.active_effect_types.length=0;var a,b,d;a=0;for(b=this.effect_types.length;a<b;a++)d=this.effect_types[a],d.active&&this.active_effect_types.push(d)};a.prototype.getEffectByName=function(a){var b,d,c;b=0;for(d=this.effect_types.length;b<d;b++)if(c=this.effect_types[b],c.name===a)return c;return null};var e=[];a.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname]);this.runtime.running_layout=this;this.scrollX=this.runtime.original_width/2;this.scrollY=this.runtime.original_height/2;var a,b,k,c,r,n,l;a=0;for(k=this.runtime.types_by_index.length;a<k;a++)if(b=this.runtime.types_by_index[a],!b.is_family)for(r=b.instances,b=0,c=r.length;b<c;b++)if(n=r[b],n.layer){var q=n.layer.number;q>=this.layers.length&&(q=this.layers.length-1);n.layer=this.layers[q];n.layer.instances.push(n);n.layer.zindices_stale=!0}e.length=0;this.boundScrolling();a=0;for(k=this.layers.length;a<k;a++)n=this.layers[a],n.createInitialInstances(),n.disableAngle=!0,b=n.canvasToLayer(0,0,!0),c=n.canvasToLayer(0,0,!1),n.disableAngle=!1,this.runtime.pixel_rounding&&(b=b+0.5|0,c=c+0.5|0),n.rotateViewport(b,c,null);r=!1;if(!this.first_visit){for(l in this.persist_data)if(this.persist_data.hasOwnProperty(l)&&(b=this.runtime.getObjectTypeBySid(parseInt(l,10)))&&!b.is_family&&this.runtime.typeHasPersistBehavior(b)){c=this.persist_data[l];a=0;for(k=c.length;a<k;a++){n=null;if(b.plugin.is_world&&(n=this.getLayerBySid(c[a].w.l),!n))continue;n=this.runtime.createInstanceFromInit(b.default_instance,n,!1,0,0,!0);this.runtime.loadInstanceFromJSON(n,c[a]);r=!0;e.push(n)}c.length=0}a=0;for(k=this.layers.length;a<k;a++)this.layers[a].instances.sort(d),this.layers[a].zindices_stale=!0}r&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap());for(a=0;a<e.length;a++)if(n=e[a],n.type.is_contained)for(k=n.get_iid(),b=0,c=n.type.container.length;b<c;b++)l=n.type.container[b],n.type!==l&&(l.instances.length>k?n.siblings.push(l.instances[k]):l.default_instance&&(r=this.runtime.createInstanceFromInit(l.default_instance,n.layer,!0,n.x,n.y,!0),this.runtime.ClearDeathRow(),l.updateIIDs(),n.siblings.push(r),e.push(r)));a=0;for(k=this.initial_nonworld.length;a<k;a++)this.runtime.createInstanceFromInit(this.initial_nonworld[a],null,!0);this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx&&!this.runtime.isDomFree)for(a=0,k=this.runtime.types_by_index.length;a<k;a++)l=this.runtime.types_by_index[a],!l.is_family&&(l.instances.length&&l.preloadCanvas2D)&&l.preloadCanvas2D(this.runtime.ctx);a=0;for(k=e.length;a<k;a++)n=e[a],this.runtime.trigger(Object.getPrototypeOf(n.type.plugin).cnds.OnCreated,n);e.length=0;this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null);this.first_visit=!1};a.prototype.createGlobalNonWorlds=function(){var a,b,d,c,e;b=a=0;for(d=this.initial_nonworld.length;a<d;a++)c=this.initial_nonworld[a],e=this.runtime.types_by_index[c[1]],e.global?this.runtime.createInstanceFromInit(c,null,!0):(this.initial_nonworld[b]=c,b++);this.initial_nonworld.length=b};a.prototype.stopRunning=function(){this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null);this.runtime.system.waits.length=0;var a,b,d,c,e,n;a=0;for(b=this.layers.length;a<b;a++){e=this.layers[a].instances;d=0;for(c=e.length;d<c;d++)n=e[d],n.type.global||(this.runtime.typeHasPersistBehavior(n.type)&&this.saveObjectToPersist(n),this.runtime.DestroyInstance(n));this.runtime.ClearDeathRow();e.length=0;this.layers[a].zindices_stale=!0}a=0;for(b=this.runtime.types_by_index.length;a<b;a++)if(e=this.runtime.types_by_index[a],!(e.global||e.plugin.is_world||e.plugin.singleglobal||e.is_family)){d=0;for(c=e.instances.length;d<c;d++)this.runtime.DestroyInstance(e.instances[d]);this.runtime.ClearDeathRow()}};a.prototype.draw=function(a){a.globalAlpha=1;a.globalCompositeOperation="source-over";this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clearRect(0,0,this.runtime.width,this.runtime.height);var b,d,c;b=0;for(d=this.layers.length;b<d;b++)c=this.layers[b],c.visible&&(0<c.opacity&&11!==c.blend_mode)&&c.draw(a)};a.prototype.drawGL=function(a){var b=0<this.active_effect_types.length||this.runtime.uses_background_blending;if(b){this.runtime.layout_tex||(this.runtime.layout_tex=a.createEmptyTexture(this.runtime.width,this.runtime.height,this.runtime.linearSampling));if(this.runtime.layout_tex.c2width!==this.runtime.width||this.runtime.layout_tex.c2height!==this.runtime.height)a.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=a.createEmptyTexture(this.runtime.width,this.runtime.height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layout_tex)}this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&a.clear(0,0,0,0);var d,c;d=0;for(c=this.layers.length;d<c;d++)this.layers[d].visible&&0<this.layers[d].opacity&&this.layers[d].drawGL(a);b&&(1>=this.active_effect_types.length?(1===this.active_effect_types.length?(b=this.active_effect_types[0].index,a.switchProgram(this.active_effect_types[0].shaderindex),a.setProgramParameters(null,1/this.runtime.width,1/this.runtime.height,0,0,1,1,this.scale,this.effect_params[b]),a.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(null),a.setOpacity(1),a.setTexture(this.runtime.layout_tex),a.setAlphaBlend(),a.resetModelView(),a.updateModelView(),b=this.runtime.width/2,d=this.runtime.height/2,a.quad(-b,d,b,d,b,-d,-b,-d),a.setTexture(null)):this.renderEffectChain(a,null,null,null));a.present()};a.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending?this.runtime.layout_tex:null};a.prototype.getMinLayerScale=function(){var a=this.layers[0].getScale(),b,d,c;b=1;for(d=this.layers.length;b<d;b++)c=this.layers[b],(0!==c.parallaxX||0!==c.parallaxY)&&c.getScale()<a&&(a=c.getScale());return a};a.prototype.scrollToX=function(a){if(!this.unbounded_scrolling){var b=this.runtime.width*(1/this.getMinLayerScale())/2;a>this.width-b&&(a=this.width-b);a<b&&(a=b)}this.scrollX!==a&&(this.scrollX=a,this.runtime.redraw=!0)};a.prototype.scrollToY=function(a){if(!this.unbounded_scrolling){var b=this.runtime.height*(1/this.getMinLayerScale())/2;a>this.height-b&&(a=this.height-b);a<b&&(a=b)}this.scrollY!==a&&(this.scrollY=a,this.runtime.redraw=!0)};a.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};a.prototype.renderEffectChain=function(a,b,d,c){var e=d?d.active_effect_types:b?b.active_effect_types:this.active_effect_types,n=d?d.layer.getScale():b?b.getScale():1,l=this.runtime.fx_tex,q,v,t,p,g=0,u=1,D,B=this.runtime.width,s=this.runtime.height,m=B/2,P=s/2,x=b?b.rcTex:this.rcTex,z=b?b.rcTex2:this.rcTex2,G=0,C=0,F=0,y=0,H=B,Q=B,w=s,N=s,R=t=0,W=d?d.layer.getAngle():0;if(d){q=0;for(v=e.length;q<v;q++)t+=a.getProgramBoxExtendHorizontal(e[q].shaderindex),R+=a.getProgramBoxExtendVertical(e[q].shaderindex);p=d.bbox;G=b.layerToCanvas(p.left,p.top,!0);F=b.layerToCanvas(p.left,p.top,!1);H=b.layerToCanvas(p.right,p.bottom,!0);w=b.layerToCanvas(p.right,p.bottom,!1);0!==W&&(q=b.layerToCanvas(p.right,p.top,!0),v=b.layerToCanvas(p.right,p.top,!1),C=b.layerToCanvas(p.left,p.bottom,!0),y=b.layerToCanvas(p.left,p.bottom,!1),p=Math.min(G,H,q,C),H=Math.max(G,H,q,C),G=p,p=Math.min(F,w,v,y),w=Math.max(F,w,v,y),F=p);G-=t;F-=R;H+=t;w+=R;z.left=G/B;z.top=1-F/s;z.right=H/B;z.bottom=1-w/s;C=G=Math.floor(G);y=F=Math.floor(F);Q=H=Math.ceil(H);N=w=Math.ceil(w);C-=t;y-=R;Q+=t;N+=R;0>G&&(G=0);0>F&&(F=0);H>B&&(H=B);w>s&&(w=s);0>C&&(C=0);0>y&&(y=0);Q>B&&(Q=B);N>s&&(N=s);x.left=G/B;x.top=1-F/s;x.right=H/B;x.bottom=1-w/s}else x.left=z.left=0,x.top=z.top=0,x.right=z.right=1,x.bottom=z.bottom=1;R=d&&((d.angle||W)&&a.programUsesDest(e[0].shaderindex)||0!==t||0!==R||1!==d.opacity||d.type.plugin.must_predraw)||b&&!d&&1!==b.opacity;a.setAlphaBlend();if(R){l[g]||(l[g]=a.createEmptyTexture(B,s,this.runtime.linearSampling));if(l[g].c2width!==B||l[g].c2height!==s)a.deleteTexture(l[g]),l[g]=a.createEmptyTexture(B,s,this.runtime.linearSampling);a.switchProgram(0);a.setRenderingToTexture(l[g]);D=N-y;a.clearRect(C,s-y-D,Q-C,D);d?d.drawGL(a):(a.setTexture(this.runtime.layer_tex),a.setOpacity(b.opacity),a.resetModelView(),a.translate(-m,-P),a.updateModelView(),a.quadTex(G,w,H,w,H,F,G,F,x));z.left=z.top=0;z.right=z.bottom=1;d&&(p=x.top,x.top=x.bottom,x.bottom=p);g=1;u=0}a.setOpacity(1);t=e.length-1;var W=a.programUsesCrossSampling(e[t].shaderindex),U=0;q=0;for(v=e.length;q<v;q++){l[g]||(l[g]=a.createEmptyTexture(B,s,this.runtime.linearSampling));if(l[g].c2width!==B||l[g].c2height!==s)a.deleteTexture(l[g]),l[g]=a.createEmptyTexture(B,s,this.runtime.linearSampling);a.switchProgram(e[q].shaderindex);U=e[q].index;a.programIsAnimated(e[q].shaderindex)&&(this.runtime.redraw=!0);0!=q||R?(a.setProgramParameters(c,1/B,1/s,z.left,z.top,z.right,z.bottom,n,d?d.effect_params[U]:b?b.effect_params[U]:this.effect_params[U]),q!==t||W?(a.setRenderingToTexture(l[g]),D=N-y,p=s-y-D,a.clearRect(C,p,Q-C,D)):(d?a.setBlend(d.srcBlend,d.destBlend):b&&a.setBlend(b.srcBlend,b.destBlend),a.setRenderingToTexture(c)),a.setTexture(l[u]),a.resetModelView(),a.translate(-m,-P),a.updateModelView(),a.quadTex(G,w,H,w,H,F,G,F,x),q!==t||W||a.setTexture(null)):(a.setRenderingToTexture(l[g]),D=N-y,p=s-y-D,a.clearRect(C,p,Q-C,D),d?(a.setProgramParameters(c,1/d.width,1/d.height,z.left,z.top,z.right,z.bottom,n,d.effect_params[U]),d.drawGL(a)):(a.setProgramParameters(c,1/B,1/s,0,0,1,1,n,b?b.effect_params[U]:this.effect_params[U]),a.setTexture(b?this.runtime.layer_tex:this.runtime.layout_tex),a.resetModelView(),a.translate(-m,-P),a.updateModelView(),a.quadTex(G,w,H,w,H,F,G,F,x)),z.left=z.top=0,z.right=z.bottom=1,d&&!W&&(p=w,w=F,F=p));g=0===g?1:0;u=0===g?1:0}W&&(a.switchProgram(0),d?a.setBlend(d.srcBlend,d.destBlend):b&&a.setBlend(b.srcBlend,b.destBlend),a.setRenderingToTexture(c),a.setTexture(l[u]),a.resetModelView(),a.translate(-m,-P),a.updateModelView(),d&&1===e.length&&!R?a.quadTex(G,F,H,F,H,w,G,w,x):a.quadTex(G,w,H,w,H,F,G,F,x),a.setTexture(null))};a.prototype.getLayerBySid=function(a){var b,d;b=0;for(d=this.layers.length;b<d;b++)if(this.layers[b].sid===a)return this.layers[b];return null};a.prototype.saveToJSON=function(){var a,b,d,c={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}};a=0;for(b=this.effect_types.length;a<b;a++)d=this.effect_types[a],c.fx.push({name:d.name,active:d.active,params:this.effect_params[d.index]});a=0;for(b=this.layers.length;a<b;a++)d=this.layers[a],c.layers[d.sid.toString()]=d.saveToJSON();return c};a.prototype.loadFromJSON=function(a){var b,d,c,e;this.scrollX=a.sx;this.scrollY=a.sy;this.scale=a.s;this.angle=a.a;this.width=a.w;this.height=a.h;this.persist_data=a.persist;"undefined"!==typeof a.fv&&(this.first_visit=a.fv);var n=a.fx;b=0;for(d=n.length;b<d;b++)if(c=this.getEffectByName(n[b].name))c.active=n[b].active,this.effect_params[c.index]=n[b].params;this.updateActiveEffects();b=a.layers;for(e in b)b.hasOwnProperty(e)&&(a=this.getLayerBySid(parseInt(e,10)))&&a.loadFromJSON(b[e])};cr.layout=a;b.prototype.updateActiveEffects=function(){this.active_effect_types.length=0;var a,b,d;a=0;for(b=this.effect_types.length;a<b;a++)d=this.effect_types[a],d.active&&this.active_effect_types.push(d)};b.prototype.getEffectByName=function(a){var b,d,c;b=0;for(d=this.effect_types.length;b<d;b++)if(c=this.effect_types[b],c.name===a)return c;return null};b.prototype.createInitialInstances=function(){var a,b,d,c,r,n;b=a=0;for(d=this.initial_instances.length;a<d;a++){c=this.initial_instances[a];r=this.runtime.types_by_index[c[1]];n=this.runtime.typeHasPersistBehavior(r);r=!0;if(!n||this.layout.first_visit)c=this.runtime.createInstanceFromInit(c,this,!0),e.push(c),c.type.global&&(r=!1);r&&(this.initial_instances[b]=this.initial_instances[a],b++)}this.initial_instances.length=b;this.runtime.ClearDeathRow();!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback);this.compositeOp=cr.effectToCompositeOp(this.blend_mode);this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl)};b.prototype.updateZIndices=function(){if(this.zindices_stale){var a,b;a=0;for(b=this.instances.length;a<b;a++)this.instances[a].zindex=a;this.zindices_stale=!1}};b.prototype.getScale=function(){return this.getNormalScale()*this.runtime.aspect_scale};b.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1};b.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};b.prototype.draw=function(a){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var b=this.runtime.canvas,d=a;a.globalAlpha=1;a.globalCompositeOperation="source-over";this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),b=this.runtime.layer_canvas,b.width=this.runtime.width,b.height=this.runtime.height,this.runtime.layer_ctx=b.getContext("2d")),b=this.runtime.layer_canvas,d=this.runtime.layer_ctx,b.width!==this.runtime.width&&(b.width=this.runtime.width),b.height!==this.runtime.height&&(b.height=this.runtime.height),this.transparent&&d.clearRect(0,0,this.runtime.width,this.runtime.height));this.transparent||(d.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",d.fillRect(0,0,this.runtime.width,this.runtime.height));d.save();this.disableAngle=!0;var c=this.canvasToLayer(0,0,!0),e=this.canvasToLayer(0,0,!1);this.disableAngle=!1;this.runtime.pixel_rounding&&(c=c+0.5|0,e=e+0.5|0);this.rotateViewport(c,e,d);var n=this.getScale();d.scale(n,n);d.translate(-c,-e);for(var l,c=0,e=this.instances.length;c<e;c++)n=this.instances[c],n.visible&&(0!==n.width&&0!==n.height)&&(n.update_bbox(),l=n.bbox,l.right<this.viewLeft||(l.bottom<this.viewTop||l.left>this.viewRight||l.top>this.viewBottom)||(d.globalCompositeOperation=n.compositeOp,n.draw(d)));d.restore();this.render_offscreen&&(a.globalCompositeOperation=this.compositeOp,a.globalAlpha=this.opacity,a.drawImage(b,0,0))};b.prototype.rotateViewport=function(a,b,d){var c=this.getScale();this.viewLeft=a;this.viewTop=b;this.viewRight=a+this.runtime.width*(1/c);this.viewBottom=b+this.runtime.height*(1/c);a=this.getAngle();0!==a&&(d&&(d.translate(this.runtime.width/2,this.runtime.height/2),d.rotate(-a),d.translate(this.runtime.width/-2,this.runtime.height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)};b.prototype.drawGL=function(a){var b=this.runtime.width,d=this.runtime.height,c=0,e=0;if(this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode){this.runtime.layer_tex||(this.runtime.layer_tex=a.createEmptyTexture(this.runtime.width,this.runtime.height,this.runtime.linearSampling));if(this.runtime.layer_tex.c2width!==this.runtime.width||this.runtime.layer_tex.c2height!==this.runtime.height)a.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=a.createEmptyTexture(this.runtime.width,this.runtime.height,this.runtime.linearSampling);a.setRenderingToTexture(this.runtime.layer_tex);this.transparent&&a.clear(0,0,0,0)}this.transparent||a.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1);this.disableAngle=!0;var e=this.canvasToLayer(0,0,!0),n=this.canvasToLayer(0,0,!1);this.disableAngle=!1;this.runtime.pixel_rounding&&(e=e+0.5|0,n=n+0.5|0);this.rotateViewport(e,n,null);n=this.getScale();a.resetModelView();a.scale(n,n);a.rotateZ(-this.getAngle());a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);a.updateModelView();var l,q,v;l=0;for(q=this.instances.length;l<q;l++)if(v=this.instances[l],v.visible&&(0!==v.width&&0!==v.height)&&(v.update_bbox(),c=v.bbox,!(c.right<this.viewLeft||c.bottom<this.viewTop||c.left>this.viewRight||c.top>this.viewBottom)))if(v.uses_shaders)if(c=v.active_effect_types[0].shaderindex,e=v.active_effect_types[0].index,1!==v.active_effect_types.length||a.programUsesCrossSampling(c)||a.programExtendsBox(c)||(v.angle||v.layer.getAngle())&&a.programUsesDest(c)||1!==v.opacity||v.type.plugin.must_predraw)this.layout.renderEffectChain(a,this,v,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),a.resetModelView(),a.scale(n,n),a.rotateZ(-this.getAngle()),a.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),a.updateModelView();else{a.switchProgram(c);a.setBlend(v.srcBlend,v.destBlend);a.programIsAnimated(c)&&(this.runtime.redraw=!0);var t=0,p=0,g=0,u=0;a.programUsesDest(c)&&(c=v.bbox,t=this.layerToCanvas(c.left,c.top,!0),p=this.layerToCanvas(c.left,c.top,!1),g=this.layerToCanvas(c.right,c.bottom,!0),c=this.layerToCanvas(c.right,c.bottom,!1),t/=b,p=1-p/d,g/=b,u=1-c/d);a.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),1/v.width,1/v.height,t,p,g,u,this.getScale(),v.effect_params[e]);v.drawGL(a)}else a.switchProgram(0),a.setBlend(v.srcBlend,v.destBlend),v.drawGL(a);this.render_offscreen&&(c=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,e=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!a.programUsesCrossSampling(c)&&1===this.opacity?(1===this.active_effect_types.length?(a.switchProgram(c),a.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.width,1/this.runtime.height,0,0,1,1,this.getScale(),this.effect_params[e]),a.programIsAnimated(c)&&(this.runtime.redraw=!0)):a.switchProgram(0),a.setRenderingToTexture(this.layout.getRenderTarget()),a.setOpacity(this.opacity),a.setTexture(this.runtime.layer_tex),a.setBlend(this.srcBlend,this.destBlend),a.resetModelView(),a.updateModelView(),b=this.runtime.width/2,d=this.runtime.height/2,a.quad(-b,d,b,d,b,-d,-b,-d),a.setTexture(null)):this.layout.renderEffectChain(a,this,null,this.layout.getRenderTarget()))};b.prototype.canvasToLayer=function(a,b,d){var c=this.runtime.devicePixelRatio;this.runtime.isRetina&&0<this.runtime.fullscreen_mode&&(a*=c,b*=c);var c=this.runtime.original_width/2,e=this.runtime.original_height/2,c=(this.layout.scrollX-c)*this.parallaxX+c,e=(this.layout.scrollY-e)*this.parallaxY+e,n=1/this.getScale(),c=c-this.runtime.width*n/2,e=e-this.runtime.height*n/2,c=c+a*n,e=e+b*n;b=this.getAngle();0!==b&&(c-=this.layout.scrollX,e-=this.layout.scrollY,a=Math.cos(b),b=Math.sin(b),n=c*a-e*b,e=e*a+c*b,c=n+this.layout.scrollX,e+=this.layout.scrollY);return d?c:e};b.prototype.layerToCanvas=function(a,b,d){var c=this.getAngle();if(0!==c){a-=this.layout.scrollX;b-=this.layout.scrollY;var e=Math.cos(-c),c=Math.sin(-c),n=a*e-b*c;b=b*e+a*c;a=n+this.layout.scrollX;b+=this.layout.scrollY}e=this.runtime.original_width/2;c=this.runtime.original_height/2;e=(this.layout.scrollX-e)*this.parallaxX+e;c=(this.layout.scrollY-c)*this.parallaxY+c;n=1/this.getScale();e-=this.runtime.width*n/2;c-=this.runtime.height*n/2;e=(a-e)/n;c=(b-c)/n;a=this.runtime.devicePixelRatio;this.runtime.isRetina&&0<this.runtime.fullscreen_mode&&(e/=a,c/=a);return d?e:c};b.prototype.rotatePt=function(a,b,d){if(0===this.getAngle())return d?a:b;var c=this.layerToCanvas(a,b,!0);b=this.layerToCanvas(a,b,!1);this.disableAngle=!0;a=this.canvasToLayer(c,b,!0);c=this.canvasToLayer(c,b,!0);this.disableAngle=!1;return d?a:c};b.prototype.saveToJSON=function(){var a,b,d,c={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],instances:[]};a=0;for(b=this.effect_types.length;a<b;a++)d=this.effect_types[a],c.fx.push({name:d.name,active:d.active,params:this.effect_params[d.index]});return c};b.prototype.loadFromJSON=function(a){var b,e;this.scale=a.s;this.angle=a.a;this.viewLeft=a.vl;this.viewTop=a.vt;this.viewRight=a.vr;this.viewBottom=a.vb;this.visible=a.v;this.background_color=a.bc;this.transparent=a.t;this.parallaxX=a.px;this.parallaxY=a.py;this.opacity=a.o;this.zoomRate=a.zr;var c=a.fx;a=0;for(b=c.length;a<b;a++)if(e=this.getEffectByName(c[a].name))e.active=c[a].active,this.effect_params[e.index]=c[a].params;this.updateActiveEffects();this.instances.sort(d);this.zindices_stale=!0};cr.layer=b})();(function(){function a(a,c){var b,d=a.length;switch(d){case 0:return!0;case 1:return a[0]===c[0];case 2:return a[0]===c[0]&&a[1]===c[1];default:for(b=0;b<d;b++)if(a[b]!==c[b])return!1;return!0}}function b(a,c){return a.index-c.index}function d(c){var d,e,f,m;2===c.length?c[0].index>c[1].index&&(d=c[0],c[0]=c[1],c[1]=d):2<c.length&&c.sort(b);c.length>=t.length&&(t.length=c.length+1);t[c.length]||(t[c.length]=[]);m=t[c.length];d=0;for(e=m.length;d<e;d++)if(f=m[d],a(c,f))return f;m.push(c);return c}function e(a,c){this.runtime=a;this.triggers={};this.fasttriggers={};this.hasRun=!1;this.includes=new cr.ObjectSet;this.name=c[0];var b=c[1];this.events=[];var d,e;d=0;for(e=b.length;d<e;d++)this.init_event(b[d],null,this.events)}function f(a){this.type=a;this.instances=[];this.else_instances=[];this.select_all=!0}function h(a,c,b){this.sheet=a;this.parent=c;this.runtime=a.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.has_else_block=this.toplevelgroup=this.toplevelevent=this.initially_activated=this.group=this.solWriterAfterCnds=!1;this.conditions=[];this.actions=[];this.subevents=[];b[1]?(this.group_name=b[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!b[1][0],this.runtime.allGroups.push(this),this.runtime.activeGroups[this.group_name.toLowerCase()]=this.initially_activated):(this.group_name="",this.initially_activated=this.group=!1);this.orblock=b[2];this.sid=b[3];this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var d=b[4];a=0;for(c=d.length;a<c;a++){var e=new cr.condition(this,d[a]);cr.seal(e);this.conditions.push(e);this.addSolModifier(e.type)}d=b[5];a=0;for(c=d.length;a<c;a++)e=new cr.action(this,d[a]),cr.seal(e),this.actions.push(e);if(7===b.length)for(b=b[6],a=0,c=b.length;a<c;a++)this.sheet.init_event(b[a],this,this.subevents);this.is_else_block=!1;this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function k(a,c){var b,d,e;if(a&&(-1===c.indexOf(a)&&c.push(a),a.is_contained))for(b=0,d=a.container.length;b<d;b++)e=a.container[b],a!==e&&-1===c.indexOf(e)&&c.push(e)}function c(a,c){this.block=a;this.sheet=a.sheet;this.runtime=a.runtime;this.parameters=[];this.results=[];this.extra={};this.func=c[1];this.trigger=0<c[3];this.fasttrigger=2===c[3];this.looping=c[4];this.inverted=c[5];this.isstatic=c[6];this.sid=c[7];this.runtime.cndsBySid[this.sid.toString()]=this;-1===c[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[c[0]],this.run=this.isstatic?this.run_static:this.run_object,c[2]?(this.behaviortype=this.type.getBehaviorByName(c[2]),this.beh_index=this.type.getBehaviorIndexByName(c[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds());this.fasttrigger&&(this.run=this.run_true);if(9===c.length){var b,d,e=c[8];b=0;for(d=e.length;b<d;b++){var f=new cr.parameter(this,e[b]);cr.seal(f);this.parameters.push(f)}this.results.length=e.length}}function r(a,c){this.block=a;this.sheet=a.sheet;this.runtime=a.runtime;this.parameters=[];this.results=[];this.extra={};this.func=c[1];-1===c[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[c[0]],this.run=this.run_object,c[2]?(this.behaviortype=this.type.getBehaviorByName(c[2]),this.beh_index=this.type.getBehaviorIndexByName(c[2])):(this.behaviortype=null,this.beh_index=-1));this.sid=c[3];this.runtime.actsBySid[this.sid.toString()]=this;if(5===c.length){var b,d,e=c[4];b=0;for(d=e.length;b<d;b++){var f=new cr.parameter(this,e[b]);cr.seal(f);this.parameters.push(f)}this.results.length=e.length}}function n(a,c){this.owner=a;this.block=a.block;this.sheet=a.sheet;this.runtime=a.runtime;this.type=c[0];this.expression=null;this.combosel=this.solindex=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.variadicret=this.subparams=this.fileinfo=this.eventvar=this.varname=null;var b,d,e;switch(c[0]){case 0:case 7:this.expression=new cr.expNode(this,c[1]);this.solindex=0;this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,c[1]);this.solindex=0;this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,c[1]);this.solindex=0;this.get=this.get_layer;break;case 3:case 8:this.combosel=c[1];this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[c[1]];this.get=this.get_layout;break;case 9:this.key=c[1];this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[c[1]];this.get=this.get_object;this.block.addSolModifier(this.object);this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=c[1];this.get=a.type.is_family?this.get_familyvar:this.get_instvar;break;case 11:this.varname=c[1];this.eventvar=null;this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=c[1];this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],b=1,d=c.length;b<d;b++)e=new cr.parameter(this.owner,c[b]),cr.seal(e),this.subparams.push(e),this.variadicret.push(0)}}function l(a,c,b){this.sheet=a;this.parent=c;this.runtime=a.runtime;this.solModifiers=[];this.name=b[1];this.vartype=b[2];this.initial=b[3];this.is_static=!!b[4];this.is_constant=!!b[5];this.sid=b[6];this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function q(a,c,b){this.sheet=a;this.parent=c;this.runtime=a.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=b[1]}function v(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}var t=[];e.prototype.toString=function(){return this.name};e.prototype.init_event=function(a,c,b){switch(a[0]){case 0:a=new cr.eventblock(this,c,a);cr.seal(a);if(a.orblock)for(b.push(a),b=0,c=a.conditions.length;b<c;b++)a.conditions[b].trigger&&this.init_trigger(a,b);else a.is_trigger()?this.init_trigger(a,0):b.push(a);break;case 1:a=new cr.eventvariable(this,c,a);cr.seal(a);b.push(a);break;case 2:a=new cr.eventinclude(this,c,a),cr.seal(a),b.push(a)}};e.prototype.postInit=function(){var a,c;a=0;for(c=this.events.length;a<c;a++)this.events[a].postInit(a<c-1&&this.events[a+1].is_else_block)};e.prototype.run=function(){this.hasRun=!0;this.runtime.isRunningEvents=!0;var a,c;a=0;for(c=this.events.length;a<c;a++){var b=this.events[a];b.run();this.runtime.clearSol(b.solModifiers);this.runtime.deathRow.isEmpty()&&!this.runtime.createRow.length||this.runtime.ClearDeathRow()}this.runtime.isRunningEvents=!1};e.prototype.init_trigger=function(a,c){a.orblock||this.runtime.triggers_to_postinit.push(a);var b,d,e=a.conditions[c],f;f=e.type?e.type.name:"system";var g=(b=e.fasttrigger)?this.fasttriggers:this.triggers;g[f]||(g[f]=[]);f=g[f];g=e.func;if(b){if(e.parameters.length&&(e=e.parameters[0],1===e.type&&2===e.expression.type)){e=e.expression.value.toLowerCase();b=0;for(d=f.length;b<d;b++)if(f[b].method==g){b=f[b].evs;b[e]?b[e].push([a,c]):b[e]=[[a,c]];return}b={};b[e]=[[a,c]];f.push({method:g,evs:b})}}else{b=0;for(d=f.length;b<d;b++)if(f[b].method==g){f[b].evs.push([a,c]);return}f.push({method:g,evs:[[a,c]]})}};cr.eventsheet=e;f.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length};f.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances};f.prototype.pick_one=function(a){a&&(a.runtime.getCurrentEventStack().current_event.orblock?(this.select_all&&(this.instances.length=0,cr.shallowAssignArray(this.else_instances,a.type.instances),this.select_all=!1),a=this.else_instances.indexOf(a),-1!==a&&(this.instances.push(this.else_instances[a]),this.else_instances.splice(a,1))):(this.select_all=!1,this.instances.length=1,this.instances[0]=a))};cr.selection=f;h.prototype.postInit=function(a){var c,b=this.parent;if(this.group)for(this.toplevelgroup=!0;b;){if(!b.group){this.toplevelgroup=!1;break}b=b.parent}this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup);this.has_else_block=!!a;this.solModifiersIncludingParents=this.solModifiers.slice(0);for(b=this.parent;b;){a=0;for(c=b.solModifiers.length;a<c;a++)this.addParentSolModifier(b.solModifiers[a]);b=b.parent}this.solModifiers=d(this.solModifiers);this.solModifiersIncludingParents=d(this.solModifiersIncludingParents);a=0;for(c=this.conditions.length;a<c;a++)this.conditions[a].postInit();a=0;for(c=this.actions.length;a<c;a++)this.actions[a].postInit();a=0;for(c=this.subevents.length;a<c;a++)this.subevents[a].postInit(a<c-1&&this.subevents[a+1].is_else_block)};h.prototype.addSolModifier=function(a){k(a,this.solModifiers)};h.prototype.addParentSolModifier=function(a){k(a,this.solModifiersIncludingParents)};h.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0;this.parent&&this.parent.setSolWriterAfterCnds()};h.prototype.is_trigger=function(){return this.conditions.length?this.conditions[0].trigger:!1};h.prototype.run=function(){var a,c=!1,b=this.runtime.getCurrentEventStack();b.current_event=this;this.is_else_block||(b.else_branch_ran=!1);if(this.orblock){0===this.conditions.length&&(c=!0);b.cndindex=0;for(a=this.conditions.length;b.cndindex<a;b.cndindex++)this.conditions[b.cndindex].trigger||this.conditions[b.cndindex].run()&&(c=!0);(b.last_event_true=c)&&this.run_actions_and_subevents()}else{b.cndindex=0;for(a=this.conditions.length;b.cndindex<a;b.cndindex++)if(!this.conditions[b.cndindex].run()){b.last_event_true=!1;!this.toplevelevent||this.runtime.deathRow.isEmpty()&&!this.runtime.createRow.length||this.runtime.ClearDeathRow();return}b.last_event_true=!0;this.run_actions_and_subevents()}b.last_event_true&&this.has_else_block&&(b.else_branch_ran=!0);!this.toplevelevent||this.runtime.deathRow.isEmpty()&&!this.runtime.createRow.length||this.runtime.ClearDeathRow()};h.prototype.run_orblocktrigger=function(a){this.runtime.getCurrentEventStack().current_event=this;this.conditions[a].run()&&this.run_actions_and_subevents()};h.prototype.run_actions_and_subevents=function(){var a=this.runtime.getCurrentEventStack(),c;a.actindex=0;for(c=this.actions.length;a.actindex<c;a.actindex++)if(this.actions[a.actindex].run())return;this.run_subevents()};h.prototype.resume_actions_and_subevents=function(){var a=this.runtime.getCurrentEventStack(),c;for(c=this.actions.length;a.actindex<c;a.actindex++)if(this.actions[a.actindex].run())return;this.run_subevents()};h.prototype.run_subevents=function(){if(this.subevents.length){var a,c,b,d,e=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds)for(a=0,c=this.subevents.length;a<c;a++)b=this.subevents[a],(d=!this.toplevelgroup||!this.group&&a<e)&&this.runtime.pushCopySol(b.solModifiers),b.run(),d?this.runtime.popSol(b.solModifiers):this.runtime.clearSol(b.solModifiers);else for(a=0,c=this.subevents.length;a<c;a++)this.subevents[a].run();this.runtime.popEventStack()}};h.prototype.run_pretrigger=function(){var a=this.runtime.getCurrentEventStack();a.current_event=this;var c=!1,b;a.cndindex=0;for(b=this.conditions.length;a.cndindex<b;a.cndindex++)if(this.conditions[a.cndindex].run())c=!0;else if(!this.orblock)return!1;return this.orblock?c:!0};h.prototype.retrigger=function(){this.runtime.execcount++;var a=this.runtime.getCurrentEventStack().cndindex,c=this.runtime.pushEventStack(this);if(!this.orblock)for(c.cndindex=a+1,a=this.conditions.length;c.cndindex<a;c.cndindex++)if(!this.conditions[c.cndindex].run())return this.runtime.popEventStack(),!1;this.run_actions_and_subevents();this.runtime.popEventStack();return!0};cr.eventblock=h;c.prototype.postInit=function(){var a,c;a=0;for(c=this.parameters.length;a<c;a++)this.parameters[a].postInit()};c.prototype.run_true=function(){return!0};c.prototype.run_system=function(){var a,c;a=0;for(c=this.parameters.length;a<c;a++)this.results[a]=this.parameters[a].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};c.prototype.run_static=function(){var a,c;a=0;for(c=this.parameters.length;a<c;a++)this.results[a]=this.parameters[a].get(a);a=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return a};c.prototype.run_object=function(){var a,c,b,d,e,f,g,l=this.type.getCurrentSol(),t=this.block.orblock&&!this.trigger,p=0,q=this.type.is_contained;if(l.select_all){l.instances.length=0;a=l.else_instances.length=0;for(b=this.type.instances.length;a<b;a++){f=this.type.instances[a];c=0;for(d=this.parameters.length;c<d;c++)this.results[c]=this.parameters[c].get(a);-1<this.beh_index?(this.type.is_family&&(p=f.type.family_beh_map[this.type.family_index]),c=this.func.apply(f.behavior_insts[this.beh_index+p],this.results)):c=this.func.apply(f,this.results);(e=cr.xor(c,this.inverted))?l.instances.push(f):t&&l.else_instances.push(f)}this.type.finish&&this.type.finish(!0);l.select_all=!1;this.type.applySolToContainer();return l.hasObjects()}var h=0,k=t?l.else_instances:l.instances;e=!1;a=0;for(b=k.length;a<b;a++){f=k[a];c=0;for(d=this.parameters.length;c<d;c++)this.results[c]=this.parameters[c].get(a);-1<this.beh_index?(this.type.is_family&&(p=f.type.family_beh_map[this.type.family_index]),c=this.func.apply(f.behavior_insts[this.beh_index+p],this.results)):c=this.func.apply(f,this.results);if(cr.xor(c,this.inverted))if(e=!0,t){if(l.instances.push(f),q)for(c=0,d=f.siblings.length;c<d;c++)g=f.siblings[c],g.type.getCurrentSol().instances.push(g)}else{k[h]=f;if(q)for(c=0,d=f.siblings.length;c<d;c++)g=f.siblings[c],g.type.getCurrentSol().instances[h]=g;h++}else if(t){k[h]=f;if(q)for(c=0,d=f.siblings.length;c<d;c++)g=f.siblings[c],g.type.getCurrentSol().else_instances[h]=g;h++}}k.length=h;if(q)for(a=0,b=this.type.container.length;a<b;a++)f=this.type.container[a].getCurrentSol(),t?f.else_instances.length=h:f.instances.length=h;p=e;if(t&&!e)for(a=0,b=l.instances.length;a<b;a++){f=l.instances[a];c=0;for(d=this.parameters.length;c<d;c++)this.results[c]=this.parameters[c].get(a);c=-1<this.beh_index?this.func.apply(f.behavior_insts[this.beh_index],this.results):this.func.apply(f,this.results);if(cr.xor(c,this.inverted)){e=!0;break}}this.type.finish&&this.type.finish(p||t);return t?e:l.hasObjects()};cr.condition=c;r.prototype.postInit=function(){var a,c;a=0;for(c=this.parameters.length;a<c;a++)this.parameters[a].postInit()};r.prototype.run_system=function(){var a,c;a=0;for(c=this.parameters.length;a<c;a++)this.results[a]=this.parameters[a].get();return this.func.apply(this.runtime.system,this.results)};r.prototype.run_object=function(){var a=this.type.getCurrentSol().getObjects(),c,b,d,e,f;c=0;for(d=a.length;c<d;c++){f=a[c];b=0;for(e=this.parameters.length;b<e;b++)this.results[b]=this.parameters[b].get(c);-1<this.beh_index?(b=0,this.type.is_family&&(b=f.type.family_beh_map[this.type.family_index]),this.func.apply(f.behavior_insts[this.beh_index+b],this.results)):this.func.apply(f,this.results)}return!1};cr.action=r;var p=[],g=-1;n.prototype.postInit=function(){var a,c;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(a=0,c=this.subparams.length;a<c;a++)this.subparams[a].postInit();this.expression&&this.expression.postInit()};n.prototype.pushTempValue=function(){g++;p.length===g&&p.push(new cr.expvalue);return p[g]};n.prototype.popTempValue=function(){g--};n.prototype.get_exp=function(a){this.solindex=a||0;a=this.pushTempValue();this.expression.get(a);this.popTempValue();return a.data};n.prototype.get_exp_str=function(a){this.solindex=a||0;a=this.pushTempValue();this.expression.get(a);this.popTempValue();return cr.is_string(a.data)?a.data:""};n.prototype.get_object=function(){return this.object};n.prototype.get_combosel=function(){return this.combosel};n.prototype.get_layer=function(a){this.solindex=a||0;a=this.pushTempValue();this.expression.get(a);this.popTempValue();return a.is_number()?this.runtime.getLayerByNumber(a.data):this.runtime.getLayerByName(a.data)};n.prototype.get_layout=function(){return this.layout};n.prototype.get_key=function(){return this.key};n.prototype.get_instvar=function(){return this.index};n.prototype.get_familyvar=function(a){var c=this.owner.type,b=null,b=c.getCurrentSol(),d=b.getObjects(),b=d.length?d[a%d.length].type:b.else_instances[a%b.else_instances.length].type;return this.index+b.family_var_map[c.family_index]};n.prototype.get_eventvar=function(){return this.eventvar};n.prototype.get_audiofile=function(){return this.fileinfo};n.prototype.get_variadic=function(){var a,c;a=0;for(c=this.subparams.length;a<c;a++)this.variadicret[a]=this.subparams[a].get();return this.variadicret};cr.parameter=n;l.prototype.postInit=function(){this.solModifiers=d(this.solModifiers)};l.prototype.setValue=function(a){var c=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&c?(this.localIndex>=c.length&&(c.length=this.localIndex+1),c[this.localIndex]=a):this.data=a};l.prototype.getValue=function(){var a=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!a||this.is_constant?this.data:this.localIndex>=a.length||"undefined"===typeof a[this.localIndex]?this.initial:a[this.localIndex]};l.prototype.run=function(){!this.parent||(this.is_static||this.is_constant)||this.setValue(this.initial)};cr.eventvariable=l;q.prototype.toString=function(){return"include:"+this.include_sheet.toString()};q.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this);this.solModifiers=d(this.solModifiers)};q.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index);this.include_sheet.hasRun||this.include_sheet.run();this.parent&&this.runtime.popSol(this.runtime.types_by_index)};q.prototype.isActive=function(){for(var a=this.parent;a;){if(a.group&&!this.runtime.activeGroups[a.group_name.toLowerCase()])return!1;a=a.parent}return!0};cr.eventinclude=q;v.prototype.reset=function(a){this.current_event=a;this.actindex=this.cndindex=0;this.temp_parents_arr.length=0;this.else_branch_ran=this.last_event_true=!1};v.prototype.isModifierAfterCnds=function(){return this.current_event.solWriterAfterCnds?!0:this.cndindex<this.current_event.conditions.length-1?!!this.current_event.solModifiers.length:!1};cr.eventStackFrame=v})();(function(){function a(a,b){this.owner=a;this.runtime=a.runtime;this.type=b[0];this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_behavior_exp,this.eval_instvar_exp,this.eval_object_behavior_exp,this.eval_eventvar_exp][this.type];var f=null;this.object_type=this.parameters=this.results=this.func=this.third=this.second=this.first=this.value=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.eventvar=this.varname=this.behavior_type=null;this.return_string=!1;switch(this.type){case 0:case 1:case 2:this.value=b[1];break;case 3:this.first=new cr.expNode(a,b[1]);break;case 18:this.first=new cr.expNode(a,b[1]);this.second=new cr.expNode(a,b[2]);this.third=new cr.expNode(a,b[3]);break;case 19:this.func=b[1];this.results=[];this.parameters=[];3===b.length?(f=b[2],this.results.length=f.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[b[1]];this.beh_index=-1;this.func=b[2];this.return_string=b[3];this.instance_expr=b[4]?new cr.expNode(a,b[4]):null;this.results=[];this.parameters=[];6===b.length?(f=b[5],this.results.length=f.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[b[1]];this.return_string=b[2];this.instance_expr=b[3]?new cr.expNode(a,b[3]):null;this.varindex=b[4];break;case 22:this.object_type=this.runtime.types_by_index[b[1]];this.behavior_type=this.object_type.getBehaviorByName(b[2]);this.beh_index=this.object_type.getBehaviorIndexByName(b[2]);this.func=b[3];this.return_string=b[4];this.instance_expr=b[5]?new cr.expNode(a,b[5]):null;this.results=[];this.parameters=[];7===b.length?(f=b[6],this.results.length=f.length+1):this.results.length=1;break;case 23:this.varname=b[1],this.eventvar=null}4<=this.type&&17>=this.type&&(this.first=new cr.expNode(a,b[1]),this.second=new cr.expNode(a,b[2]));if(f){var h,k;h=0;for(k=f.length;h<k;h++)this.parameters.push(new cr.expNode(a,f[h]))}cr.seal(this)}function b(a,b){this.type=a||cr.exptype.Integer;this.data=b||0;this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data));cr.seal(this)}a.prototype.postInit=function(){23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent));this.first&&this.first.postInit();this.second&&this.second.postInit();this.third&&this.third.postInit();this.instance_expr&&this.instance_expr.postInit();if(this.parameters){var a,b;a=0;for(b=this.parameters.length;a<b;a++)this.parameters[a].postInit()}};a.prototype.eval_system_exp=function(a){this.results[0]=a;a=this.owner.pushTempValue();var b,f;b=0;for(f=this.parameters.length;b<f;b++)this.parameters[b].get(a),this.results[b+1]=a.data;this.owner.popTempValue();this.func.apply(this.runtime.system,this.results)};a.prototype.eval_object_behavior_exp=function(a){var b=this.object_type.getCurrentSol(),f=b.getObjects();if(!f.length)if(b.else_instances.length)f=b.else_instances;else{this.return_string?a.set_string(""):a.set_int(0);return}this.results[0]=a;a.object_class=this.object_type;a=this.owner.pushTempValue();var h,b=0;for(h=this.parameters.length;b<h;b++)this.parameters[b].get(a),this.results[b+1]=a.data;b=this.owner.solindex;this.instance_expr&&(this.instance_expr.get(a),a.is_number()&&(b=a.data,f=this.object_type.instances));this.owner.popTempValue();b%=f.length;0>b&&(b+=f.length);f=f[b];-1<this.beh_index?(a=0,this.object_type.is_family&&(a=f.type.family_beh_map[this.object_type.family_index]),this.func.apply(f.behavior_insts[this.beh_index+a],this.results)):this.func.apply(f,this.results)};a.prototype.eval_instvar_exp=function(a){var b=this.object_type.getCurrentSol(),f=b.getObjects();if(!f.length)if(b.else_instances.length)f=b.else_instances;else{this.return_string?a.set_string(""):a.set_int(0);return}b=this.owner.solindex;if(this.instance_expr){var h=this.owner.pushTempValue();this.instance_expr.get(h);if(h.is_number()){b=h.data;f=this.object_type.instances;b%=f.length;0>b&&(b+=f.length);f=f[b].instance_vars[this.varindex];cr.is_string(f)?a.set_string(f):a.set_float(f);this.owner.popTempValue();return}this.owner.popTempValue()}b%=f.length;0>b&&(b+=f.length);f=f[b];b=0;this.object_type.is_family&&(b=f.type.family_var_map[this.object_type.family_index]);f=f.instance_vars[this.varindex+b];cr.is_string(f)?a.set_string(f):a.set_float(f)};a.prototype.eval_int=function(a){a.type=cr.exptype.Integer;a.data=this.value};a.prototype.eval_float=function(a){a.type=cr.exptype.Float;a.data=this.value};a.prototype.eval_string=function(a){a.type=cr.exptype.String;a.data=this.value};a.prototype.eval_unaryminus=function(a){this.first.get(a);a.is_number()&&(a.data=-a.data)};a.prototype.eval_add=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data+=b.data,b.is_float()&&a.make_float());this.owner.popTempValue()};a.prototype.eval_subtract=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data-=b.data,b.is_float()&&a.make_float());this.owner.popTempValue()};a.prototype.eval_multiply=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data*=b.data,b.is_float()&&a.make_float());this.owner.popTempValue()};a.prototype.eval_divide=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data/=b.data,a.make_float());this.owner.popTempValue()};a.prototype.eval_mod=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data%=b.data,b.is_float()&&a.make_float());this.owner.popTempValue()};a.prototype.eval_power=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data=Math.pow(a.data,b.data),b.is_float()&&a.make_float());this.owner.popTempValue()};a.prototype.eval_and=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()?b.is_string()?a.set_string(a.data.toString()+b.data):a.data&&b.data?a.set_int(1):a.set_int(0):a.is_string()&&(b.is_string()?a.data+=b.data:a.data+=(Math.round(1E10*b.data)/1E10).toString());this.owner.popTempValue()};a.prototype.eval_or=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.is_number()&&b.is_number()&&(a.data||b.data?a.set_int(1):a.set_int(0));this.owner.popTempValue()};a.prototype.eval_conditional=function(a){this.first.get(a);a.data?this.second.get(a):this.third.get(a)};a.prototype.eval_equal=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data===b.data?1:0);this.owner.popTempValue()};a.prototype.eval_notequal=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data!==b.data?1:0);this.owner.popTempValue()};a.prototype.eval_less=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data<b.data?1:0);this.owner.popTempValue()};a.prototype.eval_lessequal=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data<=b.data?1:0);this.owner.popTempValue()};a.prototype.eval_greater=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data>b.data?1:0);this.owner.popTempValue()};a.prototype.eval_greaterequal=function(a){this.first.get(a);var b=this.owner.pushTempValue();this.second.get(b);a.set_int(a.data>=b.data?1:0);this.owner.popTempValue()};a.prototype.eval_eventvar_exp=function(a){var b=this.eventvar.getValue();cr.is_number(b)?a.set_float(b):a.set_string(b)};cr.expNode=a;b.prototype.is_int=function(){return this.type===cr.exptype.Integer};b.prototype.is_float=function(){return this.type===cr.exptype.Float};b.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};b.prototype.is_string=function(){return this.type===cr.exptype.String};b.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)};b.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)};b.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)};b.prototype.set_int=function(a){this.type=cr.exptype.Integer;this.data=Math.floor(a)};b.prototype.set_float=function(a){this.type=cr.exptype.Float;this.data=a};b.prototype.set_string=function(a){this.type=cr.exptype.String;this.data=a};b.prototype.set_any=function(a){cr.is_number(a)?(this.type=cr.exptype.Float,this.data=a):cr.is_string(a)?(this.type=cr.exptype.String,this.data=a.toString()):(this.type=cr.exptype.Integer,this.data=0)};cr.expvalue=b;cr.exptype={Integer:0,Float:1,String:2}})();cr.system_object=function(a){this.runtime=a;this.waits=[]};cr.system_object.prototype.saveToJSON=function(){var a={},b,d,e,f,h,k,c,r;a.waits=[];var n=a.waits,l;b=0;for(d=this.waits.length;b<d;b++){k=this.waits[b];l={t:k.time,ev:k.ev.sid,sm:[],sols:{}};k.ev.actions[k.actindex]&&(l.act=k.ev.actions[k.actindex].sid);e=0;for(f=k.solModifiers.length;e<f;e++)l.sm.push(k.solModifiers[e].sid);for(h in k.sols)if(k.sols.hasOwnProperty(h)){c=this.runtime.types_by_index[parseInt(h,10)];r={sa:k.sols[h].sa,insts:[]};e=0;for(f=k.sols[h].insts.length;e<f;e++)r.insts.push(k.sols[h].insts[e].uid);l.sols[c.sid.toString()]=r}n.push(l)}return a};cr.system_object.prototype.loadFromJSON=function(a){a=a.waits;var b,d,e,f,h,k,c,r,n,l,q;b=this.waits.length=0;for(d=a.length;b<d;b++)if(k=a[b],r=this.runtime.blocksBySid[k.ev.toString()]){n=-1;e=0;for(f=r.actions.length;e<f;e++)if(r.actions[e].sid===k.act){n=e;break}if(-1!==n){c={sols:{},solModifiers:[],deleteme:!1};c.time=k.t;c.ev=r;c.actindex=n;e=0;for(f=k.sm.length;e<f;e++)(r=this.runtime.getObjectTypeBySid(k.sm[e]))&&c.solModifiers.push(r);for(h in k.sols)if(k.sols.hasOwnProperty(h)&&(r=this.runtime.getObjectTypeBySid(parseInt(h,10)))){n=k.sols[h];l={sa:n.sa,insts:[]};e=0;for(f=n.insts.length;e<f;e++)(q=this.runtime.getObjectByUID(n.insts[e]))&&l.insts.push(q);c.sols[r.index.toString()]=l}this.waits.push(c)}}};(function(){function a(){}function b(a,b){var c=a.extra.c2_foreachordered_val,d=b.extra.c2_foreachordered_val;if(cr.is_number(c)&&cr.is_number(d))return c-d;c=""+c;d=""+d;return c<d?-1:c>d?1:0}function d(a,b){n&&a===l&&b===q||(n=RegExp(a,b),l=a,q=b);n.lastIndex=0;return n}function e(){}function f(){}function h(a,b,c){if(a!==u||b!==D||c!==B){var e=d(b,c);g=a.match(e);u=a;D=b;B=c}}var k=cr.system_object.prototype;a.prototype.EveryTick=function(){return!0};a.prototype.OnLayoutStart=function(){return!0};a.prototype.OnLayoutEnd=function(){return!0};a.prototype.Compare=function(a,b,c){return cr.do_cmp(a,b,c)};a.prototype.CompareTime=function(a,b){var c=this.runtime.kahanTime.sum;if(0===a){var d=this.runtime.getCurrentCondition();return!d.extra.CompareTime_executed&&c>=b?d.extra.CompareTime_executed=!0:!1}return cr.do_cmp(c,a,b)};a.prototype.LayerVisible=function(a){return a?a.visible:!1};a.prototype.LayerCmpOpacity=function(a,b,c){return a?cr.do_cmp(100*a.opacity,b,c):!1};a.prototype.Repeat=function(a){var b=this.runtime.getCurrentEventStack(),c=b.current_event,d=b.isModifierAfterCnds(),b=this.runtime.pushLoopStack();if(d)for(d=0;d<a&&!b.stopped;d++)this.runtime.pushCopySol(c.solModifiers),b.index=d,c.retrigger(),this.runtime.popSol(c.solModifiers);else for(d=0;d<a&&!b.stopped;d++)b.index=d,c.retrigger();this.runtime.popLoopStack();return!1};a.prototype.While=function(a){var b=this.runtime.getCurrentEventStack();a=b.current_event;var c=b.isModifierAfterCnds(),b=this.runtime.pushLoopStack();if(c)for(c=0;!b.stopped;c++)this.runtime.pushCopySol(a.solModifiers),b.index=c,a.retrigger()||(b.stopped=!0),this.runtime.popSol(a.solModifiers);else for(c=0;!b.stopped;c++)b.index=c,a.retrigger()||(b.stopped=!0);this.runtime.popLoopStack();return!1};a.prototype.For=function(a,b,c){var d=this.runtime.getCurrentEventStack(),e=d.current_event,d=d.isModifierAfterCnds();a=this.runtime.pushLoopStack(a);if(c<b)if(d)for(;b>=c&&!a.stopped;--b)this.runtime.pushCopySol(e.solModifiers),a.index=b,e.retrigger(),this.runtime.popSol(e.solModifiers);else for(;b>=c&&!a.stopped;--b)a.index=b,e.retrigger();else if(d)for(;b<=c&&!a.stopped;++b)this.runtime.pushCopySol(e.solModifiers),a.index=b,e.retrigger(),this.runtime.popSol(e.solModifiers);else for(;b<=c&&!a.stopped;++b)a.index=b,e.retrigger();this.runtime.popLoopStack();return!1};var c=[],r=-1;a.prototype.ForEach=function(a){var b=a.getCurrentSol();r++;c.length===r&&c.push([]);var d=c[r];cr.shallowAssignArray(d,b.getObjects());var e=this.runtime.getCurrentEventStack(),f=e.current_event,g=e.isModifierAfterCnds(),e=this.runtime.pushLoopStack(),l,t,p,q,h,k,n=a.is_contained;if(g)for(g=0,l=d.length;g<l&&!e.stopped;g++){this.runtime.pushCopySol(f.solModifiers);q=d[g];b=a.getCurrentSol();b.select_all=!1;b.instances.length=1;b.instances[0]=q;if(n)for(t=0,p=q.siblings.length;t<p;t++)h=q.siblings[t],k=h.type.getCurrentSol(),k.select_all=!1,k.instances.length=1,k.instances[0]=h;e.index=g;f.retrigger();this.runtime.popSol(f.solModifiers)}else for(b.select_all=!1,b.instances.length=1,g=0,l=d.length;g<l&&!e.stopped;g++){q=d[g];b.instances[0]=q;if(n)for(t=0,p=q.siblings.length;t<p;t++)h=q.siblings[t],k=h.type.getCurrentSol(),k.select_all=!1,k.instances.length=1,k.instances[0]=h;e.index=g;f.retrigger()}d.length=0;this.runtime.popLoopStack();r--;return!1};a.prototype.ForEachOrdered=function(a,d,e){d=a.getCurrentSol();r++;c.length===r&&c.push([]);var f=c[r];cr.shallowAssignArray(f,d.getObjects());var g=this.runtime.getCurrentEventStack(),l=g.current_event,t=this.runtime.getCurrentCondition(),p=g.isModifierAfterCnds(),g=this.runtime.pushLoopStack(),q,h,k,n,u;q=0;for(h=f.length;q<h;q++)f[q].extra.c2_foreachordered_val=t.parameters[1].get(q);f.sort(b);1===e&&f.reverse();e=a.is_contained;if(p)for(q=0,h=f.length;q<h&&!g.stopped;q++){this.runtime.pushCopySol(l.solModifiers);k=f[q];d=a.getCurrentSol();d.select_all=!1;d.instances.length=1;d.instances[0]=k;if(e)for(t=0,p=k.siblings.length;t<p;t++)n=k.siblings[t],u=n.type.getCurrentSol(),u.select_all=!1,u.instances.length=1,u.instances[0]=n;g.index=q;l.retrigger();this.runtime.popSol(l.solModifiers)}else for(d.select_all=!1,d.instances.length=1,q=0,h=f.length;q<h&&!g.stopped;q++){k=f[q];d.instances[0]=k;if(e)for(t=0,p=k.siblings.length;t<p;t++)n=k.siblings[t],u=n.type.getCurrentSol(),u.select_all=!1,u.instances.length=1,u.instances[0]=n;g.index=q;l.retrigger()}f.length=0;this.runtime.popLoopStack();r--;return!1};a.prototype.PickByComparison=function(a,b,d,e){var f,g,l,t;if(a){r++;c.length===r&&c.push([]);var p=c[r],q=a.getCurrentSol();cr.shallowAssignArray(p,q.getObjects());q.select_all&&(q.else_instances.length=0);var h=this.runtime.getCurrentCondition();l=f=0;for(g=p.length;f<g;f++)t=p[f],p[l]=t,b=h.parameters[1].get(f),e=h.parameters[3].get(f),cr.do_cmp(b,d,e)?l++:q.else_instances.push(t);p.length=l;q.select_all=!1;cr.shallowAssignArray(q.instances,p);p.length=0;r--;a.applySolToContainer();return!!q.instances.length}};a.prototype.PickByEvaluate=function(a,b){var d,e,f,g;if(a){r++;c.length===r&&c.push([]);var l=c[r],t=a.getCurrentSol();cr.shallowAssignArray(l,t.getObjects());t.select_all&&(t.else_instances.length=0);var p=this.runtime.getCurrentCondition();f=d=0;for(e=l.length;d<e;d++)g=l[d],l[f]=g,(b=p.parameters[1].get(d))?f++:t.else_instances.push(g);l.length=f;t.select_all=!1;cr.shallowAssignArray(t.instances,l);l.length=0;r--;a.applySolToContainer();return!!t.instances.length}};a.prototype.TriggerOnce=function(){var a=this.runtime.getCurrentCondition().extra;"undefined"===typeof a.TriggerOnce_lastTick&&(a.TriggerOnce_lastTick=-1);var b=a.TriggerOnce_lastTick,c=this.runtime.tickcount;a.TriggerOnce_lastTick=c;return this.runtime.layout_first_tick||b!==c-1};a.prototype.Every=function(a){var b=this.runtime.getCurrentCondition(),c=b.extra.Every_lastTime||0,d=this.runtime.kahanTime.sum;"undefined"===typeof b.extra.Every_seconds&&(b.extra.Every_seconds=a);var e=b.extra.Every_seconds;return d>=c+e?(b.extra.Every_lastTime=c+e,d>=b.extra.Every_lastTime+e&&(b.extra.Every_lastTime=d),b.extra.Every_seconds=a,!0):!1};a.prototype.PickNth=function(a,b){if(!a)return!1;var c=a.getCurrentSol(),d=c.getObjects();b=cr.floor(b);if(0>b||b>=d.length)return!1;c.pick_one(d[b]);a.applySolToContainer();return!0};a.prototype.PickRandom=function(a){if(!a)return!1;var b=a.getCurrentSol(),c=b.getObjects(),d=cr.floor(Math.random()*c.length);if(d>=c.length)return!1;b.pick_one(c[d]);a.applySolToContainer();return!0};a.prototype.CompareVar=function(a,b,c){return cr.do_cmp(a.getValue(),b,c)};a.prototype.IsGroupActive=function(a){return this.runtime.activeGroups[a.toLowerCase()]};a.prototype.IsPreview=function(){return"undefined"!==typeof cr_is_preview};a.prototype.PickAll=function(a){if(!a||!a.instances.length)return!1;a.getCurrentSol().select_all=!0;a.applySolToContainer();return!0};a.prototype.IsMobile=function(){return this.runtime.isMobile};a.prototype.CompareBetween=function(a,b,c){return a>=b&&a<=c};a.prototype.Else=function(){var a=this.runtime.getCurrentEventStack();return a.else_branch_ran?!1:!a.last_event_true};a.prototype.OnLoadFinished=function(){return!0};a.prototype.OnCanvasSnapshot=function(){return!0};a.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};a.prototype.OnSaveComplete=function(){return!0};a.prototype.OnLoadComplete=function(){return!0};a.prototype.OnLoadFailed=function(){return!0};a.prototype.ObjectUIDExists=function(a){return!!this.runtime.getObjectByUID(a)};a.prototype.IsOnPlatform=function(a){var b=this.runtime;switch(a){case 0:return!b.isDomFree&&!b.isNodeWebkit&&!b.isPhoneGap&&!b.isWindows8App&&!b.isWindowsPhone8&&!b.isBlackberry10;case 1:return b.isiOS;case 2:return b.isAndroid;case 3:return b.isWindows8App;case 4:return b.isWindowsPhone8;case 5:return b.isBlackberry10;case 6:return b.isTizen;case 7:return b.isNodeWebkit;case 8:return b.isCocoonJs;case 9:return b.isPhoneGap;case 10:return b.isArcade;case 11:return b.isNodeWebkit;default:return!1}};var n=null,l="",q="";a.prototype.RegexTest=function(a,b,c){return d(b,c).test(a)};var v=[];a.prototype.PickOverlappingPoint=function(a,b,c){if(!a)return!1;var d=a.getCurrentSol(),e=d.getObjects(),f=this.runtime.getCurrentEventStack().current_event.orblock,g=this.runtime.getCurrentCondition(),l,t;d.select_all?(cr.shallowAssignArray(v,e),d.else_instances.length=0,d.select_all=!1,d.instances.length=0):f?(cr.shallowAssignArray(v,d.else_instances),d.else_instances.length=0):(cr.shallowAssignArray(v,e),d.instances.length=0);e=0;for(f=v.length;e<f;++e)l=v[e],(t=cr.xor(l.contains_pt(b,c),g.inverted))?d.instances.push(l):d.else_instances.push(l);a.applySolToContainer();return cr.xor(!!d.instances.length,g.inverted)};k.cnds=new a;e.prototype.GoToLayout=function(a){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=a)};e.prototype.CreateObject=function(a,b,c,d){if(b&&a&&(b=this.runtime.createInstance(a,b,c,d))){this.runtime.isInOnDestroy++;var e;this.runtime.trigger(Object.getPrototypeOf(a.plugin).cnds.OnCreated,b);if(b.is_contained)for(c=0,d=b.siblings.length;c<d;c++)e=b.siblings[c],this.runtime.trigger(Object.getPrototypeOf(e.type.plugin).cnds.OnCreated,e);this.runtime.isInOnDestroy--;a=a.getCurrentSol();a.select_all=!1;a.instances.length=1;a.instances[0]=b;if(b.is_contained)for(c=0,d=b.siblings.length;c<d;c++)e=b.siblings[c],a=e.type.getCurrentSol(),a.select_all=!1,a.instances.length=1,a.instances[0]=e}};e.prototype.SetLayerVisible=function(a,b){a&&a.visible!==b&&(a.visible=b,this.runtime.redraw=!0)};e.prototype.SetLayerOpacity=function(a,b){a&&(b=cr.clamp(b/100,0,1),a.opacity!==b&&(a.opacity=b,this.runtime.redraw=!0))};e.prototype.SetLayerScaleRate=function(a,b){a&&a.zoomRate!==b&&(a.zoomRate=b,this.runtime.redraw=!0)};e.prototype.SetLayoutScale=function(a){this.runtime.running_layout&&this.runtime.running_layout.scale!==a&&(this.runtime.running_layout.scale=a,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0)};e.prototype.ScrollX=function(a){this.runtime.running_layout.scrollToX(a)};e.prototype.ScrollY=function(a){this.runtime.running_layout.scrollToY(a)};e.prototype.Scroll=function(a,b){this.runtime.running_layout.scrollToX(a);this.runtime.running_layout.scrollToY(b)};e.prototype.ScrollToObject=function(a){if(a=a.getFirstPicked())this.runtime.running_layout.scrollToX(a.x),this.runtime.running_layout.scrollToY(a.y)};e.prototype.SetVar=function(a,b){0===a.vartype?cr.is_number(b)?a.setValue(b):a.setValue(parseFloat(b)):1===a.vartype&&a.setValue(b.toString())};e.prototype.AddVar=function(a,b){0===a.vartype?cr.is_number(b)?a.setValue(a.getValue()+b):a.setValue(a.getValue()+parseFloat(b)):1===a.vartype&&a.setValue(a.getValue()+b.toString())};e.prototype.SubVar=function(a,b){0===a.vartype&&(cr.is_number(b)?a.setValue(a.getValue()-b):a.setValue(a.getValue()-parseFloat(b)))};e.prototype.SetGroupActive=function(a,b){var c=this.runtime.activeGroups,d=a.toLowerCase();switch(b){case 0:c[d]=!1;break;case 1:c[d]=!0;break;case 2:c[d]=!c[d]}};e.prototype.SetTimescale=function(a){0>a&&(a=0);this.runtime.timescale=a};e.prototype.SetObjectTimescale=function(a,b){var c=b;0>c&&(c=0);if(a){var d=a.getCurrentSol().getObjects(),e,f;e=0;for(f=d.length;e<f;e++)d[e].my_timescale=c}};e.prototype.RestoreObjectTimescale=function(a){if(!a)return!1;a=a.getCurrentSol().getObjects();var b,c;b=0;for(c=a.length;b<c;b++)a[b].my_timescale=-1};var t=[],p=[];e.prototype.Wait=function(a){if(!(0>a)){var b,c,d,e=this.runtime.getCurrentEventStack(),f;f=t.length?t.pop():{sols:{},solModifiers:[]};f.deleteme=!1;f.time=this.runtime.kahanTime.sum+a;f.ev=e.current_event;f.actindex=e.actindex+1;a=0;for(b=this.runtime.types_by_index.length;a<b;a++)d=this.runtime.types_by_index[a],c=d.getCurrentSol(),c.select_all&&-1===e.current_event.solModifiers.indexOf(d)||(f.solModifiers.push(d),d=void 0,d=p.length?p.pop():{insts:[]},d.sa=!1,d.sa=c.select_all,cr.shallowAssignArray(d.insts,c.instances),f.sols[a.toString()]=d);this.waits.push(f);return!0}};e.prototype.SetLayerScale=function(a,b){a&&a.scale!==b&&(a.scale=b,this.runtime.redraw=!0)};e.prototype.ResetGlobals=function(){var a,b,c;a=0;for(b=this.runtime.all_global_vars.length;a<b;a++)c=this.runtime.all_global_vars[a],c.data=c.initial};e.prototype.SetLayoutAngle=function(a){a=cr.to_radians(a);a=cr.clamp_angle(a);this.runtime.running_layout&&this.runtime.running_layout.angle!==a&&(this.runtime.running_layout.angle=a,this.runtime.redraw=!0)};e.prototype.SetLayerAngle=function(a,b){a&&(b=cr.to_radians(b),b=cr.clamp_angle(b),a.angle!==b&&(a.angle=b,this.runtime.redraw=!0))};e.prototype.SetLayerParallax=function(a,b,c){!a||a.parallaxX===b/100&&a.parallaxY===c/100||(a.parallaxX=b/100,a.parallaxY=c/100,this.runtime.redraw=!0)};e.prototype.SetLayerBackground=function(a,b){if(a){var c=cr.GetRValue(b),d=cr.GetGValue(b),e=cr.GetBValue(b);if(a.background_color[0]!==c||a.background_color[1]!==d||a.background_color[2]!==e)a.background_color[0]=c,a.background_color[1]=d,a.background_color[2]=e,this.runtime.redraw=!0}};e.prototype.SetLayerTransparent=function(a,b){a&&!!b!==!!a.transparent&&(a.transparent=!!b,this.runtime.redraw=!0)};e.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)};e.prototype.GoToLayoutByName=function(a){if(!this.runtime.isloading&&!this.runtime.changelayout)for(var b in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(b)&&cr.equals_nocase(b,a)){this.runtime.changelayout=this.runtime.layouts[b];break}};e.prototype.RestartLayout=function(a){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var b,c;a=0;for(b=this.runtime.allGroups.length;a<b;a++)c=this.runtime.allGroups[a],this.runtime.activeGroups[c.group_name.toLowerCase()]=c.initially_activated}};e.prototype.SnapshotCanvas=function(a,b){this.runtime.snapshotCanvas=[0===a?"image/png":"image/jpeg",b/100];this.runtime.redraw=!0};e.prototype.SetCanvasSize=function(a,b){0>=a||0>=b||this.runtime.setSize(a,b)};e.prototype.SetLayoutEffectEnabled=function(a,b){if(this.runtime.running_layout&&this.runtime.glwrap){var c=this.runtime.running_layout.getEffectByName(b);if(c){var d=1===a;c.active!=d&&(c.active=d,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}};e.prototype.SetLayerEffectEnabled=function(a,b,c){a&&this.runtime.glwrap&&(c=a.getEffectByName(c))&&(b=1===b,c.active!=b&&(c.active=b,a.updateActiveEffects(),this.runtime.redraw=!0))};e.prototype.SetLayoutEffectParam=function(a,b,c){if(this.runtime.running_layout&&this.runtime.glwrap&&(a=this.runtime.running_layout.getEffectByName(a))){var d=this.runtime.running_layout.effect_params[a.index];b=Math.floor(b);0>b||b>=d.length||(1===this.runtime.glwrap.getProgramParameterType(a.shaderindex,b)&&(c/=100),d[b]!==c&&(d[b]=c,a.active&&(this.runtime.redraw=!0)))}};e.prototype.SetLayerEffectParam=function(a,b,c,d){a&&this.runtime.glwrap&&(b=a.getEffectByName(b))&&(a=a.effect_params[b.index],c=Math.floor(c),0>c||c>=a.length||(1===this.runtime.glwrap.getProgramParameterType(b.shaderindex,c)&&(d/=100),a[c]!==d&&(a[c]=d,b.active&&(this.runtime.redraw=!0))))};e.prototype.SaveState=function(a){this.runtime.saveToSlot=a};e.prototype.LoadState=function(a){this.runtime.loadFromSlot=a};e.prototype.LoadStateJSON=function(a){this.runtime.loadFromJson=a};k.acts=new e;f.prototype["int"]=function(a,b){cr.is_string(b)?(a.set_int(parseInt(b,10)),isNaN(a.data)&&(a.data=0)):a.set_int(b)};f.prototype["float"]=function(a,b){cr.is_string(b)?(a.set_float(parseFloat(b)),isNaN(a.data)&&(a.data=0)):a.set_float(b)};f.prototype.str=function(a,b){cr.is_string(b)?a.set_string(b):a.set_string(b.toString())};f.prototype.len=function(a,b){a.set_int(b.length||0)};f.prototype.random=function(a,b,c){void 0===c?a.set_float(Math.random()*b):a.set_float(Math.random()*(c-b)+b)};f.prototype.sqrt=function(a,b){a.set_float(Math.sqrt(b))};f.prototype.abs=function(a,b){a.set_float(Math.abs(b))};f.prototype.round=function(a,b){a.set_int(Math.round(b))};f.prototype.floor=function(a,b){a.set_int(Math.floor(b))};f.prototype.ceil=function(a,b){a.set_int(Math.ceil(b))};f.prototype.sin=function(a,b){a.set_float(Math.sin(cr.to_radians(b)))};f.prototype.cos=function(a,b){a.set_float(Math.cos(cr.to_radians(b)))};f.prototype.tan=function(a,b){a.set_float(Math.tan(cr.to_radians(b)))};f.prototype.asin=function(a,b){a.set_float(cr.to_degrees(Math.asin(b)))};f.prototype.acos=function(a,b){a.set_float(cr.to_degrees(Math.acos(b)))};f.prototype.atan=function(a,b){a.set_float(cr.to_degrees(Math.atan(b)))};f.prototype.exp=function(a,b){a.set_float(Math.exp(b))};f.prototype.ln=function(a,b){a.set_float(Math.log(b))};f.prototype.log10=function(a,b){a.set_float(Math.log(b)/Math.LN10)};f.prototype.max=function(a){var b=arguments[1],c,d;c=2;for(d=arguments.length;c<d;c++)b<arguments[c]&&(b=arguments[c]);a.set_float(b)};f.prototype.min=function(a){var b=arguments[1],c,d;c=2;for(d=arguments.length;c<d;c++)b>arguments[c]&&(b=arguments[c]);a.set_float(b)};f.prototype.dt=function(a){a.set_float(this.runtime.dt)};f.prototype.timescale=function(a){a.set_float(this.runtime.timescale)};f.prototype.wallclocktime=function(a){a.set_float((Date.now()-this.runtime.start_time)/1E3)};f.prototype.time=function(a){a.set_float(this.runtime.kahanTime.sum)};f.prototype.tickcount=function(a){a.set_int(this.runtime.tickcount)};f.prototype.objectcount=function(a){a.set_int(this.runtime.objectcount)};f.prototype.fps=function(a){a.set_int(this.runtime.fps)};f.prototype.loopindex=function(a,b){var c,d,e;if(this.runtime.loop_stack.length)if(b){d=0;for(e=this.runtime.loop_stack.length;d<e;d++)if(c=this.runtime.loop_stack[d],c.name===b){a.set_int(c.index);return}a.set_int(0)}else c=this.runtime.getCurrentLoop(),a.set_int(c?c.index:-1);else a.set_int(0)};f.prototype.distance=function(a,b,c,d,e){a.set_float(cr.distanceTo(b,c,d,e))};f.prototype.angle=function(a,b,c,d,e){a.set_float(cr.to_degrees(cr.angleTo(b,c,d,e)))};f.prototype.scrollx=function(a){a.set_float(this.runtime.running_layout.scrollX)};f.prototype.scrolly=function(a){a.set_float(this.runtime.running_layout.scrollY)};f.prototype.newline=function(a){a.set_string("\n")};f.prototype.lerp=function(a,b,c,d){a.set_float(cr.lerp(b,c,d))};f.prototype.windowwidth=function(a){a.set_int(this.runtime.width)};f.prototype.windowheight=function(a){a.set_int(this.runtime.height)};f.prototype.uppercase=function(a,b){a.set_string(cr.is_string(b)?b.toUpperCase():"")};f.prototype.lowercase=function(a,b){a.set_string(cr.is_string(b)?b.toLowerCase():"")};f.prototype.clamp=function(a,b,c,d){b<c?a.set_float(c):b>d?a.set_float(d):a.set_float(b)};f.prototype.layerscale=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(c.scale):a.set_float(0)};f.prototype.layeropacity=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(100*c.opacity):a.set_float(0)};f.prototype.layerscalerate=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(c.zoomRate):a.set_float(0)};f.prototype.layerparallaxx=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(100*c.parallaxX):a.set_float(0)};f.prototype.layerparallaxy=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(100*c.parallaxY):a.set_float(0)};f.prototype.layoutscale=function(a){this.runtime.running_layout?a.set_float(this.runtime.running_layout.scale):a.set_float(0)};f.prototype.layoutangle=function(a){a.set_float(cr.to_degrees(this.runtime.running_layout.angle))};f.prototype.layerangle=function(a,b){var c=this.runtime.getLayer(b);c?a.set_float(cr.to_degrees(c.angle)):a.set_float(0)};f.prototype.layoutwidth=function(a){a.set_int(this.runtime.running_layout.width)};f.prototype.layoutheight=function(a){a.set_int(this.runtime.running_layout.height)};f.prototype.find=function(a,b,c){cr.is_string(b)&&cr.is_string(c)?a.set_int(b.search(RegExp(cr.regexp_escape(c),"i"))):a.set_int(-1)};f.prototype.left=function(a,b,c){a.set_string(cr.is_string(b)?b.substr(0,c):"")};f.prototype.right=function(a,b,c){a.set_string(cr.is_string(b)?b.substr(b.length-c):"")};f.prototype.mid=function(a,b,c,d){a.set_string(cr.is_string(b)?b.substr(c,d):"")};f.prototype.tokenat=function(a,b,c,d){cr.is_string(b)&&cr.is_string(d)?(b=b.split(d),c=cr.floor(c),0>c||c>=b.length?a.set_string(""):a.set_string(b[c])):a.set_string("")};f.prototype.tokencount=function(a,b,c){cr.is_string(b)&&b.length?a.set_int(b.split(c).length):a.set_int(0)};f.prototype.replace=function(a,b,c,d){cr.is_string(b)&&cr.is_string(c)&&cr.is_string(d)?a.set_string(b.replace(RegExp(cr.regexp_escape(c),"gi"),d)):a.set_string(cr.is_string(b)?b:"")};f.prototype.trim=function(a,b){a.set_string(cr.is_string(b)?b.trim():"")};f.prototype.pi=function(a){a.set_float(cr.PI)};f.prototype.layoutname=function(a){this.runtime.running_layout?a.set_string(this.runtime.running_layout.name):a.set_string("")};f.prototype.renderer=function(a){a.set_string(this.runtime.gl?"webgl":"canvas2d")};f.prototype.anglediff=function(a,b,c){a.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(b),cr.to_radians(c))))};f.prototype.choose=function(a){var b=cr.floor(Math.random()*(arguments.length-1));a.set_any(arguments[b+1])};f.prototype.rgb=function(a,b,c,d){a.set_int(cr.RGB(b,c,d))};f.prototype.projectversion=function(a){a.set_string(this.runtime.versionstr)};f.prototype.anglelerp=function(a,b,c,d){b=cr.to_radians(b);c=cr.to_radians(c);var e=cr.angleDiff(b,c);cr.angleClockwise(c,b)?a.set_float(cr.to_clamped_degrees(b+e*d)):a.set_float(cr.to_clamped_degrees(b-e*d))};f.prototype.anglerotate=function(a,b,c,d){b=cr.to_radians(b);c=cr.to_radians(c);d=cr.to_radians(d);a.set_float(cr.to_clamped_degrees(cr.angleRotate(b,c,d)))};f.prototype.zeropad=function(a,b,c){var d=0>b?"-":"";0>b&&(b=-b);c-=b.toString().length;for(var e=0;e<c;e++)d+="0";a.set_string(d+b.toString())};f.prototype.cpuutilisation=function(a){a.set_float(this.runtime.cpuutilisation/1E3)};f.prototype.viewportleft=function(a,b){var c=this.runtime.getLayer(b);a.set_float(c?c.viewLeft:0)};f.prototype.viewporttop=function(a,b){var c=this.runtime.getLayer(b);a.set_float(c?c.viewTop:0)};f.prototype.viewportright=function(a,b){var c=this.runtime.getLayer(b);a.set_float(c?c.viewRight:0)};f.prototype.viewportbottom=function(a,b){var c=this.runtime.getLayer(b);a.set_float(c?c.viewBottom:0)};f.prototype.loadingprogress=function(a){a.set_float(this.runtime.loadingprogress)};f.prototype.unlerp=function(a,b,c,d){a.set_float((d-b)/(c-b))};f.prototype.canvassnapshot=function(a){a.set_string(this.runtime.snapshotData)};f.prototype.urlencode=function(a,b){a.set_string(encodeURIComponent(b))};f.prototype.urldecode=function(a,b){a.set_string(decodeURIComponent(b))};f.prototype.canvastolayerx=function(a,b,c,d){b=this.runtime.getLayer(b);a.set_float(b?b.canvasToLayer(c,d,!0):0)};f.prototype.canvastolayery=function(a,b,c,d){b=this.runtime.getLayer(b);a.set_float(b?b.canvasToLayer(c,d,!1):0)};f.prototype.layertocanvasx=function(a,b,c,d){b=this.runtime.getLayer(b);a.set_float(b?b.layerToCanvas(c,d,!0):0)};f.prototype.layertocanvasy=function(a,b,c,d){b=this.runtime.getLayer(b);a.set_float(b?b.layerToCanvas(c,d,!1):0)};f.prototype.savestatejson=function(a){a.set_string(this.runtime.lastSaveJson)};f.prototype.imagememoryusage=function(a){this.runtime.glwrap?a.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):a.set_float(0)};f.prototype.regexsearch=function(a,b,c,e){c=d(c,e);a.set_int(b?b.search(c):-1)};f.prototype.regexreplace=function(a,b,c,e,f){c=d(c,e);a.set_string(b?b.replace(c,f):"")};var g=[],u="",D="",B="";f.prototype.regexmatchcount=function(a,b,c,e){d(c,e);h(b,c,e);a.set_int(g?g.length:0)};f.prototype.regexmatchat=function(a,b,c,e,f){f=Math.floor(f);d(c,e);h(b,c,e);!g||0>f||f>=g.length?a.set_string(""):a.set_string(g[f])};f.prototype.infinity=function(a){a.set_float(Infinity)};k.exps=new f;k.runWaits=function(){var a,b,c,d,e,f,g=this.runtime.getCurrentEventStack();a=0;for(c=this.waits.length;a<c;a++)if(d=this.waits[a],!(d.time>this.runtime.kahanTime.sum)){g.current_event=d.ev;g.actindex=d.actindex;g.cndindex=0;for(b in d.sols)d.sols.hasOwnProperty(b)&&(e=this.runtime.types_by_index[parseInt(b,10)].getCurrentSol(),f=d.sols[b],e.select_all=f.sa,cr.shallowAssignArray(e.instances,f.insts),e=f,e.insts.length=0,p.push(e));d.ev.resume_actions_and_subevents();this.runtime.clearSol(d.solModifiers);d.deleteme=!0}b=a=0;for(c=this.waits.length;a<c;a++)d=this.waits[a],this.waits[b]=d,d.deleteme?(cr.wipe(d.sols),d.solModifiers.length=0,t.push(d)):b++;this.waits.length=b}})();cr.add_common_aces=function(a){var b=a[0].prototype,d=a[1],e=a[3],f=a[4],h=a[5],k=a[6],c=a[7];a=a[8];b.cnds||(b.cnds={});b.acts||(b.acts={});b.exps||(b.exps={});var r=b.cnds,n=b.acts,b=b.exps;e&&(r.CompareX=function(a,b){return cr.do_cmp(this.x,a,b)},r.CompareY=function(a,b){return cr.do_cmp(this.y,a,b)},r.IsOnScreen=function(){var a=this.layer;this.update_bbox();var b=this.bbox;return!(b.right<a.viewLeft||b.bottom<a.viewTop||b.left>a.viewRight||b.top>a.viewBottom)},r.IsOutsideLayout=function(){this.update_bbox();var a=this.bbox,b=this.runtime.running_layout;return 0>a.right||0>a.bottom||a.left>b.width||a.top>b.height},r.PickDistance=function(a,b,c){var d=this.getCurrentSol(),e=d.getObjects();if(!e.length)return!1;var f=e[0],h=f,k=cr.distanceTo(f.x,f.y,b,c),n,r,m;n=1;for(r=e.length;n<r;n++)if(f=e[n],m=cr.distanceTo(f.x,f.y,b,c),0===a&&m<k||1===a&&m>k)k=m,h=f;d.pick_one(h);return!0},n.SetX=function(a){this.x!==a&&(this.x=a,this.set_bbox_changed())},n.SetY=function(a){this.y!==a&&(this.y=a,this.set_bbox_changed())},n.SetPos=function(a,b){if(this.x!==a||this.y!==b)this.x=a,this.y=b,this.set_bbox_changed()},n.SetPosToObject=function(a,b){var c=a.getPairedInstance(this);if(c){var d;c.getImagePoint?(d=c.getImagePoint(b,!0),c=c.getImagePoint(b,!1)):(d=c.x,c=c.y);if(this.x!==d||this.y!==c)this.x=d,this.y=c,this.set_bbox_changed()}},n.MoveForward=function(a){0!==a&&(this.x+=Math.cos(this.angle)*a,this.y+=Math.sin(this.angle)*a,this.set_bbox_changed())},n.MoveAtAngle=function(a,b){0!==b&&(this.x+=Math.cos(cr.to_radians(a))*b,this.y+=Math.sin(cr.to_radians(a))*b,this.set_bbox_changed())},b.X=function(a){a.set_float(this.x)},b.Y=function(a){a.set_float(this.y)},b.dt=function(a){a.set_float(this.runtime.getDt(this))});f&&(r.CompareWidth=function(a,b){return cr.do_cmp(this.width,a,b)},r.CompareHeight=function(a,b){return cr.do_cmp(this.height,a,b)},n.SetWidth=function(a){this.width!==a&&(this.width=a,this.set_bbox_changed())},n.SetHeight=function(a){this.height!==a&&(this.height=a,this.set_bbox_changed())},n.SetSize=function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.set_bbox_changed()},b.Width=function(a){a.set_float(this.width)},b.Height=function(a){a.set_float(this.height)},b.BBoxLeft=function(a){this.update_bbox();a.set_float(this.bbox.left)},b.BBoxTop=function(a){this.update_bbox();a.set_float(this.bbox.top)},b.BBoxRight=function(a){this.update_bbox();a.set_float(this.bbox.right)},b.BBoxBottom=function(a){this.update_bbox();a.set_float(this.bbox.bottom)});h&&(r.AngleWithin=function(a,b){return cr.angleDiff(this.angle,cr.to_radians(b))<=cr.to_radians(a)},r.IsClockwiseFrom=function(a){return cr.angleClockwise(this.angle,cr.to_radians(a))},r.IsBetweenAngles=function(a,b){var c=cr.to_clamped_radians(a),d=cr.to_clamped_radians(b),e=cr.clamp_angle(this.angle);return cr.angleClockwise(d,c)?cr.angleClockwise(e,c)&&!cr.angleClockwise(e,d):!(!cr.angleClockwise(e,c)&&cr.angleClockwise(e,d))},n.SetAngle=function(a){a=cr.to_radians(cr.clamp_angle_degrees(a));isNaN(a)||this.angle===a||(this.angle=a,this.set_bbox_changed())},n.RotateClockwise=function(a){0===a||isNaN(a)||(this.angle+=cr.to_radians(a),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},n.RotateCounterclockwise=function(a){0===a||isNaN(a)||(this.angle-=cr.to_radians(a),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},n.RotateTowardAngle=function(a,b){var c=cr.angleRotate(this.angle,cr.to_radians(b),cr.to_radians(a));isNaN(c)||this.angle===c||(this.angle=c,this.set_bbox_changed())},n.RotateTowardPosition=function(a,b,c){b=Math.atan2(c-this.y,b-this.x);a=cr.angleRotate(this.angle,b,cr.to_radians(a));isNaN(a)||this.angle===a||(this.angle=a,this.set_bbox_changed())},n.SetTowardPosition=function(a,b){var c=Math.atan2(b-this.y,a-this.x);isNaN(c)||this.angle===c||(this.angle=c,this.set_bbox_changed())},b.Angle=function(a){a.set_float(cr.to_clamped_degrees(this.angle))});d||(r.CompareInstanceVar=function(a,b,c){return cr.do_cmp(this.instance_vars[a],b,c)},r.IsBoolInstanceVarSet=function(a){return this.instance_vars[a]},r.PickInstVarHiLow=function(a,b){var c=this.getCurrentSol(),d=c.getObjects();if(!d.length)return!1;var e=d[0],f=e,h=e.instance_vars[b],k,n,r;k=1;for(n=d.length;k<n;k++)if(e=d[k],r=e.instance_vars[b],0===a&&r<h||1===a&&r>h)h=r,f=e;c.pick_one(f);return!0},r.PickByUID=function(a){var b,c,d,e,f;if(this.runtime.getCurrentCondition().inverted){f=this.getCurrentSol();if(f.select_all)for(f.select_all=!1,f.instances.length=0,f.else_instances.length=0,d=this.instances,b=0,c=d.length;b<c;b++)e=d[b],e.uid===a?f.else_instances.push(e):f.instances.push(e);else{d=b=0;for(c=f.instances.length;b<c;b++)e=f.instances[b],f.instances[d]=e,e.uid===a?f.else_instances.push(e):d++;f.instances.length=d}return!!f.instances.length}e=this.runtime.getObjectByUID(a);if(!e)return!1;f=this.getCurrentSol();if(!f.select_all&&-1===f.instances.indexOf(e))return!1;if(this.is_family)for(a=e.type.families,b=0,c=a.length;b<c;b++){if(a[b]===this)return f.pick_one(e),!0}else if(e.type===this)return f.pick_one(e),!0;return!1},r.OnCreated=function(){return!0},r.OnDestroyed=function(){return!0},n.SetInstanceVar=function(a,b){var c=this.instance_vars;cr.is_number(c[a])?cr.is_number(b)?c[a]=b:c[a]=parseFloat(b):cr.is_string(c[a])&&(cr.is_string(b)?c[a]=b:c[a]=b.toString())},n.AddInstanceVar=function(a,b){var c=this.instance_vars;cr.is_number(c[a])?cr.is_number(b)?c[a]+=b:c[a]+=parseFloat(b):cr.is_string(c[a])&&(cr.is_string(b)?c[a]+=b:c[a]+=b.toString())},n.SubInstanceVar=function(a,b){var c=this.instance_vars;cr.is_number(c[a])&&(cr.is_number(b)?c[a]-=b:c[a]-=parseFloat(b))},n.SetBoolInstanceVar=function(a,b){this.instance_vars[a]=b?1:0},n.ToggleBoolInstanceVar=function(a){this.instance_vars[a]=1-this.instance_vars[a]},n.Destroy=function(){this.runtime.DestroyInstance(this)},b.Count=function(a){var b=a.object_class.instances.length,c,d,e;c=0;for(d=this.runtime.createRow.length;c<d;c++)e=this.runtime.createRow[c],a.object_class.is_family?0<=e.type.families.indexOf(a.object_class)&&b++:e.type===a.object_class&&b++;a.set_int(b)},b.PickedCount=function(a){a.set_int(a.object_class.getCurrentSol().getObjects().length)},b.UID=function(a){a.set_int(this.uid)},b.IID=function(a){a.set_int(this.get_iid())});k&&(r.IsVisible=function(){return this.visible},n.SetVisible=function(a){!a!==!this.visible&&(this.visible=a,this.runtime.redraw=!0)},r.CompareOpacity=function(a,b){return cr.do_cmp(cr.round6dp(100*this.opacity),a,b)},n.SetOpacity=function(a){a/=100;0>a?a=0:1<a&&(a=1);a!==this.opacity&&(this.opacity=a,this.runtime.redraw=!0)},b.Opacity=function(a){a.set_float(cr.round6dp(100*this.opacity))});c&&(r.IsOnLayer=function(a){return a?this.layer===a:!1},r.PickTopBottom=function(a){var b=this.getCurrentSol(),c=b.getObjects();if(!c.length)return!1;var d=c[0],e=d,f,h;f=1;for(h=c.length;f<h;f++)if(d=c[f],0===a){if(d.layer.index>e.layer.index||d.layer.index===e.layer.index&&d.get_zindex()>e.get_zindex())e=d}else if(d.layer.index<e.layer.index||d.layer.index===e.layer.index&&d.get_zindex()<e.get_zindex())e=d;b.pick_one(e);return!0},n.MoveToTop=function(){var a=this.get_zindex();a!==this.layer.instances.length-1&&(cr.arrayRemove(this.layer.instances,a),this.layer.instances.push(this),this.runtime.redraw=!0,this.layer.zindices_stale=!0)},n.MoveToBottom=function(){var a=this.get_zindex();0!==a&&(cr.arrayRemove(this.layer.instances,a),this.layer.instances.unshift(this),this.runtime.redraw=!0,this.layer.zindices_stale=!0)},n.MoveToLayer=function(a){a&&a!=this.layer&&(cr.arrayRemove(this.layer.instances,this.get_zindex()),this.layer.zindices_stale=!0,this.layer=a,this.zindex=a.instances.length,a.instances.push(this),this.runtime.redraw=!0)},n.ZMoveToObject=function(a,b){var c=0===a;if(b){var d=b.getFirstPicked(this);if(d&&d.uid!==this.uid){this.layer.index!==d.layer.index&&(cr.arrayRemove(this.layer.instances,this.get_zindex()),this.layer.zindices_stale=!0,this.layer=d.layer,this.zindex=d.layer.instances.length,d.layer.instances.push(this));var e=this.get_zindex(),d=d.get_zindex();cr.arrayRemove(this.layer.instances,e);e<d&&d--;c&&d++;d===this.layer.instances.length?this.layer.instances.push(this):this.layer.instances.splice(d,0,this);this.layer.zindices_stale=!0;this.runtime.redraw=!0}}},b.LayerNumber=function(a){a.set_int(this.layer.number)},b.LayerName=function(a){a.set_string(this.layer.name)},b.ZIndex=function(a){a.set_int(this.get_zindex())});a&&(n.SetEffectEnabled=function(a,b){if(this.runtime.glwrap){var c=this.type.getEffectIndexByName(b);if(!(0>c)){var d=1===a;this.active_effect_flags[c]!==d&&(this.active_effect_flags[c]=d,this.updateActiveEffects(),this.runtime.redraw=!0)}}},n.SetEffectParam=function(a,b,c){if(this.runtime.glwrap){var d=this.type.getEffectIndexByName(a);0>d||(a=this.type.effect_types[d],d=this.effect_params[d],b=Math.floor(b),0>b||b>=d.length||(1===this.runtime.glwrap.getProgramParameterType(a.shaderindex,b)&&(c/=100),d[b]!==c&&(d[b]=c,a.active&&(this.runtime.redraw=!0))))}})};cr.set_bbox_changed=function(){this.bbox_changed=!0;this.runtime.redraw=!0;var a,b;a=0;for(b=this.bbox_changed_callbacks.length;a<b;a++)this.bbox_changed_callbacks[a](this)};cr.add_bbox_changed_callback=function(a){a&&this.bbox_changed_callbacks.push(a)};cr.update_bbox=function(){if(this.bbox_changed){this.bbox.set(this.x,this.y,this.x+this.width,this.y+this.height);this.bbox.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);this.angle?(this.bbox.offset(-this.x,-this.y),this.bquad.set_from_rotated_rect(this.bbox,this.angle),this.bquad.offset(this.x,this.y),this.bquad.bounding_box(this.bbox)):this.bquad.set_from_rect(this.bbox);var a=0;this.bbox.left>this.bbox.right&&(a=this.bbox.left,this.bbox.left=this.bbox.right,this.bbox.right=a);this.bbox.top>this.bbox.bottom&&(a=this.bbox.top,this.bbox.top=this.bbox.bottom,this.bbox.bottom=a);this.bbox_changed=!1}};cr.inst_contains_pt=function(a,b){return this.bbox.contains_pt(a,b)&&this.bquad.contains_pt(a,b)?this.collision_poly&&!this.collision_poly.is_empty()?(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(a-this.x,b-this.y)):!0:!1};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){this.active_effect_types.length=0;var a,b;a=0;for(b=this.active_effect_flags.length;a<b;a++)this.active_effect_flags[a]&&this.active_effect_types.push(this.type.effect_types[a]);this.uses_shaders=!!this.active_effect_types.length};cr.inst_toString=function(){return"Inst"+this.puid};cr.type_getFirstPicked=function(a){if(a&&a.is_contained&&a.type!=this){var b,d,e;b=0;for(d=a.siblings.length;b<d;b++)if(e=a.siblings[b],e.type==this)return e}a=this.getCurrentSol().getObjects();return a.length?a[0]:null};cr.type_getPairedInstance=function(a){var b=this.getCurrentSol().getObjects();return b.length?b[a.get_iid()%b.length]:null};cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var a,b;a=0;for(b=this.instances.length;a<b;a++)this.instances[a].iid=a;this.stale_iids=!1}};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):this.solstack[this.cur_sol].select_all=!0};cr.type_pushCopySol=function(){this.cur_sol++;this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var a=this.solstack[this.cur_sol],b=this.solstack[this.cur_sol-1];b.select_all?a.select_all=!0:(a.select_all=!1,cr.shallowAssignArray(a.instances,b.instances))};cr.type_popSol=function(){this.cur_sol--};cr.type_getBehaviorByName=function(a){var b,d,e,f,h,k=0;if(!this.is_family)for(b=0,d=this.families.length;b<d;b++)for(h=this.families[b],e=0,f=h.behaviors.length;e<f;e++){if(a===h.behaviors[e].name)return this.extra.lastBehIndex=k,h.behaviors[e];k++}b=0;for(d=this.behaviors.length;b<d;b++){if(a===this.behaviors[b].name)return this.extra.lastBehIndex=k,this.behaviors[b];k++}return null};cr.type_getBehaviorIndexByName=function(a){return this.getBehaviorByName(a)?this.extra.lastBehIndex:-1};cr.type_getEffectIndexByName=function(a){var b,d;b=0;for(d=this.effect_types.length;b<d;b++)if(this.effect_types[b].name===a)return b;return-1};cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var a,b,d,e,f,h,k;this.updateIIDs();h=this.getCurrentSol();var c=h.select_all,r=(a=this.runtime.getCurrentEventStack())&&a.current_event&&a.current_event.orblock;a=0;for(b=this.container.length;a<b;a++)if(f=this.container[a],f!==this&&(f.updateIIDs(),k=f.getCurrentSol(),k.select_all=c,!c)){k.instances.length=h.instances.length;d=0;for(e=h.instances.length;d<e;d++)k.instances[d]=f.instances[h.instances[d].iid];if(r)for(k.else_instances.length=h.else_instances.length,d=0,e=h.else_instances.length;d<e;d++)k.else_instances[d]=f.instances[h.else_instances[d].iid]}}};cr.type_toString=function(){return"Type"+this.sid};cr.do_cmp=function(a,b,d){if("undefined"===typeof a||"undefined"===typeof d)return!1;switch(b){case 0:return a===d;case 1:return a!==d;case 2:return a<d;case 3:return a<=d;case 4:return a>d;case 5:return a>=d;default:return!1}};cr.shaders={};cr.shaders.warpripple={src:"varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nuniform mediump float seconds;\nuniform mediump float pixelWidth;\nuniform mediump float layerScale;\nuniform mediump float freq;\nuniform mediump float amp;\nuniform mediump float speed;\nconst mediump float PI = 3.1415926;\nvoid main(void)\n{\nmediump vec2 p = vTex;\nmediump vec2 tex = vTex * 2.0 - 1.0;\nmediump float d = length(tex);\nmediump float a = atan(tex.y, tex.x);\nd += sin((d * 2.0 * PI) * freq / layerScale / (pixelWidth * 750.0) + (seconds * speed)) * amp * (pixelWidth * 750.0) * layerScale;\ntex.x = cos(a) * d;\ntex.y = sin(a) * d;\ntex = (tex + 1.0) / 2.0;\ngl_FragColor = texture2D(samplerFront, tex);\n}",extendBoxHorizontal:50,extendBoxVertical:50,crossSampling:!1,animated:!0,parameters:[["freq",0,0],["amp",0,1],["speed",0,0]]};cr.plugins_.Audio=function(a){this.runtime=a};(function(){function a(a){a=Math.pow(10,a/20);0>a&&(a=0);1<a&&(a=1);return a}function b(a){0>a&&(a=0);1<a&&(a=1);return 20*(Math.log(a)/Math.log(10))}function d(a){a=a.toLowerCase();return L.hasOwnProperty(a)&&L[a].length?L[a][0].getInputNode():I.destination}function e(){return I.createGain?I.createGain():I.createGainNode()}function f(a){return I.createDelay?I.createDelay(a):I.createDelayNode(a)}function h(a){a.start?a.start(0):a.noteOn(0)}function k(a,b,c){a.start?a.start(0,b):a.noteGrainOn(0,b,c-b)}function c(a){a.stop?a.stop(0):a.noteOff(0)}function r(a,b,c,d){if(a)if(a.cancelScheduledValues(0),0===d)a.value=b;else{var e=I.currentTime;d+=e;switch(c){case 0:a.setValueAtTime(b,d);break;case 1:a.setValueAtTime(a.value,e);a.linearRampToValueAtTime(b,d);break;case 2:a.setValueAtTime(a.value,e),a.exponentialRampToValueAtTime(b,d)}}}function n(a,b,c,d,f,g){this.type="filter";this.params=[a,b,c,d,f,g];this.inputNode=e();this.wetNode=e();this.wetNode.gain.value=g;this.dryNode=e();this.dryNode.gain.value=1-g;this.filterNode=I.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?a:ja[a];this.filterNode.frequency.value=b;this.filterNode.detune&&(this.filterNode.detune.value=c);this.filterNode.Q.value=d;this.filterNode.gain.value=f;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode)}function l(a,b,c){this.type="delay";this.params=[a,b,c];this.inputNode=e();this.wetNode=e();this.wetNode.gain.value=c;this.dryNode=e();this.dryNode.gain.value=1-c;this.mainNode=e();this.delayNode=f(a);this.delayNode.delayTime.value=a;this.delayGainNode=e();this.delayGainNode.gain.value=b;this.inputNode.connect(this.mainNode);this.inputNode.connect(this.dryNode);this.mainNode.connect(this.wetNode);this.mainNode.connect(this.delayNode);this.delayNode.connect(this.delayGainNode);this.delayGainNode.connect(this.mainNode)}function q(a,b,c,d){this.type="convolve";this.params=[b,c,d];this.inputNode=e();this.wetNode=e();this.wetNode.gain.value=c;this.dryNode=e();this.dryNode.gain.value=1-c;this.convolveNode=I.createConvolver();a&&(this.convolveNode.normalize=b,this.convolveNode.buffer=a);this.inputNode.connect(this.convolveNode);this.inputNode.connect(this.dryNode);this.convolveNode.connect(this.wetNode)}function v(a,b,c,d,g){this.type="flanger";this.params=[a,b,c,d,g];this.inputNode=e();this.dryNode=e();this.dryNode.gain.value=1-g/2;this.wetNode=e();this.wetNode.gain.value=g/2;this.feedbackNode=e();this.feedbackNode.gain.value=d;this.delayNode=f(a+b);this.delayNode.delayTime.value=a;this.oscNode=I.createOscillator();this.oscNode.frequency.value=c;this.oscGainNode=e();this.oscGainNode.gain.value=b;this.inputNode.connect(this.delayNode);this.inputNode.connect(this.dryNode);this.delayNode.connect(this.wetNode);this.delayNode.connect(this.feedbackNode);this.feedbackNode.connect(this.delayNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.delayNode.delayTime);h(this.oscNode)}function t(a,b,c,d,f,g){this.type="phaser";this.params=[a,b,c,d,f,g];this.inputNode=e();this.dryNode=e();this.dryNode.gain.value=1-g/2;this.wetNode=e();this.wetNode.gain.value=g/2;this.filterNode=I.createBiquadFilter();this.filterNode.type="number"===typeof this.filterNode.type?7:"allpass";this.filterNode.frequency.value=a;this.filterNode.detune&&(this.filterNode.detune.value=b);this.filterNode.Q.value=c;this.oscNode=I.createOscillator();this.oscNode.frequency.value=f;this.oscGainNode=e();this.oscGainNode.gain.value=d;this.inputNode.connect(this.filterNode);this.inputNode.connect(this.dryNode);this.filterNode.connect(this.wetNode);this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.filterNode.frequency);h(this.oscNode)}function p(a){this.type="gain";this.params=[a];this.node=e();this.node.gain.value=a}function g(a,b){this.type="tremolo";this.params=[a,b];this.node=e();this.node.gain.value=1-b/2;this.oscNode=I.createOscillator();this.oscNode.frequency.value=a;this.oscGainNode=e();this.oscGainNode.gain.value=b/2;this.oscNode.connect(this.oscGainNode);this.oscGainNode.connect(this.node.gain);h(this.oscNode)}function u(a,b){this.type="ringmod";this.params=[a,b];this.inputNode=e();this.wetNode=e();this.wetNode.gain.value=b;this.dryNode=e();this.dryNode.gain.value=1-b;this.ringNode=e();this.ringNode.gain.value=0;this.oscNode=I.createOscillator();this.oscNode.frequency.value=a;this.oscNode.connect(this.ringNode.gain);h(this.oscNode);this.inputNode.connect(this.ringNode);this.inputNode.connect(this.dryNode);this.ringNode.connect(this.wetNode)}function D(a,b,c,d,f){this.type="distortion";this.params=[a,b,c,d,f];this.inputNode=e();this.preGain=e();this.postGain=e();this.setDrive(c,Math.pow(10,d/20));this.wetNode=e();this.wetNode.gain.value=f;this.dryNode=e();this.dryNode.gain.value=1-f;this.waveShaper=I.createWaveShaper();this.curve=new Float32Array(65536);this.generateColortouchCurve(a,b);this.waveShaper.curve=this.curve;this.inputNode.connect(this.preGain);this.inputNode.connect(this.dryNode);this.preGain.connect(this.waveShaper);this.waveShaper.connect(this.postGain);this.postGain.connect(this.wetNode)}function B(a,b,c,d,e){this.type="compressor";this.params=[a,b,c,d,e];this.node=I.createDynamicsCompressor();this.node.threshold.value=a;this.node.knee.value=b;this.node.ratio.value=c;this.node.attack.value=d;this.node.release.value=e}function s(a,b){this.type="analyser";this.params=[a,b];this.node=I.createAnalyser();this.node.fftSize=a;this.node.smoothingTimeConstant=b;this.freqBins=new Float32Array(this.node.frequencyBinCount);this.signal=new Uint8Array(a);this.rms=this.peak=0}function m(){this.obj=null;this.loadUid=0;this.speeds=[];this.moveAngle=this.lastY=this.lastX=0}function P(a,b){this.src=a;this.myapi=J;this.is_music=b;this.added_end_listener=!1;var c=this;this.mediaSourceNode=this.outNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.pauseWhenReady=!1;J===E&&(b&&!N.isiOS)&&(this.myapi=S,this.outNode=e());this.bufferObject=null;var d;switch(this.myapi){case S:this.bufferObject=new Audio;J===E&&I.createMediaElementSource&&this.bufferObject.addEventListener("canplay",function(){c.mediaSourceNode=I.createMediaElementSource(c.bufferObject);c.mediaSourceNode.connect(c.outNode)});this.bufferObject.autoplay=!1;this.bufferObject.preload="auto";this.bufferObject.src=a;break;case E:d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(){if(I.decodeAudioData)I.decodeAudioData(d.response,function(a){c.bufferObject=a;var b,d,e;if(cr.is_undefined(c.playTagWhenReady))cr.is_undefined(c.convolveWhenReady)||(b=c.convolveWhenReady.convolveNode,b.normalize=c.normalizeWhenReady,b.buffer=a);else if(c.panWhenReady.length){b=0;for(d=c.panWhenReady.length;b<d;b++){a=c.panWhenReady[b];e=new x(c,a.thistag);e.setPannerEnabled(!0);if("undefined"!==typeof a.objUid&&(a.obj=N.getObjectByUID(a.objUid),!a.obj))continue;if(a.obj){var f=cr.rotatePtAround(a.obj.x,a.obj.y,-a.obj.layer.getAngle(),Z,$,!0),g=cr.rotatePtAround(a.obj.x,a.obj.y,-a.obj.layer.getAngle(),Z,$,!1);e.setPan(f,g,cr.to_degrees(a.obj.angle-a.obj.layer.getAngle()),a.ia,a.oa,a.og);e.setObject(a.obj)}else e.setPan(a.x,a.y,a.a,a.ia,a.oa,a.og);e.play(c.loopWhenReady,c.volumeWhenReady,c.seekWhenReady);c.pauseWhenReady&&e.pause();K.push(e)}c.panWhenReady.length=0}else e=new x(c,c.playTagWhenReady),e.play(c.loopWhenReady,c.volumeWhenReady,c.seekWhenReady),c.pauseWhenReady&&e.pause(),K.push(e)});else if(c.bufferObject=I.createBuffer(d.response,!1),cr.is_undefined(c.playTagWhenReady))cr.is_undefined(c.convolveWhenReady)||(a=c.convolveWhenReady.convolveNode,a.normalize=c.normalizeWhenReady,a.buffer=c.bufferObject);else{var a=new x(c,c.playTagWhenReady);a.play(c.loopWhenReady,c.volumeWhenReady,c.seekWhenReady);c.pauseWhenReady&&a.pause();K.push(a)}};d.send();break;case V:this.bufferObject=!0;break;case aa:this.bufferObject=!0}}function x(a,b){var c=this;this.tag=b;this.stopped=this.fresh=!0;this.src=a.src;this.buffer=a;this.myapi=J;this.is_music=a.is_music;this.playbackRate=1;this.pgended=!0;this.is_paused=this.resume_me=!1;this.resume_position=0;this.is_silent=this.is_muted=this.looping=!1;this.mutevol=this.volume=1;this.startTime=N.kahanTime.sum;this.pannerNode=this.gainNode=null;this.pannerEnabled=!1;this.objectTracker=null;this.panConeOuterGain=this.panConeOuter=this.panConeInner=this.panAngle=this.panY=this.panX=0;this.instanceObject=null;var f=!1;switch(this.myapi){case S:this.is_music?(this.instanceObject=a.bufferObject,f=!a.added_end_listener,a.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.autoplay=!1,this.instanceObject.src=a.bufferObject.src,f=!0);f&&this.instanceObject.addEventListener("ended",function(){W=c.tag;c.stopped=!0;N.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,R)});break;case E:this.gainNode=e();this.gainNode.connect(d(b));this.buffer.myapi===E?a.bufferObject&&(this.instanceObject=I.createBufferSource(),this.instanceObject.buffer=a.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode));break;case V:this.instanceObject=new window.Media(U+this.src,null,null,function(a){a===window.Media.MEDIA_STOPPED&&(c.pgended=!0,c.stopped=!0,W=c.tag,N.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,R))});break;case aa:this.instanceObject=!0}}function z(a){M.length=0;if(a.length){var b,c,d;b=0;for(c=K.length;b<c;b++)d=K[b],cr.equals_nocase(a,d.tag)&&M.push(d)}else O&&!O.hasEnded()&&(M.length=1,M[0]=O)}function G(a){var b,c,d,e,f=I.destination;if(L.hasOwnProperty(a)&&(d=L[a],d.length))for(f=d[0].getInputNode(),b=0,c=d.length;b<c;b++)e=d[b],b+1===c?e.connectTo(I.destination):e.connectTo(d[b+1].getInputNode());z(a);b=0;for(c=M.length;b<c;b++)M[b].reconnect(f);ca&&ga===a&&(ca.disconnect(),ca.connect(f))}function C(a,b){L.hasOwnProperty(a)?L[a].push(b):L[a]=[b];G(a)}function F(){}function y(){}function H(){}function Q(a,b){var c=null;L.hasOwnProperty(a)&&(c=L[a]);return c&&0<=b&&b<c.length&&c[b].freqBins?c[b]:null}var w=cr.plugins_.Audio.prototype;w.Type=function(a){this.plugin=a;this.runtime=a.runtime};w.Type.prototype.onCreate=function(){};var N=null,R=null,W="",U="",S=0,E=1,V=2,aa=3,J=S,I=null,da=[],K=[],O=null,X=!1,fa=0,T=!1,Y=1,Z=0,$=0,ha=1,ia=1,ka=10,la=1E4,ma=1,ca=null,ga="",L={},ja="lowpass highpass bandpass lowshelf highshelf peaking notch allpass".split(" ");n.prototype.connectTo=function(a){this.wetNode.disconnect();this.wetNode.connect(a);this.dryNode.disconnect();this.dryNode.connect(a)};n.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};n.prototype.getInputNode=function(){return this.inputNode};n.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100;0>b&&(b=0);1<b&&(b=1);this.params[4]=b;r(this.wetNode.gain,b,c,d);r(this.dryNode.gain,1-b,c,d);break;case 1:this.params[0]=b;r(this.filterNode.frequency,b,c,d);break;case 2:this.params[1]=b;r(this.filterNode.detune,b,c,d);break;case 3:this.params[2]=b;r(this.filterNode.Q,b,c,d);break;case 4:this.params[3]=b,r(this.filterNode.gain,b,c,d)}};l.prototype.connectTo=function(a){this.wetNode.disconnect();this.wetNode.connect(a);this.dryNode.disconnect();this.dryNode.connect(a)};l.prototype.remove=function(){this.inputNode.disconnect();this.mainNode.disconnect();this.delayNode.disconnect();this.delayGainNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};l.prototype.getInputNode=function(){return this.inputNode};l.prototype.setParam=function(b,c,d,e){switch(b){case 0:c/=100;0>c&&(c=0);1<c&&(c=1);this.params[2]=c;r(this.wetNode.gain,c,d,e);r(this.dryNode.gain,1-c,d,e);break;case 4:this.params[1]=a(c);r(this.delayGainNode.gain,a(c),d,e);break;case 5:this.params[0]=c,r(this.delayNode.delayTime,c,d,e)}};q.prototype.connectTo=function(a){this.wetNode.disconnect();this.wetNode.connect(a);this.dryNode.disconnect();this.dryNode.connect(a)};q.prototype.remove=function(){this.inputNode.disconnect();this.convolveNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};q.prototype.getInputNode=function(){return this.inputNode};q.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100,0>b&&(b=0),1<b&&(b=1),this.params[1]=b,r(this.wetNode.gain,b,c,d),r(this.dryNode.gain,1-b,c,d)}};v.prototype.connectTo=function(a){this.dryNode.disconnect();this.dryNode.connect(a);this.wetNode.disconnect();this.wetNode.connect(a)};v.prototype.remove=function(){this.inputNode.disconnect();this.delayNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect();this.feedbackNode.disconnect()};v.prototype.getInputNode=function(){return this.inputNode};v.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100;0>b&&(b=0);1<b&&(b=1);this.params[4]=b;r(this.wetNode.gain,b/2,c,d);r(this.dryNode.gain,1-b/2,c,d);break;case 6:this.params[1]=b/1E3;r(this.oscGainNode.gain,b/1E3,c,d);break;case 7:this.params[2]=b;r(this.oscNode.frequency,b,c,d);break;case 8:this.params[3]=b/100,r(this.feedbackNode.gain,b/100,c,d)}};t.prototype.connectTo=function(a){this.dryNode.disconnect();this.dryNode.connect(a);this.wetNode.disconnect();this.wetNode.connect(a)};t.prototype.remove=function(){this.inputNode.disconnect();this.filterNode.disconnect();this.oscNode.disconnect();this.oscGainNode.disconnect();this.dryNode.disconnect();this.wetNode.disconnect()};t.prototype.getInputNode=function(){return this.inputNode};t.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100;0>b&&(b=0);1<b&&(b=1);this.params[5]=b;r(this.wetNode.gain,b/2,c,d);r(this.dryNode.gain,1-b/2,c,d);break;case 1:this.params[0]=b;r(this.filterNode.frequency,b,c,d);break;case 2:this.params[1]=b;r(this.filterNode.detune,b,c,d);break;case 3:this.params[2]=b;r(this.filterNode.Q,b,c,d);break;case 6:this.params[3]=b;r(this.oscGainNode.gain,b,c,d);break;case 7:this.params[4]=b,r(this.oscNode.frequency,b,c,d)}};p.prototype.connectTo=function(a){this.node.disconnect();this.node.connect(a)};p.prototype.remove=function(){this.node.disconnect()};p.prototype.getInputNode=function(){return this.node};p.prototype.setParam=function(b,c,d,e){switch(b){case 4:this.params[0]=a(c),r(this.node.gain,a(c),d,e)}};g.prototype.connectTo=function(a){this.node.disconnect();this.node.connect(a)};g.prototype.remove=function(){this.oscNode.disconnect();this.oscGainNode.disconnect();this.node.disconnect()};g.prototype.getInputNode=function(){return this.node};g.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100;0>b&&(b=0);1<b&&(b=1);this.params[1]=b;r(this.node.gain.value,1-b/2,c,d);r(this.oscGainNode.gain.value,b/2,c,d);break;case 7:this.params[0]=b,r(this.oscNode.frequency,b,c,d)}};u.prototype.connectTo=function(a){this.wetNode.disconnect();this.wetNode.connect(a);this.dryNode.disconnect();this.dryNode.connect(a)};u.prototype.remove=function(){this.oscNode.disconnect();this.ringNode.disconnect();this.inputNode.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};u.prototype.getInputNode=function(){return this.inputNode};u.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100;0>b&&(b=0);1<b&&(b=1);this.params[1]=b;r(this.wetNode.gain,b,c,d);r(this.dryNode.gain,1-b,c,d);break;case 7:this.params[0]=b,r(this.oscNode.frequency,b,c,d)}};D.prototype.setDrive=function(a,b){0.01>a&&(a=0.01);this.preGain.gain.value=a;this.postGain.gain.value=Math.pow(1/a,0.6)*b};D.prototype.shape=function(a,b,c){var d=1.05*c*b-b;c=0>a?-1:1;a=0>a?-a:a;b=a<b?a:b+d*(1-Math.exp(-(1/d)*(a-b)));return b*c};D.prototype.generateColortouchCurve=function(a,b){for(var c=Math.pow(10,a/20),d=Math.pow(10,b/20),e=0,f=0;32768>f;++f)e=f/32768,e=this.shape(e,c,d),this.curve[32768+f]=e,this.curve[32768-f-1]=-e};D.prototype.connectTo=function(a){this.wetNode.disconnect();this.wetNode.connect(a);this.dryNode.disconnect();this.dryNode.connect(a)};D.prototype.remove=function(){this.inputNode.disconnect();this.preGain.disconnect();this.waveShaper.disconnect();this.postGain.disconnect();this.wetNode.disconnect();this.dryNode.disconnect()};D.prototype.getInputNode=function(){return this.inputNode};D.prototype.setParam=function(a,b,c,d){switch(a){case 0:b/=100,0>b&&(b=0),1<b&&(b=1),this.params[4]=b,r(this.wetNode.gain,b,c,d),r(this.dryNode.gain,1-b,c,d)}};B.prototype.connectTo=function(a){this.node.disconnect();this.node.connect(a)};B.prototype.remove=function(){this.node.disconnect()};B.prototype.getInputNode=function(){return this.node};B.prototype.setParam=function(a,b,c,d){};s.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins);this.node.getByteTimeDomainData(this.signal);for(var a=this.node.fftSize,c=0,d=this.peak=0,e=0;c<a;c++)e=(this.signal[c]-128)/128,0>e&&(e=-e),this.peak<e&&(this.peak=e),d+=e*e;this.peak=b(this.peak);this.rms=b(Math.sqrt(d/a))};s.prototype.connectTo=function(a){this.node.disconnect();this.node.connect(a)};s.prototype.remove=function(){this.node.disconnect()};s.prototype.getInputNode=function(){return this.node};s.prototype.setParam=function(a,b,c,d){};m.prototype.setObject=function(a){if(this.obj=a)this.lastX=this.obj.x,this.lastY=this.obj.y;this.speeds.length=0};m.prototype.hasObject=function(){return!!this.obj};m.prototype.tick=function(a){this.obj&&(this.moveAngle=cr.angleTo(this.lastX,this.lastY,this.obj.x,this.obj.y),a=cr.distanceTo(this.lastX,this.lastY,this.obj.x,this.obj.y)/a,4>this.speeds.length||this.speeds.shift(),this.speeds.push(a),this.lastX=this.obj.x,this.lastY=this.obj.y)};m.prototype.getSpeed=function(){if(!this.speeds.length)return 0;var a,b,c=0;a=0;for(b=this.speeds.length;a<b;a++)c+=this.speeds[a];return c/this.speeds.length};m.prototype.getVelocityX=function(){return Math.cos(this.moveAngle)*this.getSpeed()};m.prototype.getVelocityY=function(){return Math.sin(this.moveAngle)*this.getSpeed()};var na=!1;P.prototype.isLoaded=function(){switch(this.myapi){case S:return 4===this.bufferObject.readyState;case E:return!!this.bufferObject;case V:return!0;case aa:return!0}return!1};x.prototype.hasEnded=function(){switch(this.myapi){case S:return this.instanceObject.ended;case E:return this.buffer.myapi===E?!this.fresh&&!this.stopped&&this.instanceObject.loop||this.is_paused?!1:N.kahanTime.sum-this.startTime>this.buffer.bufferObject.duration:this.instanceObject.ended;case V:return this.pgended;case aa:!0}return!0};x.prototype.canBeRecycled=function(){return this.fresh||this.stopped?!0:this.hasEnded()};x.prototype.setPannerEnabled=function(a){J===E&&(!this.pannerEnabled&&a?(this.pannerNode||(this.pannerNode=I.createPanner(),this.pannerNode.panningModel="number"===typeof this.pannerNode.panningModel?ha:["equalpower","HRTF","soundfield"][ha],this.pannerNode.distanceModel="number"===typeof this.pannerNode.distanceModel?ia:["linear","inverse","exponential"][ia],this.pannerNode.refDistance=ka,this.pannerNode.maxDistance=la,this.pannerNode.rolloffFactor=ma),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(d(this.tag)),this.pannerEnabled=!0):this.pannerEnabled&&!a&&(this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(d(this.tag)),this.pannerEnabled=!1))};x.prototype.setPan=function(a,b,c,d,e,f){this.pannerEnabled&&J===E&&(this.pannerNode.setPosition(a,b,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(c)),Math.sin(cr.to_radians(c)),0),this.pannerNode.coneInnerAngle=d,this.pannerNode.coneOuterAngle=e,this.pannerNode.coneOuterGain=f,this.panX=a,this.panY=b,this.panAngle=c,this.panConeInner=d,this.panConeOuter=e,this.panConeOuterGain=f)};x.prototype.setObject=function(a){this.pannerEnabled&&J===E&&(this.objectTracker||(this.objectTracker=new m),this.objectTracker.setObject(a))};x.prototype.tick=function(a){if(this.pannerEnabled&&J===E&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(a);a=this.objectTracker.obj;var b=cr.rotatePtAround(a.x,a.y,-a.layer.getAngle(),Z,$,!0),c=cr.rotatePtAround(a.x,a.y,-a.layer.getAngle(),Z,$,!1);this.pannerNode.setPosition(b,c,0);b=0;"undefined"!==typeof this.objectTracker.obj.angle&&(b=a.angle-a.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(b),Math.sin(b),0));this.pannerNode.setVelocity(this.objectTracker.getVelocityX(),this.objectTracker.getVelocityY(),0)}};x.prototype.play=function(a,b,c){var d=this.instanceObject;this.looping=a;this.volume=b;c=c||0;switch(this.myapi){case S:1!==d.playbackRate&&(d.playbackRate=1);d.volume!==b*Y&&(d.volume=b*Y);d.loop!==a&&(d.loop=a);d.muted&&(d.muted=!1);if(d.currentTime!==c)try{d.currentTime=c}catch(e){}this.instanceObject.play();break;case E:this.muted=!1;this.mutevol=1;if(this.buffer.myapi===E)this.fresh||(this.instanceObject=I.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.loop=a,this.gainNode.gain.value=b*Y,0===c?h(this.instanceObject):k(this.instanceObject,c,this.getDuration());else{1!==d.playbackRate&&(d.playbackRate=1);d.loop!==a&&(d.loop=a);this.gainNode.gain.value=b*Y;if(d.currentTime!==c)try{d.currentTime=c}catch(f){}d.play()}break;case V:(!this.fresh&&this.stopped||0!==c)&&d.seekTo(c);d.play();this.pgended=!1;break;case aa:N.isDirectCanvas?AppMobi.context.playSound(this.src):AppMobi.player.playSound(this.src)}this.playbackRate=1;this.startTime=N.kahanTime.sum-c;this.is_paused=this.stopped=this.fresh=!1};x.prototype.stop=function(){switch(this.myapi){case S:this.instanceObject.paused||this.instanceObject.pause();break;case E:this.buffer.myapi===E?c(this.instanceObject):this.instanceObject.paused||this.instanceObject.pause();break;case V:this.instanceObject.stop()}this.stopped=!0;this.is_paused=!1};x.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case S:this.instanceObject.paused||this.instanceObject.pause();break;case E:this.buffer.myapi===E?(this.resume_position=this.getPlaybackTime(),this.looping&&(this.resume_position%=this.getDuration()),c(this.instanceObject)):this.instanceObject.paused||this.instanceObject.pause();break;case V:this.instanceObject.pause()}this.is_paused=!0}};x.prototype.resume=function(){if(!this.fresh&&!this.stopped&&!this.hasEnded()&&this.is_paused){switch(this.myapi){case S:this.instanceObject.play();break;case E:this.buffer.myapi===E?(this.instanceObject=I.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.loop=this.looping,this.gainNode.gain.value=Y*this.volume*this.mutevol,this.startTime=N.kahanTime.sum-this.resume_position,k(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play();break;case V:this.instanceObject.play()}this.is_paused=!1}};x.prototype.seek=function(a){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case S:try{this.instanceObject.currentTime=a}catch(b){}break;case E:if(this.buffer.myapi===E)this.is_paused?this.resume_position=a:(this.pause(),this.resume_position=a,this.resume());else try{this.instanceObject.currentTime=a}catch(c){}}};x.prototype.reconnect=function(a){this.myapi===E&&(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(a)):(this.gainNode.disconnect(),this.gainNode.connect(a)))};x.prototype.getDuration=function(){switch(this.myapi){case S:if("undefined"!==typeof this.instanceObject.duration)return this.instanceObject.duration;break;case E:return this.buffer.bufferObject.duration;case V:return this.instanceObject.getDuration()}return 0};x.prototype.getPlaybackTime=function(){var a=this.getDuration(),b=0;switch(this.myapi){case S:"undefined"!==typeof this.instanceObject.currentTime&&(b=this.instanceObject.currentTime);break;case E:if(this.buffer.myapi===E){if(this.is_paused)return this.resume_position;b=N.kahanTime.sum-this.startTime}else"undefined"!==typeof this.instanceObject.currentTime&&(b=this.instanceObject.currentTime)}!this.looping&&b>a&&(b=a);return b};x.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};x.prototype.setVolume=function(a){this.volume=a;this.updateVolume()};x.prototype.updateVolume=function(){var a=this.volume*Y;switch(this.myapi){case S:this.instanceObject.volume&&this.instanceObject.volume!==a&&(this.instanceObject.volume=a);break;case E:this.gainNode.gain.value=a*this.mutevol}};x.prototype.getVolume=function(){return this.volume};x.prototype.doSetMuted=function(a){switch(this.myapi){case S:this.instanceObject.muted!==!!a&&(this.instanceObject.muted=!!a);break;case E:this.mutevol=a?0:1,this.gainNode.gain.value=Y*this.volume*this.mutevol}};x.prototype.setMuted=function(a){this.is_muted=!!a;this.doSetMuted(this.is_muted||this.is_silent)};x.prototype.setSilent=function(a){this.is_silent=!!a;this.doSetMuted(this.is_muted||this.is_silent)};x.prototype.setLooping=function(a){this.looping=a;switch(this.myapi){case S:this.instanceObject.loop!==!!a&&(this.instanceObject.loop=!!a);break;case E:this.instanceObject.loop!==!!a&&(this.instanceObject.loop=!!a)}};x.prototype.setPlaybackRate=function(a){this.playbackRate=a;this.updatePlaybackRate()};x.prototype.updatePlaybackRate=function(){var a=this.playbackRate;if(1===fa&&!this.is_music||2===fa)a*=N.timescale;switch(this.myapi){case S:this.instanceObject.playbackRate!==a&&(this.instanceObject.playbackRate=a);break;case E:this.buffer.myapi===E?this.instanceObject.playbackRate.value!==a&&(this.instanceObject.playbackRate.value=a):this.instanceObject.playbackRate!==a&&(this.instanceObject.playbackRate=a)}};x.prototype.setSuspended=function(a){switch(this.myapi){case S:a?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&this.instanceObject.play();break;case E:a?this.isPlaying()?(this.buffer.myapi===E?(this.resume_position=this.getPlaybackTime(),this.looping&&(this.resume_position%=this.getDuration()),c(this.instanceObject)):this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===E?(this.instanceObject=I.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.loop=this.looping,this.gainNode.gain.value=Y*this.volume*this.mutevol,this.startTime=N.kahanTime.sum-this.resume_position,k(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play());break;case V:a?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&this.instanceObject.play()}};w.Instance=function(a){this.type=a;N=this.runtime=a.runtime;R=this;this.listenerTracker=null;this.listenerZ=-600;I=null;"undefined"!==typeof AudioContext?(J=E,I=new AudioContext):"undefined"!==typeof webkitAudioContext&&(J=E,I=new webkitAudioContext);this.runtime.isiOS&&J===E&&document.addEventListener("touchstart",function(){if(!na){var a=I.createBuffer(1,1,22050),b=I.createBufferSource();b.buffer=a;b.connect(I.destination);h(b);na=!0}},!0);J!==E&&(this.runtime.isPhoneGap?J=V:this.runtime.isAppMobi&&(J=aa));J===V&&(U=location.href,a=U.lastIndexOf("/"),-1<a&&(U=U.substr(0,a+1)),U=U.replace("file://",""));if(this.runtime.isSafari&&this.runtime.isWindows&&"undefined"===typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)X=this.runtime.isAndroid;else try{X=!!(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}catch(b){X=!1}this.runtime.tickMe(this)}};var ba=w.Instance.prototype;ba.onCreate=function(){fa=this.properties[0];ha=this.properties[1];ia=this.properties[2];this.listenerZ=-this.properties[3];ka=this.properties[4];la=this.properties[5];ma=this.properties[6];this.listenerTracker=new m;J===E&&(I.listener.speedOfSound=this.properties[7],I.listener.dopplerFactor=this.properties[8],I.listener.setPosition(this.runtime.width/2,this.runtime.height/2,this.listenerZ),I.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(a,b){ca&&ca.disconnect();ga=b.toLowerCase();ca=I.createMediaStreamSource(a);ca.connect(d(ga))});this.runtime.addSuspendCallback(function(a){R.onSuspend(a)});var a=this;this.runtime.addDestroyCallback(function(b){a.onInstanceDestroyed(b)})};ba.onInstanceDestroyed=function(a){var b,c,d;b=0;for(c=K.length;b<c;b++)d=K[b],d.objectTracker&&d.objectTracker.obj===a&&(d.objectTracker.obj=null,d.pannerEnabled&&(d.isPlaying()&&d.looping)&&d.stop());this.listenerTracker.obj===a&&(this.listenerTracker.obj=null)};ba.saveToJSON=function(){var a={silent:T,masterVolume:Y,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},b=a.playing,c,d,e,f,g,l;c=0;for(d=K.length;c<d;c++)e=K[c],e.isPlaying()&&(f=e.getPlaybackTime(),e.looping&&(f%=e.getDuration()),f={tag:e.tag,buffersrc:e.buffer.src,is_music:e.is_music,playbackTime:f,volume:e.volume,looping:e.looping,muted:e.is_muted,playbackRate:e.playbackRate,paused:e.is_paused,resume_position:e.resume_position},e.pannerEnabled&&(f.pan={},l=f.pan,e.objectTracker&&e.objectTracker.hasObject()?l.objUid=e.objectTracker.obj.uid:(l.x=e.panX,l.y=e.panY,l.a=e.panAngle),l.ia=e.panConeInner,l.oa=e.panConeOuter,l.og=e.panConeOuterGain),b.push(f));b=a.effects;for(g in L)if(L.hasOwnProperty(g)){e=[];c=0;for(d=L[g].length;c<d;c++)e.push({type:L[g][c].type,params:L[g][c].params});b[g]=e}return a};var ea=[];ba.loadFromJSON=function(a){var b=a.silent;Y=a.masterVolume;this.listenerZ=a.listenerZ;this.listenerTracker.setObject(null);var c=a.listenerUid;-1!==c&&(this.listenerTracker.loadUid=c,ea.push(this.listenerTracker));var c=a.playing,d,e,f,h,k,r,x,y,w,A,z;d=0;for(e=K.length;d<e;d++)K[d].stop();for(k in L)if(L.hasOwnProperty(k))for(d=0,e=L[k].length;d<e;d++)L[k][d].remove();cr.wipe(L);for(k in a.effects)if(a.effects.hasOwnProperty(k))for(r=a.effects[k],d=0,e=r.length;d<e;d++)switch(f=r[d].type,A=r[d].params,f){case"filter":C(k,new n(A[0],A[1],A[2],A[3],A[4],A[5]));break;case"delay":C(k,new l(A[0],A[1],A[2]));break;case"convolve":f=A[2];h=this.getAudioBuffer(f,!1);h.bufferObject?f=new q(h.bufferObject,A[0],A[1],f):(f=new q(null,A[0],A[1],f),h.normalizeWhenReady=A[0],h.convolveWhenReady=f);C(k,f);break;case"flanger":C(k,new v(A[0],A[1],A[2],A[3],A[4]));break;case"phaser":C(k,new t(A[0],A[1],A[2],A[3],A[4],A[5]));break;case"gain":C(k,new p(A[0]));break;case"tremolo":C(k,new g(A[0],A[1]));break;case"ringmod":C(k,new u(A[0],A[1]));break;case"distortion":C(k,new D(A[0],A[1],A[2],A[3],A[4]));break;case"compressor":C(k,new B(A[0],A[1],A[2],A[3],A[4]));break;case"analyser":C(k,new s(A[0],A[1]))}d=0;for(e=c.length;d<e;d++)a=c[d],f=a.buffersrc,h=a.is_music,k=a.tag,r=a.playbackTime,x=a.looping,y=a.volume,z=(A=a.pan)&&A.hasOwnProperty("objUid")?A.objUid:-1,(w=this.getAudioInstance(f,k,h,x,y))?(w.resume_position=a.resume_position,w.setPannerEnabled(!!A),w.play(x,y,r),w.updatePlaybackRate(),w.updateVolume(),w.doSetMuted(w.is_muted||w.is_silent),a.paused&&w.pause(),a.muted&&w.mute(),A&&(-1!==z?(w.objectTracker=w.objectTracker||new m,w.objectTracker.loadUid=z,ea.push(w.objectTracker)):w.setPan(A.x,A.y,A.a,A.ia,A.oa,A.og))):(h=this.getAudioBuffer(f,h),h.seekWhenReady=r,h.pauseWhenReady=a.paused,A&&(-1!==z?h.panWhenReady.push({objUid:z,ia:A.ia,oa:A.oa,og:A.og,thistag:k}):h.panWhenReady.push({x:A.x,y:A.y,a:A.a,ia:A.ia,oa:A.oa,og:A.og,thistag:k})));if(b&&!T){d=0;for(e=K.length;d<e;d++)K[d].setSilent(!0);T=!0}else if(!b&&T){d=0;for(e=K.length;d<e;d++)K[d].setSilent(!1);T=!1}};ba.afterLoad=function(){var a,b,c,d;a=0;for(b=ea.length;a<b;a++)c=ea[a],d=this.runtime.getObjectByUID(c.loadUid),c.setObject(d),c.loadUid=-1,d&&(Z=d.x,$=d.y);ea.length=0};ba.onSuspend=function(a){var b,c;b=0;for(c=K.length;b<c;b++)K[b].setSuspended(a)};ba.tick=function(){var a=this.runtime.dt,b,c,d;b=0;for(c=K.length;b<c;b++)d=K[b],d.tick(a),d.myapi===S||d.myapi===aa||(d.fresh||d.stopped||!d.hasEnded())||(d.stopped=!0,W=d.tag,N.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,R)),0!==fa&&d.updatePlaybackRate();var e,f;for(e in L)if(L.hasOwnProperty(e))for(d=L[e],b=0,c=d.length;b<c;b++)f=d[b],f.tick&&f.tick();J===E&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(a),Z=this.listenerTracker.obj.x,$=this.listenerTracker.obj.y,I.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ),I.listener.setVelocity(this.listenerTracker.getVelocityX(),this.listenerTracker.getVelocityY(),0))};ba.getAudioBuffer=function(a,b){var c,d,e;c=0;for(d=da.length;c<d;c++)if(e=da[c],e.src===a)return e;e=new P(a,b);da.push(e);return e};ba.getAudioInstance=function(a,b,c,d,e){var f,g,l;f=0;for(g=K.length;f<g;f++)if(l=K[f],l.src===a&&(l.canBeRecycled()||c))return l.tag=b,l;a=this.getAudioBuffer(a,c);if(!a.bufferObject)return"<preload>"!==b&&(a.playTagWhenReady=b,a.loopWhenReady=d,a.volumeWhenReady=e),null;l=new x(a,b);K.push(l);return l};var M=[];F.prototype.OnEnded=function(a){return cr.equals_nocase(W,a)};F.prototype.PreloadsComplete=function(){var a,b;a=0;for(b=da.length;a<b;a++)if(!da[a].isLoaded())return!1;return!0};F.prototype.AdvancedAudioSupported=function(){return J===E};F.prototype.IsSilent=function(){return T};F.prototype.IsAnyPlaying=function(){var a,b;a=0;for(b=K.length;a<b;a++)if(K[a].isPlaying())return!0;return!1};F.prototype.IsTagPlaying=function(a){z(a);var b;a=0;for(b=M.length;a<b;a++)if(M[a].isPlaying())return!0;return!1};w.cnds=new F;y.prototype.Play=function(b,c,d,e){!T&&(d=a(d),O=this.getAudioInstance(this.runtime.files_subfolder+b[0]+(X?".ogg":".m4a"),e,b[1],0!==c,d))&&(O.setPannerEnabled(!1),O.play(0!==c,d))};y.prototype.PlayAtPosition=function(b,c,d,e,f,g,l,h,p,t){if(!T){d=a(d);var k=b[1];b=this.runtime.files_subfolder+b[0]+(X?".ogg":".m4a");(O=this.getAudioInstance(b,t,k,0!==c,d))?(O.setPannerEnabled(!0),O.setPan(e,f,g,l,h,a(p)),O.play(0!==c,d)):this.getAudioBuffer(b,k).panWhenReady.push({x:e,y:f,a:g,ia:l,oa:h,og:a(p),thistag:t})}};y.prototype.PlayAtObject=function(b,c,d,e,f,g,l,h){if(!T&&e&&(e=e.getFirstPicked())){d=a(d);var p=b[1];b=this.runtime.files_subfolder+b[0]+(X?".ogg":".m4a");(O=this.getAudioInstance(b,h,p,0!==c,d))?(O.setPannerEnabled(!0),h=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),Z,$,!0),b=cr.rotatePtAround(e.x,e.y,-e.layer.getAngle(),Z,$,!1),O.setPan(h,b,cr.to_degrees(e.angle-e.layer.getAngle()),f,g,a(l)),O.setObject(e),O.play(0!==c,d)):this.getAudioBuffer(b,p).panWhenReady.push({obj:e,ia:f,oa:g,og:a(l),thistag:h})}};y.prototype.PlayByName=function(b,c,d,e,f){!T&&(e=a(e),b=1===b,c=this.runtime.files_subfolder+c.toLowerCase()+(X?".ogg":".m4a"),O=this.getAudioInstance(c,f,b,0!==d,e))&&(O.setPannerEnabled(!1),O.play(0!==d,e))};y.prototype.PlayAtPositionByName=function(b,c,d,e,f,g,l,h,p,t,k){T||(e=a(e),b=1===b,c=this.runtime.files_subfolder+c.toLowerCase()+(X?".ogg":".m4a"),(O=this.getAudioInstance(c,k,b,0!==d,e))?(O.setPannerEnabled(!0),O.setPan(f,g,l,h,p,a(t)),O.play(0!==d,e)):this.getAudioBuffer(c,b).panWhenReady.push({x:f,y:g,a:l,ia:h,oa:p,og:a(t),thistag:k}))};y.prototype.PlayAtObjectByName=function(b,c,d,e,f,g,l,h,p){!T&&f&&(f=f.getFirstPicked())&&(e=a(e),b=1===b,c=this.runtime.files_subfolder+c.toLowerCase()+(X?".ogg":".m4a"),(O=this.getAudioInstance(c,p,b,0!==d,e))?(O.setPannerEnabled(!0),p=cr.rotatePtAround(f.x,f.y,-f.layer.getAngle(),Z,$,!0),c=cr.rotatePtAround(f.x,f.y,-f.layer.getAngle(),Z,$,!1),O.setPan(p,c,cr.to_degrees(f.angle-f.layer.getAngle()),g,l,a(h)),O.setObject(f),O.play(0!==d,e)):this.getAudioBuffer(c,b).panWhenReady.push({obj:f,ia:g,oa:l,og:a(h),thistag:p}))};y.prototype.SetLooping=function(a,b){z(a);var c,d;c=0;for(d=M.length;c<d;c++)M[c].setLooping(0===b)};y.prototype.SetMuted=function(a,b){z(a);var c,d;c=0;for(d=M.length;c<d;c++)M[c].setMuted(0===b)};y.prototype.SetVolume=function(b,c){z(b);var d=a(c),e,f;e=0;for(f=M.length;e<f;e++)M[e].setVolume(d)};y.prototype.Preload=function(a){if(!T){var b=a[1];a=this.runtime.files_subfolder+a[0]+(X?".ogg":".m4a");J===aa?this.runtime.isDirectCanvas?AppMobi.context.loadSound(a):AppMobi.player.loadSound(a):J!==V&&this.getAudioInstance(a,"<preload>",b,!1)}};y.prototype.PreloadByName=function(a,b){if(!T){var c=1===a,d=this.runtime.files_subfolder+b.toLowerCase()+(X?".ogg":".m4a");J===aa?this.runtime.isDirectCanvas?AppMobi.context.loadSound(d):AppMobi.player.loadSound(d):J!==V&&this.getAudioInstance(d,"<preload>",c,!1)}};y.prototype.SetPlaybackRate=function(a,b){z(a);0>b&&(b=0);var c,d;c=0;for(d=M.length;c<d;c++)M[c].setPlaybackRate(b)};y.prototype.Stop=function(a){z(a);var b;a=0;for(b=M.length;a<b;a++)M[a].stop()};y.prototype.StopAll=function(){var a,b;a=0;for(b=K.length;a<b;a++)K[a].stop()};y.prototype.SetPaused=function(a,b){z(a);var c,d;c=0;for(d=M.length;c<d;c++)0===b?M[c].pause():M[c].resume()};y.prototype.Seek=function(a,b){z(a);var c,d;c=0;for(d=M.length;c<d;c++)M[c].seek(b)};y.prototype.SetSilent=function(a){var b;2===a&&(a=T?1:0);if(0===a&&!T){a=0;for(b=K.length;a<b;a++)K[a].setSilent(!0);T=!0}else if(1===a&&T){a=0;for(b=K.length;a<b;a++)K[a].setSilent(!1);T=!1}};y.prototype.SetMasterVolume=function(b){Y=a(b);var c;b=0;for(c=K.length;b<c;b++)K[b].updateVolume()};y.prototype.AddFilterEffect=function(a,b,c,d,e,f,g){J!==E||(0>b||b>=ja.length)||(a=a.toLowerCase(),g/=100,0>g&&(g=0),1<g&&(g=1),C(a,new n(b,c,d,e,f,g)))};y.prototype.AddDelayEffect=function(b,c,d,e){J===E&&(b=b.toLowerCase(),e/=100,0>e&&(e=0),1<e&&(e=1),C(b,new l(c,a(d),e)))};y.prototype.AddFlangerEffect=function(a,b,c,d,e,f){J===E&&(a=a.toLowerCase(),f/=100,0>f&&(f=0),1<f&&(f=1),C(a,new v(b/1E3,c/1E3,d,e/100,f)))};y.prototype.AddPhaserEffect=function(a,b,c,d,e,f,g){J===E&&(a=a.toLowerCase(),g/=100,0>g&&(g=0),1<g&&(g=1),C(a,new t(b,c,d,e,f,g)))};y.prototype.AddConvolutionEffect=function(a,b,c,d){if(J===E){c=0===c;var e=this.runtime.files_subfolder+b[0]+(X?".ogg":".m4a");b=this.getAudioBuffer(e,!1);a=a.toLowerCase();d/=100;0>d&&(d=0);1<d&&(d=1);b.bufferObject?d=new q(b.bufferObject,c,d,e):(d=new q(null,c,d,e),b.normalizeWhenReady=c,b.convolveWhenReady=d);C(a,d)}};y.prototype.AddGainEffect=function(b,c){J===E&&(b=b.toLowerCase(),C(b,new p(a(c))))};y.prototype.AddMuteEffect=function(a){J===E&&(a=a.toLowerCase(),C(a,new p(0)))};y.prototype.AddTremoloEffect=function(a,b,c){J===E&&(a=a.toLowerCase(),c/=100,0>c&&(c=0),1<c&&(c=1),C(a,new g(b,c)))};y.prototype.AddRingModEffect=function(a,b,c){J===E&&(a=a.toLowerCase(),c/=100,0>c&&(c=0),1<c&&(c=1),C(a,new u(b,c)))};y.prototype.AddDistortionEffect=function(a,b,c,d,e,f){J===E&&(a=a.toLowerCase(),f/=100,0>f&&(f=0),1<f&&(f=1),C(a,new D(b,c,d,e,f)))};y.prototype.AddCompressorEffect=function(a,b,c,d,e,f){J===E&&(a=a.toLowerCase(),C(a,new B(b,c,d,e/1E3,f/1E3)))};y.prototype.AddAnalyserEffect=function(a,b,c){J===E&&(a=a.toLowerCase(),C(a,new s(b,c)))};y.prototype.RemoveEffects=function(a){if(J===E){a=a.toLowerCase();var b,c,d;if(L.hasOwnProperty(a)&&(d=L[a],d.length)){b=0;for(c=d.length;b<c;b++)d[b].remove();d.length=0;G(a)}}};y.prototype.SetEffectParameter=function(a,b,c,d,e,f){J===E&&(a=a.toLowerCase(),b=Math.floor(b),L.hasOwnProperty(a)&&(a=L[a],0>b||b>=a.length||a[b].setParam(c,d,e,f)))};y.prototype.SetListenerObject=function(a){a&&J===E&&(a=a.getFirstPicked())&&(this.listenerTracker.setObject(a),Z=a.x,$=a.y)};y.prototype.SetListenerZ=function(a){this.listenerZ=a};w.acts=new y;H.prototype.Duration=function(a,b){z(b);M.length?a.set_float(M[0].getDuration()):a.set_float(0)};H.prototype.PlaybackTime=function(a,b){z(b);M.length?a.set_float(M[0].getPlaybackTime()):a.set_float(0)};H.prototype.Volume=function(a,c){z(c);if(M.length){var d=M[0].getVolume();a.set_float(b(d))}else a.set_float(0)};H.prototype.MasterVolume=function(a){a.set_float(Y)};H.prototype.EffectCount=function(a,b){b=b.toLowerCase();var c=null;L.hasOwnProperty(b)&&(c=L[b]);a.set_int(c?c.length:0)};H.prototype.AnalyserFreqBinCount=function(a,b,c){b=b.toLowerCase();c=Math.floor(c);b=Q(b,c);a.set_int(b?b.node.frequencyBinCount:0)};H.prototype.AnalyserFreqBinAt=function(a,b,c,d){b=b.toLowerCase();c=Math.floor(c);d=Math.floor(d);(b=Q(b,c))?0>d||d>=b.node.frequencyBinCount?a.set_float(0):a.set_float(b.freqBins[d]):a.set_float(0)};H.prototype.AnalyserPeakLevel=function(a,b,c){b=b.toLowerCase();c=Math.floor(c);(b=Q(b,c))?a.set_float(b.peak):a.set_float(0)};H.prototype.AnalyserRMSLevel=function(a,b,c){b=b.toLowerCase();c=Math.floor(c);(b=Q(b,c))?a.set_float(b.rms):a.set_float(0)};w.exps=new H})();cr.plugins_.Browser=function(a){this.runtime=a};(function(){function a(){}function b(){}function d(){"undefined"!==typeof jQuery&&k.setSize(jQuery(window).width(),jQuery(window).height())}function e(){}var f=cr.plugins_.Browser.prototype;f.Type=function(a){this.plugin=a;this.runtime=a.runtime};f.Type.prototype.onCreate=function(){};f.Instance=function(a){this.type=a;this.runtime=a.runtime};f.Instance.prototype.onCreate=function(){var a=this;window.addEventListener("resize",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,a)});"undefined"!==typeof navigator.onLine&&(window.addEventListener("online",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,a)}),window.addEventListener("offline",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,a)}));"undefined"!==typeof window.applicationCache&&(window.applicationCache.addEventListener("updateready",function(){a.runtime.loadingprogress=1;a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,a)}),window.applicationCache.addEventListener("progress",function(b){a.runtime.loadingprogress=b.loaded/b.total}));this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,a)}),document.addEventListener("menubutton",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,a)}),document.addEventListener("searchbutton",function(){a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,a)}));this.runtime.addSuspendCallback(function(b){b?a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,a):a.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,a)});this.is_arcade="undefined"!==typeof window.is_scirra_arcade;this.fullscreenOldMarginCss=""};a.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:!1};a.prototype.IsOnline=function(){return navigator?navigator.onLine:!1};a.prototype.HasJava=function(){return navigator?navigator.javaEnabled():!1};a.prototype.OnOnline=function(){return!0};a.prototype.OnOffline=function(){return!0};a.prototype.IsDownloadingUpdate=function(){return"undefined"===typeof window.applicationCache?!1:window.applicationCache.status===window.applicationCache.DOWNLOADING};a.prototype.OnUpdateReady=function(){return!0};a.prototype.PageVisible=function(){return!this.runtime.isSuspended};a.prototype.OnPageVisible=function(){return!0};a.prototype.OnPageHidden=function(){return!0};a.prototype.OnResize=function(){return!0};a.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)};a.prototype.OnMenuButton=function(){return!0};a.prototype.OnSearchButton=function(){return!0};a.prototype.IsMetered=function(){var a=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return a?a.metered:!1};a.prototype.IsCharging=function(){var a=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return a?a.charging:!0};f.cnds=new a;b.prototype.Alert=function(a){this.runtime.isDomFree||alert(a.toString())};b.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():this.runtime.isNodeWebkit?window.nwgui.App.quit():this.is_arcade||this.runtime.isDomFree||window.close()};b.prototype.Focus=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().focus():this.is_arcade||this.runtime.isDomFree||window.focus()};b.prototype.Blur=function(){this.runtime.isNodeWebkit?window.nwgui.Window.get().blur():this.is_arcade||this.runtime.isDomFree||window.blur()};b.prototype.GoBack=function(){this.is_arcade||(this.runtime.isDomFree||!window.back)||window.back()};b.prototype.GoForward=function(){this.is_arcade||(this.runtime.isDomFree||!window.forward)||window.forward()};b.prototype.GoHome=function(){this.is_arcade||(this.runtime.isDomFree||!window.home)||window.home()};b.prototype.GoToURL=function(a){this.runtime.isCocoonJs?CocoonJS.App.openURL(a):this.is_arcade||this.runtime.isDomFree||(window.location=a)};b.prototype.GoToURLWindow=function(a,b){this.runtime.isCocoonJs?CocoonJS.App.openURL(a):this.is_arcade||this.runtime.isDomFree||window.open(a,b)};b.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var h=!0,k=null;b.prototype.RequestFullScreen=function(a){this.runtime.isDomFree?cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored"):(2<=a&&(a+=1),6===a&&(a=2),this.runtime.isNodeWebkit?this.runtime.isNodeFullscreen||(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0):document.mozFullScreen||(document.webkitIsFullScreen||document.fullScreen)||(this.fullscreenOldMarginCss=jQuery(this.runtime.canvasdiv).css("margin"),jQuery(this.runtime.canvasdiv).css("margin","0"),window.c2resizestretchmode=0<a?1:0,this.runtime.fullscreen_scaling=2<=a?a:0,a=this.runtime.canvasdiv||this.runtime.canvas,h&&(h=!1,k=this.runtime,a.addEventListener("mozfullscreenerror",d),a.addEventListener("webkitfullscreenerror",d),a.addEventListener("msfullscreenerror",d),a.addEventListener("fullscreenerror",d)),cr.is_undefined(a.webkitRequestFullScreen)?cr.is_undefined(a.mozRequestFullScreen)?cr.is_undefined(a.requestFullscreen)||a.requestFullscreen():a.mozRequestFullScreen():"undefined"!==typeof Element&&"undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):a.webkitRequestFullScreen()))};b.prototype.CancelFullScreen=function(){this.runtime.isDomFree?cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):this.runtime.isNodeWebkit?this.runtime.isNodeFullscreen&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):(cr.is_undefined(document.webkitCancelFullScreen)||document.webkitCancelFullScreen(),cr.is_undefined(document.mozCancelFullScreen)||document.mozCancelFullScreen(),cr.is_undefined(document.exitFullscreen)||document.exitFullscreen(),jQuery(this.runtime.canvasdiv).css("margin",this.fullscreenOldMarginCss))};b.prototype.Vibrate=function(a){try{var b=a.split(","),d,e;d=0;for(e=b.length;d<e;d++)b[d]=parseInt(b[d],10);navigator.vibrate?navigator.vibrate(b):navigator.mozVibrate?navigator.mozVibrate(b):navigator.webkitVibrate&&navigator.webkitVibrate(b)}catch(f){}};b.prototype.InvokeDownload=function(a,b){var d=document.createElement("a");if("undefined"===typeof d.download)window.open(a);else{var e=document.getElementsByTagName("body")[0];d.textContent=b;d.href=a;d.download=b;e.appendChild(d);var f=document.createEvent("MouseEvent");f.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);d.dispatchEvent(f);e.removeChild(d)}};b.prototype.ConsoleLog=function(a,b){console&&(0===a&&console.log&&console.log(b),1===a&&console.warn&&console.warn(b),2===a&&console.error&&console.error(b))};b.prototype.ConsoleGroup=function(a){console&&console.group&&console.group(a)};b.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()};b.prototype.ExecJs=function(a){eval&&eval(a)};f.acts=new b;e.prototype.URL=function(a){a.set_string(this.runtime.isDomFree?"":window.location.toString())};e.prototype.Protocol=function(a){a.set_string(this.runtime.isDomFree?"":window.location.protocol)};e.prototype.Domain=function(a){a.set_string(this.runtime.isDomFree?"":window.location.hostname)};e.prototype.PathName=function(a){a.set_string(this.runtime.isDomFree?"":window.location.pathname)};e.prototype.Hash=function(a){a.set_string(this.runtime.isDomFree?"":window.location.hash)};e.prototype.Referrer=function(a){a.set_string(this.runtime.isDomFree?"":document.referrer)};e.prototype.Title=function(a){a.set_string(this.runtime.isDomFree?"":document.title)};e.prototype.Name=function(a){a.set_string(this.runtime.isDomFree?"":navigator.appName)};e.prototype.Version=function(a){a.set_string(this.runtime.isDomFree?"":navigator.appVersion)};e.prototype.Language=function(a){navigator&&navigator.language?a.set_string(navigator.language):a.set_string("")};e.prototype.Platform=function(a){a.set_string(this.runtime.isDomFree?"":navigator.platform)};e.prototype.Product=function(a){navigator&&navigator.product?a.set_string(navigator.product):a.set_string("")};e.prototype.Vendor=function(a){navigator&&navigator.vendor?a.set_string(navigator.vendor):a.set_string("")};e.prototype.UserAgent=function(a){a.set_string(this.runtime.isDomFree?"":navigator.userAgent)};e.prototype.QueryString=function(a){a.set_string(this.runtime.isDomFree?"":window.location.search)};e.prototype.QueryParam=function(a,b){if(this.runtime.isDomFree)a.set_string("");else{var d=RegExp("[?&]"+b+"=([^&]*)").exec(window.location.search);d?a.set_string(decodeURIComponent(d[1].replace(/\+/g," "))):a.set_string("")}};e.prototype.Bandwidth=function(a){var b=navigator.connection||navigator.mozConnection||navigator.webkitConnection;b?a.set_float(b.bandwidth):a.set_float(Number.POSITIVE_INFINITY)};e.prototype.BatteryLevel=function(a){var b=navigator.battery||navigator.mozBattery||navigator.webkitBattery;b?a.set_float(b.level):a.set_float(1)};e.prototype.BatteryTimeLeft=function(a){var b=navigator.battery||navigator.mozBattery||navigator.webkitBattery;b?a.set_float(b.dischargingTime):a.set_float(Number.POSITIVE_INFINITY)};e.prototype.ExecJS=function(a,b){if(eval){var d=eval(b);"number"===typeof d?a.set_any(d):"string"===typeof d?a.set_any(d):"boolean"===typeof d?a.set_any(d?1:0):a.set_any(0)}else a.set_any(0)};f.exps=new e})();cr.plugins_.Keyboard=function(a){this.runtime=a};(function(){function a(){}function b(){}function d(a){a=Math.floor(a);switch(a){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(a)}}var e=cr.plugins_.Keyboard.prototype;e.Type=function(a){this.plugin=a;this.runtime=a.runtime};e.Type.prototype.onCreate=function(){};e.Instance=function(a){this.type=a;this.runtime=a.runtime;this.keyMap=Array(256);this.usedKeys=Array(256);this.triggerKey=0};var f=e.Instance.prototype;f.onCreate=function(){var a=this;this.runtime.isDomFree||(jQuery(document).keydown(function(b){a.onKeyDown(b)}),jQuery(document).keyup(function(b){a.onKeyUp(b)}))};var h=[32,33,34,35,36,37,38,39,40,44];f.onKeyDown=function(a){var b=!1;window!=window.top&&-1<h.indexOf(a.which)&&(a.preventDefault(),b=!0,a.stopPropagation());if(this.keyMap[a.which])this.usedKeys[a.which]&&!b&&a.preventDefault();else{this.keyMap[a.which]=!0;this.triggerKey=a.which;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var d=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),e=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);if(d||e)this.usedKeys[a.which]=!0,b||a.preventDefault()}};f.onKeyUp=function(a){this.keyMap[a.which]=!1;this.triggerKey=a.which;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var b=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),d=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(b||d||this.usedKeys[a.which])this.usedKeys[a.which]=!0,a.preventDefault()};f.saveToJSON=function(){return{triggerKey:this.triggerKey}};f.loadFromJSON=function(a){this.triggerKey=a.triggerKey};a.prototype.IsKeyDown=function(a){return this.keyMap[a]};a.prototype.OnKey=function(a){return a===this.triggerKey};a.prototype.OnAnyKey=function(a){return!0};a.prototype.OnAnyKeyReleased=function(a){return!0};a.prototype.OnKeyReleased=function(a){return a===this.triggerKey};a.prototype.IsKeyCodeDown=function(a){a=Math.floor(a);return 0>a||a>=this.keyMap.length?!1:this.keyMap[a]};a.prototype.OnKeyCode=function(a){return a===this.triggerKey};a.prototype.OnKeyCodeReleased=function(a){return a===this.triggerKey};e.cnds=new a;e.acts=new function(){};b.prototype.LastKeyCode=function(a){a.set_int(this.triggerKey)};b.prototype.StringFromKeyCode=function(a,b){a.set_string(d(b))};e.exps=new b})();cr.plugins_.NodeWebkit=function(a){this.runtime=a};(function(){function a(){}function b(){}function d(){}var e=!1,f=null,h=null,k=null,c="",r="",n="\\",l=[],q="",v="",t=cr.plugins_.NodeWebkit.prototype;t.Type=function(a){this.plugin=a;this.runtime=a.runtime};t.Type.prototype.onCreate=function(){};t.Instance=function(a){this.type=a;this.runtime=a.runtime};var p=t.Instance.prototype;p.onCreate=function(){e=this.runtime.isNodeWebkit;var a=this;e&&(f=require("path"),h=require("fs"),k=require("child_process"),"win32"!==process.platform&&(n="/"),c=f.dirname(process.execPath)+n,r=(process.env.HOME||process.env.HOMEPATH||process.env.USERPROFILE)+n,window.ondrop=function(b){b.preventDefault();for(var c=0;c<b.dataTransfer.files.length;++c)q=b.dataTransfer.files[c].path,a.runtime.trigger(cr.plugins_.NodeWebkit.prototype.cnds.OnFileDrop,a);return!1},jQuery("#c2nwOpenFileDialog").change(function(b){v=jQuery(this).val();a.runtime.trigger(cr.plugins_.NodeWebkit.prototype.cnds.OnOpenDlg,a)}),jQuery("#c2nwChooseFolderDialog").change(function(b){v=jQuery(this).val();a.runtime.trigger(cr.plugins_.NodeWebkit.prototype.cnds.OnFolderDlg,a)}),jQuery("#c2nwSaveDialog").change(function(b){v=jQuery(this).val();a.runtime.trigger(cr.plugins_.NodeWebkit.prototype.cnds.OnSaveDlg,a)}))};p.onDestroy=function(){};p.saveToJSON=function(){return{}};p.loadFromJSON=function(a){};a.prototype.PathExists=function(a){return e?h.existsSync(a):!1};a.prototype.OnFileDrop=function(){return!0};a.prototype.OnOpenDlg=function(){return!0};a.prototype.OnFolderDlg=function(){return!0};a.prototype.OnSaveDlg=function(){return!0};t.cnds=new a;b.prototype.WriteFile=function(a,b){if(e)try{h.writeFileSync(a,b,{encoding:"utf8"})}catch(c){}};b.prototype.RenameFile=function(a,b){if(e)try{h.renameSync(a,b)}catch(c){}};b.prototype.DeleteFile=function(a){if(e)try{h.unlinkSync(a)}catch(b){}};b.prototype.CopyFile=function(a,b){if(e&&a!==b)try{var c=h.readFileSync(a,{flags:"rb"});h.writeFileSync(b,c,{flags:"wb"})}catch(d){}};b.prototype.MoveFile=function(a,b){if(e&&a!==b)try{var c=h.readFileSync(a,{flags:"rb"});h.writeFileSync(b,c,{flags:"wb"});h.existsSync(b)&&h.unlinkSync(a)}catch(d){}};b.prototype.RunFile=function(a){e&&k.exec(a,function(){})};b.prototype.CreateFolder=function(a){if(e)try{h.mkdirSync(a)}catch(b){}};b.prototype.AppendFile=function(a,b){if(e)try{h.appendFileSync(a,b,{encoding:"utf8"})}catch(c){}};b.prototype.ListFiles=function(a){if(e){try{l=h.readdirSync(a)}catch(b){}l||(l=[])}};b.prototype.ShowOpenDlg=function(a){if(e){var b=jQuery("#c2nwOpenFileDialog");b.attr("accept",a);b.trigger("click")}};b.prototype.ShowFolderDlg=function(a){e&&jQuery("#c2nwChooseFolderDialog").trigger("click")};b.prototype.ShowSaveDlg=function(a){if(e){var b=jQuery("#c2nwSaveDialog");b.attr("accept",a);b.trigger("click")}};t.acts=new b;d.prototype.AppFolder=function(a){a.set_string(c)};d.prototype.UserFolder=function(a){a.set_string(r)};d.prototype.ReadFile=function(a,b){if(e){var c="";try{c=h.readFileSync(b,{encoding:"utf8"})}catch(d){}a.set_string(c)}else a.set_string("")};d.prototype.ListCount=function(a){a.set_int(l.length)};d.prototype.ListAt=function(a,b){b=Math.floor(b);0>b||b>=l.length?a.set_string(""):a.set_string(l[b])};d.prototype.DroppedFile=function(a){a.set_string(q)};d.prototype.ChosenPath=function(a){a.set_string(v)};t.exps=new d})();cr.plugins_.Particles=function(a){this.runtime=a};(function(){function a(a){this.owner=a;this.active=!1;this.angle=this.speed=this.y=this.x=0;this.opacity=1;this.age=this.gs=this.size=this.grow=0;cr.seal(this)}function b(){}function d(){}function e(){}var f=cr.plugins_.Particles.prototype;f.Type=function(a){this.plugin=a;this.runtime=a.runtime};var h=f.Type.prototype;h.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.src=this.texture_file,this.texture_img.cr_filesize=this.texture_filesize,this.webGL_texture=null,this.runtime.wait_for_textures.push(this.texture_img))};h.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)};h.onRestoreWebGLContext=function(){this.is_family||!this.instances.length||this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};h.loadTextures=function(){this.is_family||(this.webGL_texture||!this.runtime.glwrap)||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))};h.unloadTextures=function(){this.is_family||(this.instances.length||!this.webGL_texture)||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)};h.preloadCanvas2D=function(a){a.drawImage(this.texture_img,0,0)};a.prototype.init=function(){var a=this.owner;this.x=a.x-a.xrandom/2+Math.random()*a.xrandom;this.y=a.y-a.yrandom/2+Math.random()*a.yrandom;this.speed=a.initspeed-a.speedrandom/2+Math.random()*a.speedrandom;this.angle=a.angle-a.spraycone/2+Math.random()*a.spraycone;this.opacity=a.initopacity;this.size=a.initsize-a.sizerandom/2+Math.random()*a.sizerandom;this.grow=a.growrate-a.growrandom/2+Math.random()*a.growrandom;this.age=this.gs=0};a.prototype.tick=function(a){var b=this.owner;this.x+=Math.cos(this.angle)*this.speed*a;this.y+=Math.sin(this.angle)*this.speed*a;this.y+=this.gs*a;this.speed+=b.acc*a;this.size+=this.grow*a;this.gs+=b.g*a;this.age+=a;1>this.size?this.active=!1:(0!==b.lifeanglerandom&&(this.angle+=Math.random()*b.lifeanglerandom*a-b.lifeanglerandom*a/2),0!==b.lifespeedrandom&&(this.speed+=Math.random()*b.lifespeedrandom*a-b.lifespeedrandom*a/2),0!==b.lifeopacityrandom&&(this.opacity+=Math.random()*b.lifeopacityrandom*a-b.lifeopacityrandom*a/2,0>this.opacity?this.opacity=0:1<this.opacity&&(this.opacity=1)),1>=b.destroymode&&this.age>=b.timeout&&(this.active=!1),2===b.destroymode&&0>=this.speed&&(this.active=!1))};a.prototype.draw=function(a){var b=this.owner.opacity*this.opacity;if(0!==b){0===this.owner.destroymode&&(b*=1-this.age/this.owner.timeout);a.globalAlpha=b;var b=this.x-this.size/2,d=this.y-this.size/2;this.owner.runtime.pixel_rounding&&(b=b+0.5|0,d=d+0.5|0);a.drawImage(this.owner.type.texture_img,b,d,this.size,this.size)}};a.prototype.drawGL=function(a){var b=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(b*=1-this.age/this.owner.timeout);var d=this.size,e=d*this.owner.particlescale,f=this.x-d/2,h=this.y-d/2;this.owner.runtime.pixel_rounding&&(f=f+0.5|0,h=h+0.5|0);1>e||0===b||(e<a.minPointSize||e>a.maxPointSize?(a.setOpacity(b),a.quad(f,h,f+d,h,f+d,h+d,f,h+d)):a.point(this.x,this.y,e,b))};a.prototype.left=function(){return this.x-this.size/2};a.prototype.right=function(){return this.x+this.size/2};a.prototype.top=function(){return this.y-this.size/2};a.prototype.bottom=function(){return this.y+this.size/2};f.Instance=function(a){this.type=a;this.runtime=a.runtime};var h=f.Instance.prototype,k=[];h.onCreate=function(){var a=this.properties;this.rate=a[0];this.spraycone=cr.to_radians(a[1]);this.spraytype=a[2];this.spraying=!0;this.initspeed=a[3];this.initsize=a[4];this.initopacity=a[5]/100;this.growrate=a[6];this.xrandom=a[7];this.yrandom=a[8];this.speedrandom=a[9];this.sizerandom=a[10];this.growrandom=a[11];this.acc=a[12];this.g=a[13];this.lifeanglerandom=a[14];this.lifespeedrandom=a[15];this.lifeopacityrandom=a[16];this.destroymode=a[17];this.timeout=a[18];this.particleCreateCounter=0;this.particlescale=1;this.particleBoxLeft=this.x;this.particleBoxTop=this.y;this.particleBoxRight=this.x;this.particleBoxBottom=this.y;this.add_bbox_changed_callback(function(a){a.bbox.set(a.particleBoxLeft,a.particleBoxTop,a.particleBoxRight,a.particleBoxBottom);a.bquad.set_from_rect(a.bbox);a.bbox_changed=!1});this.recycled||(this.particles=[]);this.runtime.tickMe(this);this.type.loadTextures();if(1===this.spraytype)for(a=0;a<this.rate;a++)this.allocateParticle().opacity=0;this.first_tick=!0};h.saveToJSON=function(){var a={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},b,d,e,f=a.p;b=0;for(d=this.particles.length;b<d;b++)e=this.particles[b],f.push([e.x,e.y,e.speed,e.angle,e.opacity,e.grow,e.size,e.gs,e.age]);return a};h.loadFromJSON=function(a){this.rate=a.r;this.spraycone=a.sc;this.spraytype=a.st;this.spraying=a.s;this.initspeed=a.isp;this.initsize=a.isz;this.initopacity=a.io;this.growrate=a.gr;this.xrandom=a.xr;this.yrandom=a.yr;this.speedrandom=a.spr;this.sizerandom=a.szr;this.growrandom=a.grnd;this.acc=a.acc;this.g=a.g;this.lifeanglerandom=a.lar;this.lifespeedrandom=a.lsr;this.lifeopacityrandom=a.lor;this.destroymode=a.dm;this.timeout=a.to;this.particleCreateCounter=a.pcc;this.first_tick=a.ft;k.push.apply(k,this.particles);this.particles.length=0;var b,d,e,f=a.p;a=0;for(b=f.length;a<b;a++)d=this.allocateParticle(),e=f[a],d.x=e[0],d.y=e[1],d.speed=e[2],d.angle=e[3],d.opacity=e[4],d.grow=e[5],d.size=e[6],d.gs=e[7],d.age=e[8]};h.onDestroy=function(){k.push.apply(k,this.particles);this.particles.length=0};h.allocateParticle=function(){var b;k.length?(b=k.pop(),b.owner=this):b=new a(this);this.particles.push(b);b.active=!0;return b};h.tick=function(){var a=this.runtime.getDt(this),b,d,e,f;if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=a*this.rate,d=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=d,b=0;b<d;b++)e=this.allocateParticle(),e.init();this.particleBoxLeft=this.x;this.particleBoxTop=this.y;this.particleBoxRight=this.x;this.particleBoxBottom=this.y;f=b=0;for(d=this.particles.length;b<d;b++)e=this.particles[b],this.particles[f]=e,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&e.init(),e.tick(a),e.active?(e.left()<this.particleBoxLeft&&(this.particleBoxLeft=e.left()),e.right()>this.particleBoxRight&&(this.particleBoxRight=e.right()),e.top()<this.particleBoxTop&&(this.particleBoxTop=e.top()),e.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=e.bottom()),f++):k.push(e);this.particles.length=f;this.set_bbox_changed();this.first_tick=!1;1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)};h.draw=function(a){var b,d,e,f=this.layer;b=0;for(d=this.particles.length;b<d;b++)e=this.particles[b],e.right()>=f.viewLeft&&(e.bottom()>=f.viewTop&&e.left()<=f.viewRight&&e.top()<=f.viewBottom)&&e.draw(a)};h.drawGL=function(a){this.particlescale=this.layer.getScale();a.setTexture(this.type.webGL_texture);var b,d,e,f=this.layer;b=0;for(d=this.particles.length;b<d;b++)e=this.particles[b],e.right()>=f.viewLeft&&(e.bottom()>=f.viewTop&&e.left()<=f.viewRight&&e.top()<=f.viewBottom)&&e.drawGL(a)};b.prototype.IsSpraying=function(){return this.spraying};f.cnds=new b;d.prototype.SetSpraying=function(a){this.spraying=0!==a};d.prototype.SetEffect=function(a){this.compositeOp=cr.effectToCompositeOp(a);cr.setGLBlend(this,a,this.runtime.gl);this.runtime.redraw=!0};d.prototype.SetRate=function(a){this.rate=a;var b;if(1===this.spraytype&&this.first_tick)if(a<this.particles.length)for(a=this.particles.length-a,b=0;b<a;b++)k.push(this.particles.pop());else if(a>this.particles.length)for(a-=this.particles.length,b=0;b<a;b++)this.allocateParticle().opacity=0};d.prototype.SetSprayCone=function(a){this.spraycone=cr.to_radians(a)};d.prototype.SetInitSpeed=function(a){this.initspeed=a};d.prototype.SetInitSize=function(a){this.initsize=a};d.prototype.SetInitOpacity=function(a){this.initopacity=a/100};d.prototype.SetGrowRate=function(a){this.growrate=a};d.prototype.SetXRandomiser=function(a){this.xrandom=a};d.prototype.SetYRandomiser=function(a){this.yrandom=a};d.prototype.SetSpeedRandomiser=function(a){this.speedrandom=a};d.prototype.SetSizeRandomiser=function(a){this.sizerandom=a};d.prototype.SetGrowRateRandomiser=function(a){this.growrandom=a};d.prototype.SetParticleAcc=function(a){this.acc=a};d.prototype.SetGravity=function(a){this.g=a};d.prototype.SetAngleRandomiser=function(a){this.lifeanglerandom=a};d.prototype.SetSpeedRandomiser=function(a){this.lifespeedrandom=a};d.prototype.SetOpacityRandomiser=function(a){this.lifeopacityrandom=a};d.prototype.SetTimeout=function(a){this.timeout=a};f.acts=new d;e.prototype.ParticleCount=function(a){a.set_int(this.particles.length)};e.prototype.Rate=function(a){a.set_float(this.rate)};e.prototype.SprayCone=function(a){a.set_float(cr.to_degrees(this.spraycone))};e.prototype.InitSpeed=function(a){a.set_float(this.initspeed)};e.prototype.InitSize=function(a){a.set_float(this.initsize)};e.prototype.InitOpacity=function(a){a.set_float(100*this.initopacity)};e.prototype.InitGrowRate=function(a){a.set_float(this.growrate)};e.prototype.XRandom=function(a){a.set_float(this.xrandom)};e.prototype.YRandom=function(a){a.set_float(this.yrandom)};e.prototype.InitSpeedRandom=function(a){a.set_float(this.speedrandom)};e.prototype.InitSizeRandom=function(a){a.set_float(this.sizerandom)};e.prototype.InitGrowRandom=function(a){a.set_float(this.growrandom)};e.prototype.ParticleAcceleration=function(a){a.set_float(this.acc)};e.prototype.Gravity=function(a){a.set_float(this.g)};e.prototype.ParticleAngleRandom=function(a){a.set_float(this.lifeanglerandom)};e.prototype.ParticleSpeedRandom=function(a){a.set_float(this.lifespeedrandom)};e.prototype.ParticleOpacityRandom=function(a){a.set_float(this.lifeopacityrandom)};e.prototype.Timeout=function(a){a.set_float(this.timeout)};f.exps=new e})();cr.plugins_.Text=function(a){this.runtime=a};(function(){function a(){return n.length?n.pop():{}}function b(a){var b,c;b=0;for(c=a.length;b<c;b++)n.push(a[b]);a.length=0}function d(){}function e(){}function f(){}var h=cr.plugins_.Text.prototype;h.onCreate=function(){h.acts.SetWidth=function(a){this.width!==a&&(this.width=a,this.text_changed=!0,this.set_bbox_changed())}};h.Type=function(a){this.plugin=a;this.runtime=a.runtime};var k=h.Type.prototype;k.onCreate=function(){};k.onLostWebGLContext=function(){if(!this.is_family){var a,b,c;a=0;for(b=this.instances.length;a<b;a++)c=this.instances[a],c.mycanvas=null,c.myctx=null,c.mytex=null}};h.Instance=function(a){this.type=a;this.runtime=a.runtime;this.recycled?this.lines.length=0:this.lines=[];this.text_changed=!0};var k=h.Instance.prototype,c={};k.onCreate=function(){this.text=this.properties[0];this.visible=0===this.properties[1];this.font=this.properties[2];this.color=this.properties[3];this.halign=this.properties[4];this.valign=this.properties[5];this.wrapbyword=0===this.properties[7];this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height;this.line_height_offset=this.properties[8];this.fontstyle=this.facename="";this.textHeight=this.textWidth=this.ptSize=0;this.parseFont();this.mytex=this.myctx=this.mycanvas=null;this.need_text_redraw=!1;this.last_render_tick=this.runtime.tickcount;this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1);this.runtime.glwrap&&this.runtime.tickMe(this)};k.parseFont=function(){var a=this.font.split(" "),b;for(b=0;b<a.length;b++)if("pt"===a[b].substr(a[b].length-2,2)){this.ptSize=parseInt(a[b].substr(0,a[b].length-2));this.pxHeight=Math.ceil(96*(this.ptSize/72))+4;0<b&&(this.fontstyle=a[b-1]);this.facename=a[b+1];for(b+=2;b<a.length;b++)this.facename+=" "+a[b];break}};k.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}};k.loadFromJSON=function(a){this.text=a.t;this.font=a.f;this.color=a.c;this.halign=a.ha;this.valign=a.va;this.wrapbyword=a.wr;this.line_height_offset=a.lho;this.facename=a.fn;this.fontstyle=a.fs;this.ptSize=a.ps;this.pxHeight=a.pxh;this.textWidth=a.tw;this.textHeight=a.th;this.last_render_tick=a.lrt;this.text_changed=!0;this.lastwrapwidth=this.lastwidth=this.width;this.lastheight=this.height};k.tick=function(){if(this.runtime.glwrap&&this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var a=this.layer;this.update_bbox();var b=this.bbox;if(b.right<a.viewLeft||b.bottom<a.viewTop||b.left>a.viewRight||b.top>a.viewBottom)this.runtime.glwrap.deleteTexture(this.mytex),this.mycanvas=this.myctx=this.mytex=null}};k.onDestroy=function(){this.mycanvas=this.myctx=null;this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex);this.mytex=null};k.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename;this.text_changed=!0;this.runtime.redraw=!0};k.draw=function(a,b){a.font=this.font;a.textBaseline="top";a.fillStyle=this.color;a.globalAlpha=b?1:this.opacity;var c=1;b&&(c=this.layer.getScale(),a.save(),a.scale(c,c));if(this.text_changed||this.width!==this.lastwrapwidth)this.type.plugin.WordWrap(this.text,this.lines,a,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width;this.update_bbox();var c=b?0:this.bquad.tlx,d=b?0:this.bquad.tly;this.runtime.pixel_rounding&&(c=c+0.5|0,d=d+0.5|0);0===this.angle||b||(a.save(),a.translate(c,d),a.rotate(this.angle),d=c=0);var e=d+this.height,f=this.pxHeight,f=f+this.line_height_offset*this.runtime.devicePixelRatio,h,k;1===this.valign?d+=Math.max(this.height/2-this.lines.length*f/2,0):2===this.valign&&(d+=Math.max(this.height-this.lines.length*f-2,0));for(k=0;k<this.lines.length&&!(h=c,1===this.halign?h=c+(this.width-this.lines[k].width)/2:2===this.halign&&(h=c+(this.width-this.lines[k].width)),a.fillText(this.lines[k].text,h,d),d+=f,d>=e-f);k++);(0!==this.angle||b)&&a.restore();this.last_render_tick=this.runtime.tickcount};k.drawGL=function(a){if(!(1>this.width||1>this.height)){var b=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var c=this.layer.getScale(),d=this.layer.getAngle(),e=this.rcTex,f=c*this.width,h=c*this.height,k=Math.ceil(f),n=Math.ceil(h),s=this.runtime.width/2,m=this.runtime.height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=k,this.mycanvas.height=n,this.lastwidth=k,this.lastheight=n,b=!0,this.myctx=this.mycanvas.getContext("2d"));if(k!==this.lastwidth||n!==this.lastheight)this.mycanvas.width=k,this.mycanvas.height=n,this.mytex&&(a.deleteTexture(this.mytex),this.mytex=null),b=!0;b&&(this.myctx.clearRect(0,0,k,n),this.draw(this.myctx,!0),this.mytex||(this.mytex=a.createEmptyTexture(k,n,this.runtime.linearSampling,this.runtime.isMobile)),a.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile));this.lastwidth=k;this.lastheight=n;a.setTexture(this.mytex);a.setOpacity(this.opacity);a.resetModelView();a.translate(-s,-m);a.updateModelView();var r=this.bquad,b=this.layer.layerToCanvas(r.tlx,r.tly,!0),s=this.layer.layerToCanvas(r.tlx,r.tly,!1),m=this.layer.layerToCanvas(r.trx,r.try_,!0),x=this.layer.layerToCanvas(r.trx,r.try_,!1),z=this.layer.layerToCanvas(r.brx,r.bry,!0),G=this.layer.layerToCanvas(r.brx,r.bry,!1),C=this.layer.layerToCanvas(r.blx,r.bly,!0),r=this.layer.layerToCanvas(r.blx,r.bly,!1);if(this.runtime.pixel_rounding||0===this.angle&&0===d)var F=(b+0.5|0)-b,y=(s+0.5|0)-s,b=b+F,s=s+y,m=m+F,x=x+y,z=z+F,G=G+y,C=C+F,r=r+y;0===this.angle&&0===d?(m=b+k,x=s,z=m,G=s+n,C=b,r=G,e.right=1,e.bottom=1):(e.right=f/k,e.bottom=h/n);a.quadTex(b,s,m,x,z,G,C,r,e);a.resetModelView();a.scale(c,c);a.rotateZ(-this.layer.getAngle());a.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2);a.updateModelView();this.last_render_tick=this.runtime.tickcount}};var r=[];h.TokeniseWords=function(a){r.length=0;for(var b="",c,d=0;d<a.length;)if(c=a.charAt(d),"\n"===c)b.length&&(r.push(b),b=""),r.push("\n"),++d;else if(" "===c||"\t"===c||"-"===c){do b+=a.charAt(d),d++;while(d<a.length&&(" "===a.charAt(d)||"\t"===a.charAt(d)));r.push(b);b=""}else d<a.length&&(b+=c,d++);b.length&&r.push(b)};var n=[];h.WordWrap=function(c,d,e,f,h){if(c&&c.length)if(2>=f)b(d);else{if(100>=c.length&&-1===c.indexOf("\n")){var g=e.measureText(c).width;if(g<=f){b(d);d.push(a());d[0].text=c;d[0].width=g;return}}this.WrapText(c,d,e,f,h)}else b(d)};h.WrapText=function(b,c,d,e,f){f&&(this.TokeniseWords(b),b=r);var g="",h,k,B,s=0;for(B=0;B<b.length;B++)"\n"===b[B]?(s>=c.length&&c.push(a()),k=c[s],k.text=g,k.width=d.measureText(g).width,s++,g=""):(h=g,g+=b[B],k=d.measureText(g).width,k>=e&&(s>=c.length&&c.push(a()),k=c[s],k.text=h,k.width=d.measureText(h).width,s++,g=b[B],f||" "!==g||(g="")));g.length&&(s>=c.length&&c.push(a()),k=c[s],k.text=g,k.width=d.measureText(g).width,s++);for(B=s;B<c.length;B++)n.push(c[B]);c.length=s};d.prototype.CompareText=function(a,b){return b?this.text==a:cr.equals_nocase(this.text,a)};h.cnds=new d;e.prototype.SetText=function(a){cr.is_number(a)&&1E9>a&&(a=Math.round(1E10*a)/1E10);a=a.toString();this.text!==a&&(this.text=a,this.text_changed=!0,this.runtime.redraw=!0)};e.prototype.AppendText=function(a){cr.is_number(a)&&(a=Math.round(1E10*a)/1E10);if(a=a.toString())this.text+=a,this.text_changed=!0,this.runtime.redraw=!0};e.prototype.SetFontFace=function(a,b){var c="";switch(b){case 1:c="bold";break;case 2:c="italic";break;case 3:c="bold italic"}if(a!==this.facename||c!==this.fontstyle)this.facename=a,this.fontstyle=c,this.updateFont()};e.prototype.SetFontSize=function(a){this.ptSize!==a&&(this.ptSize=a,this.pxHeight=Math.ceil(96*(this.ptSize/72))+4,this.updateFont())};e.prototype.SetFontColor=function(a){a="rgb("+cr.GetRValue(a).toString()+","+cr.GetGValue(a).toString()+","+cr.GetBValue(a).toString()+")";a!==this.color&&(this.color=a,this.need_text_redraw=!0,this.runtime.redraw=!0)};e.prototype.SetWebFont=function(a,b){if(this.runtime.isDomFree)cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");else{var d=this,e=function(){d.runtime.redraw=!0;d.text_changed=!0};if(c.hasOwnProperty(b)){var f="'"+a+"'";if(this.facename!==f)for(this.facename=f,this.updateFont(),f=1;10>f;f++)setTimeout(e,100*f),setTimeout(e,1E3*f)}else for(f=document.createElement("link"),f.href=b,f.rel="stylesheet",f.type="text/css",f.onload=e,document.getElementsByTagName("head")[0].appendChild(f),c[b]=!0,this.facename="'"+a+"'",this.updateFont(),f=1;10>f;f++)setTimeout(e,100*f),setTimeout(e,1E3*f)}};e.prototype.SetEffect=function(a){this.compositeOp=cr.effectToCompositeOp(a);cr.setGLBlend(this,a,this.runtime.gl);this.runtime.redraw=!0};h.acts=new e;f.prototype.Text=function(a){a.set_string(this.text)};f.prototype.FaceName=function(a){a.set_string(this.facename)};f.prototype.FaceSize=function(a){a.set_int(this.ptSize)};f.prototype.TextWidth=function(a){var b=0,c,d,e;c=0;for(d=this.lines.length;c<d;c++)e=this.lines[c].width,b<e&&(b=e);a.set_int(b)};f.prototype.TextHeight=function(a){a.set_int(this.lines.length*this.pxHeight)};h.exps=new f})();cr.plugins_.Touch=function(a){this.runtime=a};(function(){function a(a){c=a.x;r=a.y;n=a.z}function b(a){l=a.x;q=a.y;v=a.z}function d(){}function e(){}var f=cr.plugins_.Touch.prototype;f.Type=function(a){this.plugin=a;this.runtime=a.runtime};f.Type.prototype.onCreate=function(){};f.Instance=function(a){this.type=a;this.runtime=a.runtime;this.touches=[];this.mouseDown=!1};var h=f.Instance.prototype,k={left:0,top:0};h.findTouch=function(a){var b,c;b=0;for(c=this.touches.length;b<c;b++)if(this.touches[b].id===a)return b;return-1};var c=0,r=0,n=0,l=0,q=0,v=0;h.onCreate=function(){this.isWindows8=!("undefined"===typeof window.c2isWindows8||!window.c2isWindows8);this.trigger_id=this.trigger_index=this.curTouchY=this.curTouchX=this.acc_z=this.acc_y=this.acc_x=this.acc_g_z=this.acc_g_y=this.acc_g_x=this.orient_gamma=this.orient_beta=this.orient_alpha=0;this.useMouseInput=0!==this.properties[0];var c=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,d=document;this.runtime.isDirectCanvas?d=c=window.Canvas:this.runtime.isCocoonJs&&(d=c=window);var e=this;window.navigator.msPointerEnabled?(c.addEventListener("MSPointerDown",function(a){e.onPointerStart(a)},!1),c.addEventListener("MSPointerMove",function(a){e.onPointerMove(a)},!1),d.addEventListener("MSPointerUp",function(a){e.onPointerEnd(a)},!1),d.addEventListener("MSPointerCancel",function(a){e.onPointerEnd(a)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(a){a.preventDefault()},!1),document.addEventListener("MSGestureHold",function(a){a.preventDefault()},!1))):(c.addEventListener("touchstart",function(a){e.onTouchStart(a)},!1),c.addEventListener("touchmove",function(a){e.onTouchMove(a)},!1),d.addEventListener("touchend",function(a){e.onTouchEnd(a)},!1),d.addEventListener("touchcancel",function(a){e.onTouchEnd(a)},!1));if(this.isWindows8){var f=function(a){a=a.reading;e.acc_x=a.accelerationX;e.acc_y=a.accelerationY;e.acc_z=a.accelerationZ},h=function(a){a=a.reading;e.orient_alpha=a.yawDegrees;e.orient_beta=a.pitchDegrees;e.orient_gamma=a.rollDegrees},k=Windows.Devices.Sensors.Accelerometer.getDefault();k&&(k.reportInterval=Math.max(k.minimumReportInterval,16),k.addEventListener("readingchanged",f));var l=Windows.Devices.Sensors.Inclinometer.getDefault();l&&(l.reportInterval=Math.max(l.minimumReportInterval,16),l.addEventListener("readingchanged",h));document.addEventListener("visibilitychange",function(a){document.hidden||document.msHidden?(k&&k.removeEventListener("readingchanged",f),l&&l.removeEventListener("readingchanged",h)):(k&&k.addEventListener("readingchanged",f),l&&l.addEventListener("readingchanged",h))},!1)}else window.addEventListener("deviceorientation",function(a){e.orient_alpha=a.alpha||0;e.orient_beta=a.beta||0;e.orient_gamma=a.gamma||0},!1),window.addEventListener("devicemotion",function(a){a.accelerationIncludingGravity&&(e.acc_g_x=a.accelerationIncludingGravity.x,e.acc_g_y=a.accelerationIncludingGravity.y,e.acc_g_z=a.accelerationIncludingGravity.z);a.acceleration&&(e.acc_x=a.acceleration.x,e.acc_y=a.acceleration.y,e.acc_z=a.acceleration.z)},!1);this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(a){e.onMouseMove(a)}),jQuery(document).mousedown(function(a){e.onMouseDown(a)}),jQuery(document).mouseup(function(a){e.onMouseUp(a)}));this.runtime.isAppMobi&&!this.runtime.isDirectCanvas&&AppMobi.accelerometer.watchAcceleration(a,{frequency:40,adjustForRotation:!0});this.runtime.isPhoneGap&&navigator.accelerometer.watchAcceleration(b,null,{frequency:40});this.runtime.tick2Me(this)};h.onPointerMove=function(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE){a.preventDefault&&a.preventDefault();var b=this.findTouch(a.pointerId),c=cr.performance_now();if(0<=b){var d=this.runtime.isDomFree?k:jQuery(this.runtime.canvas).offset(),b=this.touches[b];2>c-b.time||(b.lasttime=b.time,b.lastx=b.x,b.lasty=b.y,b.time=c,b.x=a.pageX-d.left,b.y=a.pageY-d.top)}}};h.onPointerStart=function(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE){a.preventDefault&&a.preventDefault();var b=this.runtime.isDomFree?k:jQuery(this.runtime.canvas).offset(),c=a.pageX-b.left,b=a.pageY-b.top,d=cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=a.pointerId;this.touches.push({time:d,x:c,y:b,lasttime:d,lastx:c,lasty:b,id:a.pointerId,startindex:this.trigger_index});this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=c;this.curTouchY=b;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}};h.onPointerEnd=function(a){a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&(a.preventDefault&&a.preventDefault(),a=this.findTouch(a.pointerId),this.trigger_index=0<=a?this.touches[a].startindex:-1,this.trigger_id=0<=a?this.touches[a].id:-1,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=a&&this.touches.splice(a,1))};h.onTouchMove=function(a){a.preventDefault&&a.preventDefault();var b=cr.performance_now(),c,d,e,f;c=0;for(d=a.changedTouches.length;c<d;c++)if(e=a.changedTouches[c],f=this.findTouch(e.identifier),0<=f){var h=this.runtime.isDomFree?k:jQuery(this.runtime.canvas).offset();f=this.touches[f];2>b-f.time||(f.lasttime=f.time,f.lastx=f.x,f.lasty=f.y,f.time=b,f.x=e.pageX-h.left,f.y=e.pageY-h.top)}};h.onTouchStart=function(a){a.preventDefault&&a.preventDefault();var b=this.runtime.isDomFree?k:jQuery(this.runtime.canvas).offset(),c=cr.performance_now(),d,e,f,h;d=0;for(e=a.changedTouches.length;d<e;d++)if(f=a.changedTouches[d],h=this.findTouch(f.identifier),-1===h){h=f.pageX-b.left;var l=f.pageY-b.top;this.trigger_index=this.touches.length;this.trigger_id=f.identifier;this.touches.push({time:c,x:h,y:l,lasttime:c,lastx:h,lasty:l,id:f.identifier,startindex:this.trigger_index});this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=h;this.curTouchY=l;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}};h.onTouchEnd=function(a){a.preventDefault&&a.preventDefault();var b,c,d;b=0;for(c=a.changedTouches.length;b<c;b++)d=a.changedTouches[b],d=this.findTouch(d.identifier),0<=d&&(this.trigger_index=this.touches[d].startindex,this.trigger_id=this.touches[d].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),this.touches.splice(d,1))};h.getAlpha=function(){return this.runtime.isAppMobi&&0===this.orient_alpha&&0!==n?90*n:this.runtime.isPhoneGap&&0===this.orient_alpha&&0!==v?90*v:this.orient_alpha};h.getBeta=function(){return this.runtime.isAppMobi&&0===this.orient_beta&&0!==r?-90*r:this.runtime.isPhoneGap&&0===this.orient_beta&&0!==q?-90*q:this.orient_beta};h.getGamma=function(){return this.runtime.isAppMobi&&0===this.orient_gamma&&0!==c?90*c:this.runtime.isPhoneGap&&0===this.orient_gamma&&0!==l?90*l:this.orient_gamma};h.onMouseDown=function(a){a.preventDefault&&this.runtime.had_a_click&&a.preventDefault();this.onTouchStart({changedTouches:[{pageX:a.pageX,pageY:a.pageY,identifier:0}]});this.mouseDown=!0};h.onMouseMove=function(a){a.preventDefault&&this.runtime.had_a_click&&a.preventDefault();if(this.mouseDown)this.onTouchMove({changedTouches:[{pageX:a.pageX,pageY:a.pageY,identifier:0}]})};h.onMouseUp=function(a){a.preventDefault&&this.runtime.had_a_click&&a.preventDefault();this.runtime.had_a_click=!0;this.onTouchEnd({changedTouches:[{pageX:a.pageX,pageY:a.pageY,identifier:0}]});this.mouseDown=!1};h.tick2=function(){var a,b,c,d=cr.performance_now();a=0;for(b=this.touches.length;a<b;a++)c=this.touches[a],c.time<=d-50&&(c.lasttime=d)};d.prototype.OnTouchStart=function(){return!0};d.prototype.OnTouchEnd=function(){return!0};d.prototype.IsInTouch=function(){return this.touches.length};d.prototype.OnTouchObject=function(a){return a?this.runtime.testAndSelectCanvasPointOverlap(a,this.curTouchX,this.curTouchY,!1):!1};d.prototype.IsTouchingObject=function(a){if(!a)return!1;a=a.getCurrentSol();var b=a.getObjects(),c,d,e=[],f,h,k,l;f=0;for(h=b.length;f<h;f++){var n=b[f];n.update_bbox();k=0;for(l=this.touches.length;k<l;k++)if(d=this.touches[k],c=n.layer.canvasToLayer(d.x,d.y,!0),d=n.layer.canvasToLayer(d.x,d.y,!1),n.contains_pt(c,d)){e.push(n);break}}return e.length?(a.select_all=!1,a.instances=e,!0):!1};d.prototype.CompareTouchSpeed=function(a,b,c){a=Math.floor(a);if(0>a||a>=this.touches.length)return!1;var d=this.touches[a];a=cr.distanceTo(d.x,d.y,d.lastx,d.lasty);var d=(d.time-d.lasttime)/1E3,e=0;0<d&&(e=a/d);return cr.do_cmp(e,b,c)};d.prototype.OrientationSupported=function(){return"undefined"!==typeof window.DeviceOrientationEvent};d.prototype.MotionSupported=function(){return"undefined"!==typeof window.DeviceMotionEvent};d.prototype.CompareOrientation=function(a,b,c){var d=0,d=0===a?this.getAlpha():1===a?this.getBeta():this.getGamma();return cr.do_cmp(d,b,c)};d.prototype.CompareAcceleration=function(a,b,c){var d=0;0===a?d=this.acc_g_x:1===a?d=this.acc_g_y:2===a?d=this.acc_g_z:3===a?d=this.acc_x:4===a?d=this.acc_y:5===a&&(d=this.acc_z);return cr.do_cmp(d,b,c)};d.prototype.OnNthTouchStart=function(a){a=Math.floor(a);return a===this.trigger_index};d.prototype.OnNthTouchEnd=function(a){a=Math.floor(a);return a===this.trigger_index};d.prototype.HasNthTouch=function(a){a=Math.floor(a);return this.touches.length>=a+1};f.cnds=new d;e.prototype.TouchCount=function(a){a.set_int(this.touches.length)};e.prototype.X=function(a,b){if(this.touches.length){var c,d,e,f,h;cr.is_undefined(b)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxX,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxX=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(this.touches[0].x,this.touches[0].y,!0)),c.scale=d,c.zoomRate=e,c.parallaxX=f,c.angle=h):(c=cr.is_number(b)?this.runtime.getLayerByNumber(b):this.runtime.getLayerByName(b))?a.set_float(c.canvasToLayer(this.touches[0].x,this.touches[0].y,!0)):a.set_float(0)}else a.set_float(0)};e.prototype.XAt=function(a,b,c){b=Math.floor(b);if(0>b||b>=this.touches.length)a.set_float(0);else{var d,e,f,h;cr.is_undefined(c)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxX,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxX=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(this.touches[b].x,this.touches[b].y,!0)),c.scale=d,c.zoomRate=e,c.parallaxX=f,c.angle=h):(c=cr.is_number(c)?this.runtime.getLayerByNumber(c):this.runtime.getLayerByName(c))?a.set_float(c.canvasToLayer(this.touches[b].x,this.touches[b].y,!0)):a.set_float(0)}};e.prototype.XForID=function(a,b,c){b=this.findTouch(b);if(0>b)a.set_float(0);else{b=this.touches[b];var d,e,f,h;cr.is_undefined(c)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxX,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxX=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(b.x,b.y,!0)),c.scale=d,c.zoomRate=e,c.parallaxX=f,c.angle=h):(c=cr.is_number(c)?this.runtime.getLayerByNumber(c):this.runtime.getLayerByName(c))?a.set_float(c.canvasToLayer(b.x,b.y,!0)):a.set_float(0)}};e.prototype.Y=function(a,b){if(this.touches.length){var c,d,e,f,h;cr.is_undefined(b)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxY,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxY=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(this.touches[0].x,this.touches[0].y,!1)),c.scale=d,c.zoomRate=e,c.parallaxY=f,c.angle=h):(c=cr.is_number(b)?this.runtime.getLayerByNumber(b):this.runtime.getLayerByName(b))?a.set_float(c.canvasToLayer(this.touches[0].x,this.touches[0].y,!1)):a.set_float(0)}else a.set_float(0)};e.prototype.YAt=function(a,b,c){b=Math.floor(b);if(0>b||b>=this.touches.length)a.set_float(0);else{var d,e,f,h;cr.is_undefined(c)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxY,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxY=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(this.touches[b].x,this.touches[b].y,!1)),c.scale=d,c.zoomRate=e,c.parallaxY=f,c.angle=h):(c=cr.is_number(c)?this.runtime.getLayerByNumber(c):this.runtime.getLayerByName(c))?a.set_float(c.canvasToLayer(this.touches[b].x,this.touches[b].y,!1)):a.set_float(0)}};e.prototype.YForID=function(a,b,c){b=this.findTouch(b);if(0>b)a.set_float(0);else{b=this.touches[b];var d,e,f,h;cr.is_undefined(c)?(c=this.runtime.getLayerByNumber(0),d=c.scale,e=c.zoomRate,f=c.parallaxY,h=c.angle,c.scale=this.runtime.running_layout.scale,c.zoomRate=1,c.parallaxY=1,c.angle=this.runtime.running_layout.angle,a.set_float(c.canvasToLayer(b.x,b.y,!1)),c.scale=d,c.zoomRate=e,c.parallaxY=f,c.angle=h):(c=cr.is_number(c)?this.runtime.getLayerByNumber(c):this.runtime.getLayerByName(c))?a.set_float(c.canvasToLayer(b.x,b.y,!1)):a.set_float(0)}};e.prototype.AbsoluteX=function(a){this.touches.length?a.set_float(this.touches[0].x):a.set_float(0)};e.prototype.AbsoluteXAt=function(a,b){b=Math.floor(b);0>b||b>=this.touches.length?a.set_float(0):a.set_float(this.touches[b].x)};e.prototype.AbsoluteXForID=function(a,b){var c=this.findTouch(b);0>c?a.set_float(0):a.set_float(this.touches[c].x)};e.prototype.AbsoluteY=function(a){this.touches.length?a.set_float(this.touches[0].y):a.set_float(0)};e.prototype.AbsoluteYAt=function(a,b){b=Math.floor(b);0>b||b>=this.touches.length?a.set_float(0):a.set_float(this.touches[b].y)};e.prototype.AbsoluteYForID=function(a,b){var c=this.findTouch(b);0>c?a.set_float(0):a.set_float(this.touches[c].y)};e.prototype.SpeedAt=function(a,b){b=Math.floor(b);if(0>b||b>=this.touches.length)a.set_float(0);else{var c=this.touches[b],d=cr.distanceTo(c.x,c.y,c.lastx,c.lasty),c=(c.time-c.lasttime)/1E3;0===c?a.set_float(0):a.set_float(d/c)}};e.prototype.SpeedForID=function(a,b){var c=this.findTouch(b);if(0>c)a.set_float(0);else{var d=this.touches[c],c=cr.distanceTo(d.x,d.y,d.lastx,d.lasty),d=(d.time-d.lasttime)/1E3;0===d?a.set_float(0):a.set_float(c/d)}};e.prototype.AngleAt=function(a,b){b=Math.floor(b);if(0>b||b>=this.touches.length)a.set_float(0);else{var c=this.touches[b];a.set_float(cr.to_degrees(cr.angleTo(c.lastx,c.lasty,c.x,c.y)))}};e.prototype.AngleForID=function(a,b){var c=this.findTouch(b);0>c?a.set_float(0):(c=this.touches[c],a.set_float(cr.to_degrees(cr.angleTo(c.lastx,c.lasty,c.x,c.y))))};e.prototype.Alpha=function(a){a.set_float(this.getAlpha())};e.prototype.Beta=function(a){a.set_float(this.getBeta())};e.prototype.Gamma=function(a){a.set_float(this.getGamma())};e.prototype.AccelerationXWithG=function(a){a.set_float(this.acc_g_x)};e.prototype.AccelerationYWithG=function(a){a.set_float(this.acc_g_y)};e.prototype.AccelerationZWithG=function(a){a.set_float(this.acc_g_z)};e.prototype.AccelerationX=function(a){a.set_float(this.acc_x)};e.prototype.AccelerationY=function(a){a.set_float(this.acc_y)};e.prototype.AccelerationZ=function(a){a.set_float(this.acc_z)};e.prototype.TouchIndex=function(a){a.set_int(this.trigger_index)};e.prototype.TouchID=function(a){a.set_float(this.trigger_id)};f.exps=new e})();cr.getProjectModel=function(){return[null,"Loader",[[cr.plugins_.Browser,!0,!1,!1,!1,!1,!1,!1,!1,!1],[cr.plugins_.Audio,!0,!1,!1,!1,!1,!1,!1,!1,!1],[cr.plugins_.Keyboard,!0,!1,!1,!1,!1,!1,!1,!1,!1],[cr.plugins_.NodeWebkit,!0,!1,!1,!1,!1,!1,!1,!1,!1],[cr.plugins_.Particles,!1,!0,!0,!1,!0,!0,!0,!0,!0],[cr.plugins_.Text,!1,!0,!0,!0,!0,!0,!0,!0,!1],[cr.plugins_.Touch,!0,!1,!1,!1,!1,!1,!1,!1,!1]],[["t0",cr.plugins_.Browser,!1,[],0,0,null,null,[],!1,!1,0xe7508259f1049,[],[]],["t1",cr.plugins_.Keyboard,!1,[],0,0,null,null,[],!1,!1,8268562079040081,[],[]],["t2",cr.plugins_.Particles,!1,[],0,0,["c2.png",29833,0],null,[],!1,!1,723074460476516,[]],["t3",cr.plugins_.Audio,!1,[],0,0,null,null,[],!1,!1,0x87d7a273e6e76,[],[0,1,1,600,600,1E4,1,5E3,1]],["t4",cr.plugins_.NodeWebkit,!1,[],0,0,null,null,[],!1,!1,0x418c17d077bfa,[],[]],["t5",cr.plugins_.Particles,!1,[],0,0,["nw.png",2403,0],null,[],!1,!1,7413958693205721,[]],["t6",cr.plugins_.Text,!1,[],0,0,null,null,[],!1,!1,0xadbe7ef820faf,[]],["t7",cr.plugins_.Touch,!1,[],0,0,null,null,[],!1,!1,4854103537132793,[],[1]]],[],[["Loader",800,600,!1,"Loader_events",9256725879576544,[["Loader",0,8771806647801429,!0,[0,0,0],!1,1,1,1,!1,1,0,0,[],[]]],[],[]],["Veille",800,600,!1,"Veille_events",306290045656015,[["Veille",0,0x9c56068fd6acc,!0,[0,0,0],!1,1,1,1,!1,1,1,0,[[[400,-75,0,32,320,0,1.5708,1,0,0.5,0,0,[]],2,1,[],[],[5,120,0,250,40,0,-2,40,0,0,8,0,-150,100,2,800,2,0,5]],[[400,700,0,32,320,0,-1.5708,1,0,0.5,0,0,[]],5,7,[],[],[5,120,0,250,40,0,-2,40,0,0,8,0,-150,-100,2,800,2,0,5]],[[579,30,0,200,540,0,0,0.5,0,0,1,0,[]],6,4,[],[],["",1,"bold 12pt Arial","rgb(255,255,255)",1,1,0,0,0]]],[["warpripple","WarpRipple",[1,0.01,-5]]]]],[],[]],["Exit",800,600,!1,"Exit_events",6113943557441396,[["Exit",0,0xb124a9f08ea67,!0,[0,0,0],!1,1,1,1,!1,1,0,0,[],[]]],[],[]]],[["Loader_events",[[1,"NumVeille",0,-2,!1,!1,8964089995488567],[1,"NWfile",1,"",!1,!1,0xe4fbfc76f13ab],[0,null,!1,0x4dfd65888a214,[[-1,cr.system_object.prototype.cnds.OnLayoutStart,null,1,!1,!1,!1,9184290607372780]],[[0,cr.plugins_.Browser.prototype.acts.RequestFullScreen,null,7636186985065621,[[3,5]]]]],[0,null,!1,0x5bb13aa690f60,[[-1,cr.system_object.prototype.cnds.OnLoadFinished,null,1,!1,!1,!1,0x82e0442152500]],[[-1,cr.system_object.prototype.acts.Wait,null,9840344659686878,[[0,[1,0.01]]]],[-1,cr.system_object.prototype.acts.GoToLayout,null,0x5200955dfe05a,[[6,"Veille"]]]]]]],["Veille_events",[[1,"RMS",0,0,!1,!1,8272711222301935],[1,"Restart",0,0,!1,!1,5338948241480027],[0,null,!1,9883295321069700,[[-1,cr.system_object.prototype.cnds.OnLayoutStart,null,1,!1,!1,!1,0xd39cedc82dd33]],[[3,cr.plugins_.Audio.prototype.acts.PlayByName,null,5202980257560176,[[3,1],[1,[2,"Evening_Fall_Harp"]],[3,0],[0,[0,0]],[1,[2,""]]]],[2,cr.plugins_.Particles.prototype.acts.SetRate,null,0xc15240e82c978,[[0,[0,5]]]],[5,cr.plugins_.Particles.prototype.acts.SetRate,null,0x6ff8687e80572,[[0,[0,5]]]],[2,cr.plugins_.Particles.prototype.acts.SetSpraying,null,5500294466648475,[[3,1]]],[5,cr.plugins_.Particles.prototype.acts.SetSpraying,null,4830535051445549,[[3,1]]]]],[0,[!1,"Start"],!1,5670715518694284,[[-1,cr.system_object.prototype.cnds.IsGroupActive,null,0,!1,!1,!1,5670715518694284,[[1,[2,"Start"]]]]],[],[[0,null,!1,8365481790965971,[[-1,cr.system_object.prototype.cnds.Compare,null,0,!1,!1,!1,681938087295472,[[7,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]]],[8,0],[7,[0,100]]]]],[[-1,cr.system_object.prototype.acts.SetGroupActive,null,0x939cfc17f135c,[[1,[2,"Start"]],[3,0]]]]],[0,null,!1,0xaccce4249a717,[[-1,cr.system_object.prototype.cnds.Else,null,0,!1,!1,!1,9645145373693224],[-1,cr.system_object.prototype.cnds.EveryTick,null,0,!1,!1,!1,0xc1f6300af58e8]],[[-1,cr.system_object.prototype.acts.SetLayerOpacity,null,0x50fa048c371f6,[[5,[2,"Veille"]],[0,[4,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]],[0,1]]]]],[2,cr.plugins_.Particles.prototype.acts.SetInitOpacity,null,0xa82f69b81a210,[[0,[5,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]],[0,10]]]]],[5,cr.plugins_.Particles.prototype.acts.SetInitOpacity,null,9087421245893464,[[0,[5,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]],[0,10]]]]]]]]],[0,[!1,"Body"],!1,7028360535295121,[[-1,cr.system_object.prototype.cnds.IsGroupActive,null,0,!1,!1,!1,7028360535295121,[[1,[2,"Body"]]]]],[],[[0,null,!1,0x51e8a6e11ca45,[[1,cr.plugins_.Keyboard.prototype.cnds.OnKey,null,1,!1,!1,!1,0xaf5a5a8d1a494,[[9,13]]]],[],[[0,null,!1,6545261610976676,[[6,cr.plugins_.Text.prototype.cnds.IsVisible,null,0,!1,!0,!1,57733252997832]],[[6,cr.plugins_.Text.prototype.acts.SetVisible,null,0x8bbeaf0a9536a,[[3,1]]]]],[0,null,!1,7903978118133453,[[-1,cr.system_object.prototype.cnds.Else,null,0,!1,!1,!1,7093124615072028]],[[6,cr.plugins_.Text.prototype.acts.SetVisible,null,9016231935903996,[[3,0]]]]]]],[0,null,!1,0xc3a65bf4f2a22,[[-1,cr.system_object.prototype.cnds.Every,null,0,!1,!1,!1,7317966506217073,[[0,[1,1]]]]],[[2,cr.plugins_.Particles.prototype.acts.SetRate,null,8632633260751814,[[0,[19,cr.system_object.prototype.exps.clamp,[[18,[16,[7,[4,[20,2,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[20,2,cr.plugins_.Particles.prototype.exps.ParticleCount,!1,null]],[7,[19,cr.system_object.prototype.exps.fps],[0,25]]],[19,cr.system_object.prototype.exps.fps]],[5,[20,2,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[19,cr.system_object.prototype.exps.random,[[0,1],[0,2]]]],[4,[20,2,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[19,cr.system_object.prototype.exps.random,[[0,1],[0,2]]]]],[0,5],[0,25]]]]]],[5,cr.plugins_.Particles.prototype.acts.SetRate,null,6062215411365679,[[0,[19,cr.system_object.prototype.exps.clamp,[[18,[16,[7,[4,[20,5,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[20,5,cr.plugins_.Particles.prototype.exps.ParticleCount,!1,null]],[7,[19,cr.system_object.prototype.exps.fps],[0,25]]],[19,cr.system_object.prototype.exps.fps]],[5,[20,5,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[19,cr.system_object.prototype.exps.random,[[0,1],[0,2]]]],[4,[20,5,cr.plugins_.Particles.prototype.exps.Rate,!1,null],[19,cr.system_object.prototype.exps.random,[[0,1],[0,2]]]]],[0,5],[0,25]]]]]],[6,cr.plugins_.Text.prototype.acts.SetText,null,9405966255769602,[[7,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[10,[2,"#"],[20,2,cr.plugins_.Particles.prototype.exps.ParticleCount,!1,null]],[2," +"]],[19,cr.system_object.prototype.exps["int"],[[20,2,cr.plugins_.Particles.prototype.exps.Rate,!1,null]]]],[2,"/sec"]],[19,cr.system_object.prototype.exps.newline]],[19,cr.system_object.prototype.exps.newline]],[2,"FPS:"]],[19,cr.system_object.prototype.exps.fps]],[2," RMS:"]],[7,[19,cr.system_object.prototype.exps.floor,[[6,[23,"RMS"],[0,100]]]],[0,100]]],[19,cr.system_object.prototype.exps.newline]],[19,cr.system_object.prototype.exps.newline]],[2,"#"]],[20,5,cr.plugins_.Particles.prototype.exps.ParticleCount,!1,null]],[2," +"]],[19,cr.system_object.prototype.exps["int"],[[20,5,cr.plugins_.Particles.prototype.exps.Rate,!1,null]]]],[2,"/sec"]]]]]]],[0,null,!1,0x928915e9cd3bb,[[-1,cr.system_object.prototype.cnds.EveryTick,null,0,!1,!1,!1,6917607399799475],[3,cr.plugins_.Audio.prototype.cnds.AdvancedAudioSupported,null,0,!1,!1,!1,9849462572130356]],[[-1,cr.system_object.prototype.acts.SetVar,null,9168531653053006,[[11,"RMS"],[7,[20,3,cr.plugins_.Audio.prototype.exps.AnalyserRMSLevel,!1,null,[[2,"a"],[0,0]]]]]],[2,cr.plugins_.Particles.prototype.acts.SetGravity,null,0xcf6eb9b13cfb,[[0,[6,[23,"RMS"],[1,-2.1]]]]],[5,cr.plugins_.Particles.prototype.acts.SetGravity,null,8351761715539176,[[0,[6,[23,"RMS"],[1,2.1]]]]]]],[0,null,!1,8242976808981609,[[-1,cr.system_object.prototype.cnds.Compare,null,0,!1,!1,!1,5987721542830278,[[7,[19,cr.system_object.prototype.exps.time]],[8,5],[7,[0,140]]]],[-1,cr.system_object.prototype.cnds.CompareVar,null,0,!1,!1,!1,8881592830623784,[[11,"Restart"],[8,0],[7,[0,0]]]]],[[-1,cr.system_object.prototype.acts.SetVar,null,8871831640987063,[[11,"Restart"],[7,[0,1]]]]]],[0,null,!0,0xf980861b0c5a4,[[1,cr.plugins_.Keyboard.prototype.cnds.OnKey,null,1,!1,!1,!1,7240018894178457,[[9,27]]],[7,cr.plugins_.Touch.prototype.cnds.IsInTouch,null,0,!1,!1,!1,0xe41159773516],[-1,cr.system_object.prototype.cnds.CompareVar,null,0,!1,!1,!1,0xa522af7e93f2e,[[11,"Restart"],[8,0],[7,[0,1]]]]],[[-1,cr.system_object.prototype.acts.SetVar,null,0x9f9a93e787142,[[11,"Restart"],[7,[3,[23,"Restart"]]]]],[-1,cr.system_object.prototype.acts.SetGroupActive,null,4593935824136996,[[1,[2,"Start"]],[3,0]]],[-1,cr.system_object.prototype.acts.SetGroupActive,null,7749099240835881,[[1,[2,"Body"]],[3,0]]],[2,cr.plugins_.Particles.prototype.acts.SetSpraying,null,6865126891265061,[[3,0]]],[5,cr.plugins_.Particles.prototype.acts.SetSpraying,null,0x44b2c5ab55ee5,[[3,0]]],[-1,cr.system_object.prototype.acts.SetGroupActive,null,9864700388762392,[[1,[2,"End"]],[3,1]]]]]]],[0,[!1,"End"],!1,0x7309bde3e92e,[[-1,cr.system_object.prototype.cnds.IsGroupActive,null,0,!1,!1,!1,0x7309bde3e92e,[[1,[2,"End"]]]]],[],[[0,null,!1,0x7321b49aa09e1,[[-1,cr.system_object.prototype.cnds.Compare,null,0,!1,!1,!1,4511261893892535,[[7,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]]],[8,0],[7,[0,0]]]]],[[-1,cr.system_object.prototype.acts.SetGroupActive,null,4772013783097554,[[1,[2,"End"]],[3,0]]],[3,cr.plugins_.Audio.prototype.acts.StopAll,null,832829439830883]],[[0,null,!1,7259102832799663,[[-1,cr.system_object.prototype.cnds.CompareVar,null,0,!1,!1,!1,0x5012013f72140,[[11,"Restart"],[8,0],[7,[0,0]]]]],[[-1,cr.system_object.prototype.acts.GoToLayoutByName,null,0xe7d6f7283c74b,[[1,[2,"exit"]]]]]],[0,null,!1,8363975973112161,[[-1,cr.system_object.prototype.cnds.Else,null,0,!1,!1,!1,0x60cf0d437e8dc]],[[3,cr.plugins_.Audio.prototype.acts.StopAll,null,5893738282654444],[0,cr.plugins_.Browser.prototype.acts.Reload,null,0x62cf4bced8610]]]]],[0,null,!1,7218792687155007,[[-1,cr.system_object.prototype.cnds.Else,null,0,!1,!1,!1,7503399522701357],[-1,cr.system_object.prototype.cnds.EveryTick,null,0,!1,!1,!1,5378603673816071]],[[-1,cr.system_object.prototype.acts.SetLayerOpacity,null,0xccdd38cda519a,[[5,[2,"Veille"]],[0,[5,[19,cr.system_object.prototype.exps.layeropacity,[[2,"Veille"]]],[0,1]]]]],[3,cr.plugins_.Audio.prototype.acts.SetVolume,null,5245460560361351,[[1,[2,"a"]],[0,[5,[20,3,cr.plugins_.Audio.prototype.exps.Volume,!1,null,[[2,"a"]]],[1,0.25]]]]]]]]],[0,null,!1,0xf82f8373efea5,[[7,cr.plugins_.Touch.prototype.cnds.IsInTouch,null,0,!1,!1,!1,0xb4decc1bcddd3]],[[-1,cr.system_object.prototype.acts.GoToLayoutByName,null,0x59bbef9fef967,[[1,[2,"exit"]]]]]]]],["Exit_events",[[0,null,!1,0xe7e976c27bdd5,[[-1,cr.system_object.prototype.cnds.OnLayoutStart,null,1,!1,!1,!1,7777797351584432]],[[-1,cr.system_object.prototype.acts.Wait,null,5810891606874927,[[0,[1,0.01]]]],[0,cr.plugins_.Browser.prototype.acts.Close,null,82255096705349]]]]]],"",!0,800,600,2,!0,!0,!1,"1.1",0,!0,3,!0,8,!1,[]]};